<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>29&nbsp; Working with Character Strings ‚Äì R 4 Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/conditional_operations/conditional_operations.html" rel="next">
<link href="../../chapters/working_with_dates/working_with_dates.html" rel="prev">
<link href="../../r4epi_favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/intro_data_management/introduction.html">Data Management</a></li><li class="breadcrumb-item"><a href="../../chapters/working_with_character_strings/working_with_character_strings.html"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Working with Character Strings</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">R 4 Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/brad-cannell/r4epi_quarto/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../R-4-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/contributing/contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/about_the_authors/about_the_authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the Authors</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/installing_r_and_rstudio/installing_r_and_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Installing R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/what_is_r/what_is_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">What is R?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/navigating_rstudio/navigating_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Navigating the RStudio Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/speaking_r/speaking_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Speaking R‚Äôs Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/lets_get_programming/lets_get_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Let‚Äôs Get Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/asking_questions/asking_questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Asking Questions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Coding Tools and Best Practices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/r_scripts/r_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Scripts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/quarto_files/quarto_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quarto Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/r_projects/projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R Projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/best_practices/best_practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Coding Best Practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_pipes/using_pipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Using Pipes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Transfer</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/data_transfer/data_transfer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Data Transfer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/file_paths/file_paths.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">File Paths</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/importing_plain_text/importing_plain_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Importing Plain Text Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/importing_binary_files/importing_binary_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Importing Binary Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/rstudio_import_tool/rstudio_import_tool.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">RStudio‚Äôs Data Import Tool</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/exporting_data_to_disk/exporting_data_to_disk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Exporting Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Descriptive Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_descriptive_analysis/intro_descriptive_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Descriptive Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/categorical_variables/categorical_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Numerical Descriptions of Categorical Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/central_tendency/central_tendency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Measures of Central Tendency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dispersion/dispersion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Measures of Dispersion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cont_out_cont_pred/cont_out_cont_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Continuous Outcome and a Continuous Predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cont_out_cat_pred/cont_out_cat_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Continuous Outcome and a Categorical Predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cat_out_cat_pred/cat_out_cat_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Categorical Outcome and a Categorical Predictor</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_data_management/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Introduction to Data Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/creating_and_modifying_columns/creating_and_modifying_columns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Creating and Modifying Columns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/subsetting_data_frames/subsetting_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Subsetting Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/working_with_dates/working_with_dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/working_with_character_strings/working_with_character_strings.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Working with Character Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/conditional_operations/conditional_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Conditional Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/multiple_data_frames/multiple_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Working with Multiple Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/restructuring_data_frames/restructuring_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Restructuring Data frames</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Repeated Operations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_repeated_operations/intro_repeated_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Introduction to Repeated Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/writing_functions/writing_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dplyr_column_wise/dplyr_column_wise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Column-wise Operations in dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/writing_for_loops/writing_for_loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Writing For Loops</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_purrr/using_purrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Using the purrr Package</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Collaboration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_git_github/intro_git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Introduction to git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_git_github/using_git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Using git and GitHub</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Presenting Results</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/creating_word_tables/creating_word_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Creating Tables with R and Microsoft Word</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#coerce-to-lowercase" id="toc-coerce-to-lowercase" class="nav-link active" data-scroll-target="#coerce-to-lowercase"><span class="header-section-number">29.1</span> Coerce to lowercase</a>
  <ul class="collapse">
  <li><a href="#lowercase" id="toc-lowercase" class="nav-link" data-scroll-target="#lowercase"><span class="header-section-number">29.1.1</span> Lowercase</a></li>
  <li><a href="#upper-case" id="toc-upper-case" class="nav-link" data-scroll-target="#upper-case"><span class="header-section-number">29.1.2</span> Upper case</a></li>
  <li><a href="#title-case" id="toc-title-case" class="nav-link" data-scroll-target="#title-case"><span class="header-section-number">29.1.3</span> Title case</a></li>
  <li><a href="#sentence-case" id="toc-sentence-case" class="nav-link" data-scroll-target="#sentence-case"><span class="header-section-number">29.1.4</span> Sentence case</a></li>
  </ul></li>
  <li><a href="#trim-white-space" id="toc-trim-white-space" class="nav-link" data-scroll-target="#trim-white-space"><span class="header-section-number">29.2</span> Trim white space</a></li>
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions"><span class="header-section-number">29.3</span> Regular expressions</a>
  <ul class="collapse">
  <li><a href="#remove-the-comma" id="toc-remove-the-comma" class="nav-link" data-scroll-target="#remove-the-comma"><span class="header-section-number">29.3.1</span> Remove the comma</a></li>
  <li><a href="#remove-middle-initial" id="toc-remove-middle-initial" class="nav-link" data-scroll-target="#remove-middle-initial"><span class="header-section-number">29.3.2</span> Remove middle initial</a></li>
  <li><a href="#remove-double-spaces" id="toc-remove-double-spaces" class="nav-link" data-scroll-target="#remove-double-spaces"><span class="header-section-number">29.3.3</span> Remove double spaces</a></li>
  </ul></li>
  <li><a href="#separate-values-into-component-parts" id="toc-separate-values-into-component-parts" class="nav-link" data-scroll-target="#separate-values-into-component-parts"><span class="header-section-number">29.4</span> Separate values into component parts</a></li>
  <li><a href="#dummy-variables" id="toc-dummy-variables" class="nav-link" data-scroll-target="#dummy-variables"><span class="header-section-number">29.5</span> Dummy variables</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/brad-cannell/r4epi_quarto/edit/main/chapters/working_with_character_strings/working_with_character_strings.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brad-cannell/r4epi_quarto/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/intro_data_management/introduction.html">Data Management</a></li><li class="breadcrumb-item"><a href="../../chapters/working_with_character_strings/working_with_character_strings.html"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Working with Character Strings</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Working with Character Strings</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!--
To upper, To lower, Title case
Separating words in character strings
Converting to dummy variables
Save reggex for advanced
Link to complete reggex
-->
<p>In previous chapters, we learned how to create character vectors, which can be useful on their own. We also learned how to coerce character vectors to factor vectors that we can use for categorical data analysis. However, up to this point, we haven‚Äôt done a lot of manipulation of the values stored inside of the character strings themselves. Sometimes, however, we will need to manipulate the character string before we can complete other data management tasks or analysis. Some common examples from my projects include separating character strings into multiple parts and creating dummy variables from character strings that can take multiple values. In this chapter, we‚Äôll see some specific example of both, and we‚Äôll learn a few new tools for working with character strings along the way.</p>
<p>To get started, feel free to <a href="https://github.com/brad-cannell/r4epi/blob/master/data/ehr.Rds">download the simulated electronic health record that we will use in the following examples</a>. Additionally, we will use the <code>readr</code>, <code>dplyr</code>, and <code>stringr</code> packages in the code below. You will be able to recognize functions from the <code>stringr</code> package because they will all begin with <code>str_</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 6
   admit_date          name               dob        address      city  symptoms
   &lt;dttm&gt;              &lt;chr&gt;              &lt;date&gt;     &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;   
 1 2017-02-01 05:22:30 "Zariah Hernandez" 1944-09-27 3201 ORANGE‚Ä¶ FORT‚Ä¶ "\"Pain‚Ä¶
 2 2017-04-08 09:17:17 "Tatum Chavez"     1952-06-12 1117 richmo‚Ä¶ Fort‚Ä¶ "Pain"  
 3 2017-04-18 09:17:17 "Tatum S Chavez"   1952-06-12 1117 richmo‚Ä¶ Fort‚Ä¶ "Pain"  
 4 2017-08-31 18:29:34 "Arabella George"  1966-06-15 357 Angle    FORT‚Ä¶ "\"Naus‚Ä¶
 5 2017-09-13 06:27:07 "Jasper Decker"    1954-05-11 3612 LAURA ‚Ä¶ FORT‚Ä¶ "\"Pain‚Ä¶
 6 2017-09-15 18:29:34 "ARABELLA GEORGE"  1966-06-15 357 Angle    FORT‚Ä¶ "\"Naus‚Ä¶
 7 2017-10-07 06:31:18 "Weston Fox"       2009-08-21 6433 HATCHE‚Ä¶ City‚Ä¶ "Pain"  
 8 2017-10-08 23:17:18 "Ryan Edwards"     1917-12-10 3201 HORIZO‚Ä¶ City‚Ä¶  &lt;NA&gt;   
 9 2017-10-16 06:31:18 "Weston Fox,"      2009-08-21 6433 HATCHE‚Ä¶ City‚Ä¶ "Pain"  
10 2017-10-26 23:17:18 "Ryan Edwards  "   1917-12-10 3201 HORIZO‚Ä¶ City‚Ä¶  &lt;NA&gt;   
11 2017-10-27 18:37:00 "Emma Medrano"     1975-05-01 6301 BEECHC‚Ä¶ KELL‚Ä¶ "\"Naus‚Ä¶
12 2017-12-18 20:47:48 "Ivy Mccann"       1911-06-21 5426 CHILDR‚Ä¶ FORT‚Ä¶ "\"Head‚Ä¶
13 2017-12-20 13:40:04 "Charlee Carroll"  1908-07-22 8190 DUCK C‚Ä¶ City‚Ä¶ "Headac‚Ä¶
14 2017-12-26 20:47:48 "Ivy   Mccann"     1911-06-21 5426 CHILDR‚Ä¶ FORT‚Ä¶ "\"Head‚Ä¶
15 2018-01-28 08:49:38 "Kane Martin"      1939-10-27 4929 asbury  FORT‚Ä¶  &lt;NA&gt;   </code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used the <code>read_csv()</code> function to import a .Rds file containing simulated data into R.</p></li>
<li><p>The simulated data contains admission date (<code>admit_date</code>), the patient‚Äôs name (<code>name</code>), the patient‚Äôs date of birth (<code>dob</code>), the patient‚Äôs address (<code>address</code>), the city the patient lives in (<code>city</code>), and column that contains the symptoms each patient was experiencing at admission (<code>symptoms</code>).</p></li>
<li><p>In this data, date of birth is recorded in the four most common formats that I typically come across.</p></li>
</ul>
<p>A common initial question we may need to ask of this kind of data is, <em>‚Äúhow many unique people are represented in this data?‚Äù</em> Well, there are 15 rows, so a good first guess might be 15 unique people. However, let‚Äôs arrange the data by the <code>name</code> column and see if that guess still looks reasonable.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 5
# Groups:   name [15]
   name               dup   dob        address             city              
   &lt;chr&gt;              &lt;lgl&gt; &lt;date&gt;     &lt;chr&gt;               &lt;chr&gt;             
 1 "ARABELLA GEORGE"  FALSE 1966-06-15 357 Angle           FORT WORTH        
 2 "Arabella George"  FALSE 1966-06-15 357 Angle           FORT WORTH        
 3 "Charlee Carroll"  FALSE 1908-07-22 8190 DUCK CREEK CT  City of Fort Worth
 4 "Emma Medrano"     FALSE 1975-05-01 6301 BEECHCREEK DR  KELLER            
 5 "Ivy   Mccann"     FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 6 "Ivy Mccann"       FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 7 "Jasper Decker"    FALSE 1954-05-11 3612 LAURA ANNE CT. FORT WORTH        
 8 "Kane Martin"      FALSE 1939-10-27 4929 asbury         FORT WORTH        
 9 "Ryan Edwards"     FALSE 1917-12-10 3201 HORIZON PL     City of Saginaw   
10 "Ryan Edwards  "   FALSE 1917-12-10 3201 HORIZON PL     City of Saginaw   
11 "Tatum Chavez"     FALSE 1952-06-12 1117 richmond ave   Fort Worth        
12 "Tatum S Chavez"   FALSE 1952-06-12 1117 richmond ave   Fort Worth        
13 "Weston Fox"       FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
14 "Weston Fox,"      FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
15 "Zariah Hernandez" FALSE 1944-09-27 3201 ORANGE AVE     FORT WORTH        </code></pre>
</div>
</div>
<p>Clearly, some of these people are the same. However, little data entry discrepancies in their name values would prevent us from calculating the number of unique people in a programmatic way. Let‚Äôs take a closer look at the values in the <code>name</code> column and see if we can figure out exactly what these data entry discrepancies are:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ARABELLA GEORGE"  "Arabella George"  "Charlee Carroll"  "Emma Medrano"    
 [5] "Ivy   Mccann"     "Ivy Mccann"       "Jasper Decker"    "Kane Martin"     
 [9] "Ryan Edwards"     "Ryan Edwards  "   "Tatum Chavez"     "Tatum S Chavez"  
[13] "Weston Fox"       "Weston Fox,"      "Zariah Hernandez"</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we <code>dplyr</code>‚Äôs <code>pull()</code> function to return the <code>name</code> column as a character vector. Doing so makes it easier to see some of the discrepancies in the way the patient‚Äôs names were entered into the ehr.</p></li>
<li><p>Notice that Arabella George‚Äôs name is written in title case one time and written in all caps another time. Remember that R is case sensitive. So, these two values ‚Äì ‚ÄúArabella George‚Äù and ‚ÄúARABELLA GEORGE‚Äù ‚Äì are different values to R.</p></li>
<li><p>Notice that in one instance of Ivy Mccann‚Äôs name someone accidently typed two spaces between her first and last name. These two values ‚Äì ‚ÄúIvy Mccann‚Äù and ‚ÄúIvy Mccann‚Äù ‚Äì are different values to R.</p></li>
<li><p>Notice that in one instance of Ryan Edwards‚Äô name someone accidently typed an extra space after his last name. These two values ‚Äì ‚ÄúRyan Edwards‚Äù and ‚ÄúRyan Edwards‚Äù ‚Äì are different values to R.</p></li>
<li><p>Notice that in one instance of Tatum Chavez‚Äôs name was entered into the ehr <em>with</em> his middle initial on one instance. These two values ‚Äì ‚ÄúTatum Chavez‚Äù and ‚ÄúTatum S Chavez‚Äù ‚Äì are different values to R.</p></li>
<li><p>Notice that Weston Fox‚Äôs name was entered into the ehr with a comma immediately following his last name on one instance. These two values ‚Äì ‚ÄúWeston Fox‚Äù and ‚ÄúWeston Fox,‚Äù ‚Äì are different values to R.</p></li>
</ul>
<section id="coerce-to-lowercase" class="level2" data-number="29.1">
<h2 data-number="29.1" class="anchored" data-anchor-id="coerce-to-lowercase"><span class="header-section-number">29.1</span> Coerce to lowercase</h2>
<p>A good place to start cleaning these character strings is by coercing them all to lowercase. We‚Äôve already used base R‚Äôs <code>tolower()</code> function a couple of times before. So, you may have already guessed how to complete this task. However, before moving on to coercing all the names in our ehr data to lowercase, we want to show you some of the other functions that the <code>stringr</code> package contains for changing the case of character strings. For example:</p>
<section id="lowercase" class="level3" data-number="29.1.1">
<h3 data-number="29.1.1" class="anchored" data-anchor-id="lowercase"><span class="header-section-number">29.1.1</span> Lowercase</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "arabella george"  "arabella george"  "charlee carroll"  "emma medrano"    
 [5] "ivy   mccann"     "ivy mccann"       "jasper decker"    "kane martin"     
 [9] "ryan edwards"     "ryan edwards  "   "tatum chavez"     "tatum s chavez"  
[13] "weston fox"       "weston fox,"      "zariah hernandez"</code></pre>
</div>
</div>
</section>
<section id="upper-case" class="level3" data-number="29.1.2">
<h3 data-number="29.1.2" class="anchored" data-anchor-id="upper-case"><span class="header-section-number">29.1.2</span> Upper case</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ARABELLA GEORGE"  "ARABELLA GEORGE"  "CHARLEE CARROLL"  "EMMA MEDRANO"    
 [5] "IVY   MCCANN"     "IVY MCCANN"       "JASPER DECKER"    "KANE MARTIN"     
 [9] "RYAN EDWARDS"     "RYAN EDWARDS  "   "TATUM CHAVEZ"     "TATUM S CHAVEZ"  
[13] "WESTON FOX"       "WESTON FOX,"      "ZARIAH HERNANDEZ"</code></pre>
</div>
</div>
</section>
<section id="title-case" class="level3" data-number="29.1.3">
<h3 data-number="29.1.3" class="anchored" data-anchor-id="title-case"><span class="header-section-number">29.1.3</span> Title case</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Arabella George"  "Arabella George"  "Charlee Carroll"  "Emma Medrano"    
 [5] "Ivy   Mccann"     "Ivy Mccann"       "Jasper Decker"    "Kane Martin"     
 [9] "Ryan Edwards"     "Ryan Edwards  "   "Tatum Chavez"     "Tatum S Chavez"  
[13] "Weston Fox"       "Weston Fox,"      "Zariah Hernandez"</code></pre>
</div>
</div>
</section>
<section id="sentence-case" class="level3" data-number="29.1.4">
<h3 data-number="29.1.4" class="anchored" data-anchor-id="sentence-case"><span class="header-section-number">29.1.4</span> Sentence case</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Arabella george"  "Arabella george"  "Charlee carroll"  "Emma medrano"    
 [5] "Ivy   mccann"     "Ivy mccann"       "Jasper decker"    "Kane martin"     
 [9] "Ryan edwards"     "Ryan edwards  "   "Tatum chavez"     "Tatum s chavez"  
[13] "Weston fox"       "Weston fox,"      "Zariah hernandez"</code></pre>
</div>
</div>
<p>Each of the function above can come in handy from time-to-time. So, you may just want to keep them in your back pocket. Let‚Äôs go ahead and use the <code>str_to_lower()</code> function now as the first step in cleaning our data:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 6
   admit_date          name               dob        address      city  symptoms
   &lt;dttm&gt;              &lt;chr&gt;              &lt;date&gt;     &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;   
 1 2017-02-01 05:22:30 "zariah hernandez" 1944-09-27 3201 ORANGE‚Ä¶ FORT‚Ä¶ "\"Pain‚Ä¶
 2 2017-04-08 09:17:17 "tatum chavez"     1952-06-12 1117 richmo‚Ä¶ Fort‚Ä¶ "Pain"  
 3 2017-04-18 09:17:17 "tatum s chavez"   1952-06-12 1117 richmo‚Ä¶ Fort‚Ä¶ "Pain"  
 4 2017-08-31 18:29:34 "arabella george"  1966-06-15 357 Angle    FORT‚Ä¶ "\"Naus‚Ä¶
 5 2017-09-13 06:27:07 "jasper decker"    1954-05-11 3612 LAURA ‚Ä¶ FORT‚Ä¶ "\"Pain‚Ä¶
 6 2017-09-15 18:29:34 "arabella george"  1966-06-15 357 Angle    FORT‚Ä¶ "\"Naus‚Ä¶
 7 2017-10-07 06:31:18 "weston fox"       2009-08-21 6433 HATCHE‚Ä¶ City‚Ä¶ "Pain"  
 8 2017-10-08 23:17:18 "ryan edwards"     1917-12-10 3201 HORIZO‚Ä¶ City‚Ä¶  &lt;NA&gt;   
 9 2017-10-16 06:31:18 "weston fox,"      2009-08-21 6433 HATCHE‚Ä¶ City‚Ä¶ "Pain"  
10 2017-10-26 23:17:18 "ryan edwards  "   1917-12-10 3201 HORIZO‚Ä¶ City‚Ä¶  &lt;NA&gt;   
11 2017-10-27 18:37:00 "emma medrano"     1975-05-01 6301 BEECHC‚Ä¶ KELL‚Ä¶ "\"Naus‚Ä¶
12 2017-12-18 20:47:48 "ivy mccann"       1911-06-21 5426 CHILDR‚Ä¶ FORT‚Ä¶ "\"Head‚Ä¶
13 2017-12-20 13:40:04 "charlee carroll"  1908-07-22 8190 DUCK C‚Ä¶ City‚Ä¶ "Headac‚Ä¶
14 2017-12-26 20:47:48 "ivy   mccann"     1911-06-21 5426 CHILDR‚Ä¶ FORT‚Ä¶ "\"Head‚Ä¶
15 2018-01-28 08:49:38 "kane martin"      1939-10-27 4929 asbury  FORT‚Ä¶  &lt;NA&gt;   </code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li>we used <code>stringr</code>‚Äôs <code>str_to_lower()</code> function to coerce all the letters in the <code>name</code> column to lowercase.</li>
</ul>
<p>Now, let‚Äôs check and see how many unique people R finds in our data?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 5
# Groups:   name [14]
   name               dup   dob        address             city              
   &lt;chr&gt;              &lt;lgl&gt; &lt;date&gt;     &lt;chr&gt;               &lt;chr&gt;             
 1 "arabella george"  FALSE 1966-06-15 357 Angle           FORT WORTH        
 2 "arabella george"  TRUE  1966-06-15 357 Angle           FORT WORTH        
 3 "charlee carroll"  FALSE 1908-07-22 8190 DUCK CREEK CT  City of Fort Worth
 4 "emma medrano"     FALSE 1975-05-01 6301 BEECHCREEK DR  KELLER            
 5 "ivy   mccann"     FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 6 "ivy mccann"       FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 7 "jasper decker"    FALSE 1954-05-11 3612 LAURA ANNE CT. FORT WORTH        
 8 "kane martin"      FALSE 1939-10-27 4929 asbury         FORT WORTH        
 9 "ryan edwards"     FALSE 1917-12-10 3201 HORIZON PL     City of Saginaw   
10 "ryan edwards  "   FALSE 1917-12-10 3201 HORIZON PL     City of Saginaw   
11 "tatum chavez"     FALSE 1952-06-12 1117 richmond ave   Fort Worth        
12 "tatum s chavez"   FALSE 1952-06-12 1117 richmond ave   Fort Worth        
13 "weston fox"       FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
14 "weston fox,"      FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
15 "zariah hernandez" FALSE 1944-09-27 3201 ORANGE AVE     FORT WORTH        </code></pre>
</div>
</div>
<p>In the output above, there are 15 rows. R has identified 1 row with a duplicate name (dup == TRUE), which results in a count of 14 unique people. So, simply coercing all the letters to lower case alone helped R figure out that there was a duplicate name value for arabella george. Next, let‚Äôs go ahead and remove the trailing space from Ryan Edwards‚Äô name.</p>
</section>
</section>
<section id="trim-white-space" class="level2" data-number="29.2">
<h2 data-number="29.2" class="anchored" data-anchor-id="trim-white-space"><span class="header-section-number">29.2</span> Trim white space</h2>
<p>we can use <code>stringr</code>‚Äôs <code>str_trim()</code> function to ‚Äútrim‚Äù white space from the beginning and end of character strings. For example:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ryan Edwards"</code></pre>
</div>
</div>
<p>Let‚Äôs go ahead and use the <code>str_trim()</code> function now as the next step in cleaning our data:</p>
<p>Now, let‚Äôs check and see how many unique people R finds in our data?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 5
# Groups:   name [13]
   name             dup   dob        address             city              
   &lt;chr&gt;            &lt;lgl&gt; &lt;date&gt;     &lt;chr&gt;               &lt;chr&gt;             
 1 arabella george  FALSE 1966-06-15 357 Angle           FORT WORTH        
 2 arabella george  TRUE  1966-06-15 357 Angle           FORT WORTH        
 3 charlee carroll  FALSE 1908-07-22 8190 DUCK CREEK CT  City of Fort Worth
 4 emma medrano     FALSE 1975-05-01 6301 BEECHCREEK DR  KELLER            
 5 ivy   mccann     FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 6 ivy mccann       FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 7 jasper decker    FALSE 1954-05-11 3612 LAURA ANNE CT. FORT WORTH        
 8 kane martin      FALSE 1939-10-27 4929 asbury         FORT WORTH        
 9 ryan edwards     FALSE 1917-12-10 3201 HORIZON PL     City of Saginaw   
10 ryan edwards     TRUE  1917-12-10 3201 HORIZON PL     City of Saginaw   
11 tatum chavez     FALSE 1952-06-12 1117 richmond ave   Fort Worth        
12 tatum s chavez   FALSE 1952-06-12 1117 richmond ave   Fort Worth        
13 weston fox       FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
14 weston fox,      FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
15 zariah hernandez FALSE 1944-09-27 3201 ORANGE AVE     FORT WORTH        </code></pre>
</div>
</div>
<p>In the output above, there are 15 rows. R has identified 2 rows with a duplicate name (dup == TRUE), which results in a count of 13 unique people. We‚Äôre getting closer. üëè However, the rest of the discrepancies in the <code>name</code> column that we want to address are a little more complicated. There isn‚Äôt a pre-made base R or <code>stringr</code> function that will fix them. Instead, we‚Äôll need to learn how to use something called <strong>regular expressions</strong>.</p>
</section>
<section id="regular-expressions" class="level2" data-number="29.3">
<h2 data-number="29.3" class="anchored" data-anchor-id="regular-expressions"><span class="header-section-number">29.3</span> Regular expressions</h2>
<p>Regular expressions, also called <strong>regex</strong> or <strong>regexps</strong>, can be really intimidating at first. In fact, I debated whether or not to even include a discussion of regular expressions at this point in the book. However, regular expressions are <em>the</em> most powerful and flexible tool for manipulating character strings that I are aware of. So, I think it‚Äôs important for you to get a little exposure to regular expressions, even if you aren‚Äôt a regular expressions expert by the end of this chapter.</p>
<p>The first time you see regular expressions, you will probably think they look like gibberish. For example, here‚Äôs a regular expression that I recently used to clean a data set <code>(\d{1,2}\/\d{1,2}\/\d{2})</code>. You can think of regular expressions as an entirely different programming language that the R interpreter can also understand. Regular expressions aren‚Äôt unique to R. Many programming languages can accept regular expressions as a way to manipulate character strings.</p>
<p>In the examples that follow, we hope<br>
1. To give you a feel for how regular expression can be useful.<br>
2. Provide you with some specific regular expressions that you may want to save for your epi work (or your class assignments).<br>
3. Provide you with some resources to help you take your regular expression skills to the next level when you are ready.</p>
<section id="remove-the-comma" class="level3" data-number="29.3.1">
<h3 data-number="29.3.1" class="anchored" data-anchor-id="remove-the-comma"><span class="header-section-number">29.3.1</span> Remove the comma</h3>
<p>For our first example, let‚Äôs remove the comma from Weston Fox‚Äôs last name.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "weston fox"</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>stringr</code>‚Äôs <code>str_replace()</code> function remove the comma from the character string ‚Äúweston fox,‚Äù.</p></li>
<li><p>The first argument to the <code>str_replace()</code> function is <code>string</code>. The value passed the <code>string</code> argument should be the character string, or vector of character strings, we want to manipulate.</p></li>
<li><p>The second argument to the <code>str_replace()</code> function is <code>pattern</code>. The value passed the <code>pattern</code> argument should be regular expression. It should tell the <code>str_replace()</code> function what part of the character string we want to replace. In this case, it is a comma (<code>","</code>). We are telling the <code>str_replace()</code> function that we want it to replace the first comma it sees in the character string ‚Äúweston fox,‚Äù with the value we pass to the <code>replacement</code> argument.</p></li>
<li><p>The third argument to the <code>str_replace()</code> function is <code>replacement</code>. The value passed the <code>replacement</code> argument should also be regular expression. It should tell the <code>str_replace()</code> function to what replace the value identified in the <code>pattern</code> argument with. In this case, it is nothing (<code>""</code>) ‚Äì two double quotes with nothing in-between. We are telling the <code>str_replace()</code> function that we want it to replace the first comma it sees in the character string ‚Äúweston fox,‚Äù with nothing. This is sort of a long-winded way of saying, ‚Äúdelete the comma.‚Äù</p></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>‚ö†Ô∏è<strong>Warning:</strong> Notice that our regular expressions above are wrapped in quotes. Regular expressions should always be wrapped in quotes.</p>
</div>
</div>
<p>Let‚Äôs go ahead and use the <code>str_replace()</code> function now as the next step in cleaning our data:</p>
<p>Now, let‚Äôs check and see how many unique people R finds in our data?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 5
# Groups:   name [12]
   name             dup   dob        address             city              
   &lt;chr&gt;            &lt;lgl&gt; &lt;date&gt;     &lt;chr&gt;               &lt;chr&gt;             
 1 arabella george  FALSE 1966-06-15 357 Angle           FORT WORTH        
 2 arabella george  TRUE  1966-06-15 357 Angle           FORT WORTH        
 3 charlee carroll  FALSE 1908-07-22 8190 DUCK CREEK CT  City of Fort Worth
 4 emma medrano     FALSE 1975-05-01 6301 BEECHCREEK DR  KELLER            
 5 ivy   mccann     FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 6 ivy mccann       FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 7 jasper decker    FALSE 1954-05-11 3612 LAURA ANNE CT. FORT WORTH        
 8 kane martin      FALSE 1939-10-27 4929 asbury         FORT WORTH        
 9 ryan edwards     FALSE 1917-12-10 3201 HORIZON PL     City of Saginaw   
10 ryan edwards     TRUE  1917-12-10 3201 HORIZON PL     City of Saginaw   
11 tatum chavez     FALSE 1952-06-12 1117 richmond ave   Fort Worth        
12 tatum s chavez   FALSE 1952-06-12 1117 richmond ave   Fort Worth        
13 weston fox       FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
14 weston fox       TRUE  2009-08-21 6433 HATCHER ST     City of Fort Worth
15 zariah hernandez FALSE 1944-09-27 3201 ORANGE AVE     FORT WORTH        </code></pre>
</div>
</div>
<p>In the output above, there are 15 rows. R has identified 3 rows with a duplicate name (dup == TRUE), which results in a count of 12 unique people.</p>
</section>
<section id="remove-middle-initial" class="level3" data-number="29.3.2">
<h3 data-number="29.3.2" class="anchored" data-anchor-id="remove-middle-initial"><span class="header-section-number">29.3.2</span> Remove middle initial</h3>
<p>Next, let‚Äôs remove the middle initial from Tatum Chavez‚Äôs name.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tatum chavez"</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>stringr</code>‚Äôs <code>str_replace()</code> function remove the ‚Äús‚Äù from the character string ‚Äútatum s chavez‚Äù.</p></li>
<li><p>The first argument to the <code>str_replace()</code> function is <code>string</code>. The value passed the <code>string</code> argument should be the character string, or vector of character strings, we want to manipulate.</p></li>
<li><p>The second argument to the <code>str_replace()</code> function is <code>pattern</code>. The value passed the <code>pattern</code> argument should be regular expression. It should tell the <code>str_replace()</code> function what part of the character string we want to replace. In this case, it is <code>" \\w "</code>. That is a space, two backslashes, a ‚Äúw,‚Äù and a space. This regular expression looks a little stranger than the last one we saw.</p>
<ul>
<li><p>The <code>\w</code> is called a <strong>token</strong> in regular expression lingo. The <code>\w</code> token means ‚ÄúAny word character.‚Äù Any word character includes all the letters of the alphabet upper and lowercase (i.e., <code>[a-zA-Z]</code>), all numbers (i.e., <code>[0-9</code>]), and the underscore character (<code>_</code>).</p></li>
<li><p>When passing regular expression to R, we must always add an additional backslash in front of any other backslash in the regular expression. In this case, <code>\\w</code> instead of <code>\w</code>.</p></li>
<li><p>If we had stopped here (<code>"\\w"</code>), this regular expression would have told the <code>str_replace()</code> function that we want it to replace the first word character it sees in the character string ‚Äútatum s chavez‚Äù with the value we pass to the <code>replacement</code> argument. In this case, that would have been the ‚Äút‚Äù at the beginning of ‚Äútatum s chavez‚Äù.</p></li>
<li><p>The final component of the regular expression we passed to the <code>pattern</code> argument is spaces on both sides of the <code>\\w</code> token. The complete regular expression, <code>" \\w "</code>, tells the <code>str_replace()</code> function that we want it to replace the first time it sees a space, followed by any word character, followed by another space in the character string ‚Äútatum s chavez‚Äù with the value we pass to the <code>replacement</code> argument. The first section of the character string above that matches that pattern is the ‚Äù s ‚Äù in ‚Äútatum s chavez‚Äù.</p></li>
</ul></li>
<li><p>The third argument to the <code>str_replace()</code> function is <code>replacement</code>. The value passed the <code>replacement</code> argument should also be regular expression. It should tell the <code>str_replace()</code> function what to replace the value identified in the <code>pattern</code> argument with. In this case, it is a single space (<code>" "</code>).</p></li>
</ul>
<p>Let‚Äôs go ahead and use the <code>str_replace()</code> function now as the next step in cleaning our data:</p>
<p>And, let‚Äôs once again check and see how many unique people R finds in our data?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 5
# Groups:   name [11]
   name             dup   dob        address             city              
   &lt;chr&gt;            &lt;lgl&gt; &lt;date&gt;     &lt;chr&gt;               &lt;chr&gt;             
 1 arabella george  FALSE 1966-06-15 357 Angle           FORT WORTH        
 2 arabella george  TRUE  1966-06-15 357 Angle           FORT WORTH        
 3 charlee carroll  FALSE 1908-07-22 8190 DUCK CREEK CT  City of Fort Worth
 4 emma medrano     FALSE 1975-05-01 6301 BEECHCREEK DR  KELLER            
 5 ivy   mccann     FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 6 ivy mccann       FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 7 jasper decker    FALSE 1954-05-11 3612 LAURA ANNE CT. FORT WORTH        
 8 kane martin      FALSE 1939-10-27 4929 asbury         FORT WORTH        
 9 ryan edwards     FALSE 1917-12-10 3201 HORIZON PL     City of Saginaw   
10 ryan edwards     TRUE  1917-12-10 3201 HORIZON PL     City of Saginaw   
11 tatum chavez     FALSE 1952-06-12 1117 richmond ave   Fort Worth        
12 tatum chavez     TRUE  1952-06-12 1117 richmond ave   Fort Worth        
13 weston fox       FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
14 weston fox       TRUE  2009-08-21 6433 HATCHER ST     City of Fort Worth
15 zariah hernandez FALSE 1944-09-27 3201 ORANGE AVE     FORT WORTH        </code></pre>
</div>
</div>
<p>In the output above, there are 15 rows. R has identified 4 rows with a duplicate name (dup == TRUE), which results in a count of 11 unique people.</p>
</section>
<section id="remove-double-spaces" class="level3" data-number="29.3.3">
<h3 data-number="29.3.3" class="anchored" data-anchor-id="remove-double-spaces"><span class="header-section-number">29.3.3</span> Remove double spaces</h3>
<p>Finally, let‚Äôs remove the double space from Ivy Mccann‚Äôs name.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ivy Mccann"</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>stringr</code>‚Äôs <code>str_replace()</code> function remove the double space from the character string ‚ÄúIvy Mccann‚Äù.</p></li>
<li><p>The first argument to the <code>str_replace()</code> function is <code>string</code>. The value passed the <code>string</code> argument should be the character string, or vector of character strings, we want to manipulate.</p></li>
<li><p>The second argument to the <code>str_replace()</code> function is <code>pattern</code>. The value passed the <code>pattern</code> argument should be regular expression. It should tell the <code>str_replace()</code> function what part of the character string we want to replace. In this case, it is <code>\\s{2,}</code>. This regular expression looks even more strange than the last one we saw.</p>
<ul>
<li><p>The <code>\s</code> is another token. The <code>\s</code> token means ‚ÄúAny whitespace character.‚Äù</p></li>
<li><p>When passing regular expression to R, we must always add an additional backslash in front of any other backslash in the regular expression. In this case, <code>\\s</code> instead of <code>\s</code>.</p></li>
<li><p>The curly braces with numbers inside is called a <strong>quantifier</strong> in regular expression lingo. The first number inside the curly braces tells <code>str_replace()</code> to look for <em>at least</em> this many occurrences of whatever is immediately before the curly braces in the regular expression. The second number inside the curly braces tells <code>str_replace()</code> to look for <em>no more than</em> this many occurrences of whatever is immediately before the curly braces in the regular expression. When there is no number in the first position, that means that there is no minimum number of occurrences that count. When there is no number is the second position, that means that there is no upper limit of occurrences that count. In this case, the thing immediately before the curly braces in the regular expression was a whitespace (<code>\\s</code>), and the <code>{2,}</code> tells <code>str_replace()</code> to look for between 2 and unlimited consecutive occurrences of whitespace.</p></li>
</ul></li>
<li><p>The third argument to the <code>str_replace()</code> function is <code>replacement</code>. The value passed the <code>replacement</code> argument should also be regular expression. It should tell the <code>str_replace()</code> function what to replace the value identified in the <code>pattern</code> argument with. In this case, it is a single space (<code>" "</code>).</p></li>
</ul>
<p>Let‚Äôs go ahead and use the <code>str_replace()</code> function now as the final step in cleaning our <code>name</code> column:</p>
<p>Let‚Äôs check one final time to see how many unique people R finds in our data.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 5
# Groups:   name [10]
   name             dup   dob        address             city              
   &lt;chr&gt;            &lt;lgl&gt; &lt;date&gt;     &lt;chr&gt;               &lt;chr&gt;             
 1 arabella george  FALSE 1966-06-15 357 Angle           FORT WORTH        
 2 arabella george  TRUE  1966-06-15 357 Angle           FORT WORTH        
 3 charlee carroll  FALSE 1908-07-22 8190 DUCK CREEK CT  City of Fort Worth
 4 emma medrano     FALSE 1975-05-01 6301 BEECHCREEK DR  KELLER            
 5 ivy mccann       FALSE 1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 6 ivy mccann       TRUE  1911-06-21 5426 CHILDRESS ST   FORT WORTH        
 7 jasper decker    FALSE 1954-05-11 3612 LAURA ANNE CT. FORT WORTH        
 8 kane martin      FALSE 1939-10-27 4929 asbury         FORT WORTH        
 9 ryan edwards     FALSE 1917-12-10 3201 HORIZON PL     City of Saginaw   
10 ryan edwards     TRUE  1917-12-10 3201 HORIZON PL     City of Saginaw   
11 tatum chavez     FALSE 1952-06-12 1117 richmond ave   Fort Worth        
12 tatum chavez     TRUE  1952-06-12 1117 richmond ave   Fort Worth        
13 weston fox       FALSE 2009-08-21 6433 HATCHER ST     City of Fort Worth
14 weston fox       TRUE  2009-08-21 6433 HATCHER ST     City of Fort Worth
15 zariah hernandez FALSE 1944-09-27 3201 ORANGE AVE     FORT WORTH        </code></pre>
</div>
</div>
<p>In the output above, there are 15 rows. R has identified 5 rows with a duplicate name (dup == TRUE), which results in a count of 10 unique people. This is the answer we wanted! üëè</p>
<p>If our data frame was too big to count unique people manually, we could have R calculate the number of unique people for us like this:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 1
  `Unique People`
            &lt;int&gt;
1              10</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>With the exception of <code>filter(row_number() == 1)</code>, you should have seen all of the elements in the code above before.</p></li>
<li><p>we saw the <code>row_number()</code> function used before inside of <code>mutate()</code> to sequentially count the number of rows that belong to each group created with <code>group_by()</code>. We could have done that in the code above. The <code>filter(row_number() == 1)</code> code is really just a shorthand way to write <code>mutate(row = row_number()) %&gt;% filter(row == 1)</code>. It has the effect of telling R to just keep the first row for each group created by <code>group_by()</code>. In this case, just keep the first row for each name in the data frame.</p></li>
</ul>
<p>Now that we know how many unique people are in our data, let‚Äôs say we want to know how many of them live in each city that our data contains.</p>
<p>First, we will subset our data to include one row only for each person:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 6
   admit_date          name             dob        address        city  symptoms
   &lt;dttm&gt;              &lt;chr&gt;            &lt;date&gt;     &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;   
 1 2017-02-01 05:22:30 zariah hernandez 1944-09-27 3201 ORANGE A‚Ä¶ FORT‚Ä¶ "\"Pain‚Ä¶
 2 2017-04-08 09:17:17 tatum chavez     1952-06-12 1117 richmond‚Ä¶ Fort‚Ä¶ "Pain"  
 3 2017-08-31 18:29:34 arabella george  1966-06-15 357 Angle      FORT‚Ä¶ "\"Naus‚Ä¶
 4 2017-09-13 06:27:07 jasper decker    1954-05-11 3612 LAURA AN‚Ä¶ FORT‚Ä¶ "\"Pain‚Ä¶
 5 2017-10-07 06:31:18 weston fox       2009-08-21 6433 HATCHER ‚Ä¶ City‚Ä¶ "Pain"  
 6 2017-10-08 23:17:18 ryan edwards     1917-12-10 3201 HORIZON ‚Ä¶ City‚Ä¶  &lt;NA&gt;   
 7 2017-10-27 18:37:00 emma medrano     1975-05-01 6301 BEECHCRE‚Ä¶ KELL‚Ä¶ "\"Naus‚Ä¶
 8 2017-12-18 20:47:48 ivy mccann       1911-06-21 5426 CHILDRES‚Ä¶ FORT‚Ä¶ "\"Head‚Ä¶
 9 2017-12-20 13:40:04 charlee carroll  1908-07-22 8190 DUCK CRE‚Ä¶ City‚Ä¶ "Headac‚Ä¶
10 2018-01-28 08:49:38 kane martin      1939-10-27 4929 asbury    FORT‚Ä¶  &lt;NA&gt;   </code></pre>
</div>
</div>
<p>Let‚Äôs go ahead and get an initial count of how many people live in each city:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 2
  city                   n
  &lt;chr&gt;              &lt;int&gt;
1 City of Fort Worth     3
2 City of Saginaw        2
3 FORT WORTH             7
4 Fort Worth             2
5 KELLER                 1</code></pre>
</div>
</div>
<p>I‚Äôm sure you saw this coming, but we have more data entry discrepancies that are preventing us from completing our analysis. Now that you‚Äôve gotten your feet wet with character string manipulation and regular expressions, what do we need to do in order to complete our analysis?</p>
<p>Hopefully, your first instinct by now is to coerce all the letters to lowercase. In fact, one of the first things we typically do is coerce all character columns to lowercase. Let‚Äôs do that now.</p>
<p>Now how many people live in each city?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 2
  city                   n
  &lt;chr&gt;              &lt;int&gt;
1 city of fort worth     3
2 city of saginaw        2
3 fort worth             9
4 keller                 1</code></pre>
</div>
</div>
<p>we‚Äôre getting closer to the right answer, but we still need to remove ‚Äúcity of‚Äù from some of the values. This sounds like another job for <code>str_replace()</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "fort worth"</code></pre>
</div>
</div>
<p>That regular expression looks like it will work. Let‚Äôs go ahead and use it to remove ‚Äúcity of‚Äù from the values in the <code>address_city</code> column now.</p>
<p>One last time, how many people live in each city?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 2
  city           n
  &lt;chr&gt;      &lt;int&gt;
1 fort worth    12
2 keller         1
3 saginaw        2</code></pre>
</div>
</div>
</section>
</section>
<section id="separate-values-into-component-parts" class="level2" data-number="29.4">
<h2 data-number="29.4" class="anchored" data-anchor-id="separate-values-into-component-parts"><span class="header-section-number">29.4</span> Separate values into component parts</h2>
<p>Another common task that I perform on character strings is to separate the strings into multiple parts. For example, sometimes we may want to separate full names into two columns. One for fist name and one for last name. To complete this task, we will once again use regular expressions. We will also learn how to use the <code>str_extract()</code> function to pull values out of a character string when the match a pattern we create with a regular expression.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "zariah"</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>stringr</code>‚Äôs <code>str_extract()</code> function pull the first name out of the full name ‚Äúzariah hernandez‚Äù.</p></li>
<li><p>The first argument to the <code>str_extract()</code> function is <code>string</code>. The value passed the <code>string</code> argument should be the character string, or vector of character strings, we want to manipulate.</p></li>
<li><p>The second argument to the <code>str_extract()</code> function is <code>pattern</code>. The value passed the <code>pattern</code> argument should be regular expression. It should tell the <code>str_extract()</code> function what part of the character string we want to pull out of the character string. In this case, it is <code>^\\w+</code>.</p>
<ul>
<li><p>we‚Äôve already seen that the <code>\w</code> token means ‚ÄúAny word character.‚Äù</p></li>
<li><p>When passing regular expression to R, we must always add an additional backslash in front of any other backslash in the regular expression. In this case, <code>\\w</code> instead of <code>\w</code>.</p></li>
<li><p>The carrot (<code>^</code>) is a type of <strong>anchor</strong> in regular expression lingo. It tells the <code>str_extract()</code> function to look for the pattern at the start of the character sting only.</p></li>
<li><p>The plus sign (<code>+</code>) is another quantifier. It means, ‚Äúmatch the pattern one or more times.‚Äù</p></li>
<li><p>Taken together, <code>^\\w+</code> tells the <code>str_extract()</code> function to look for one or more consecutive word characters beginning at the start of the character string and extract them.</p></li>
<li><p>The first word character at the start of the string is ‚Äúz‚Äù, then ‚Äúa‚Äù, then ‚Äúriah‚Äù. Finally, R gets to the space between ‚Äúzariah‚Äù and ‚Äúhernandez‚Äù, which isn‚Äôt a word character, and stops the extraction. The result is ‚Äúzariah‚Äù.</p></li>
</ul></li>
</ul>
<p>we can pull the last name from the character string in a similar way:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hernandez"</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>stringr</code>‚Äôs <code>str_extract()</code> function pull the last name out of the full name ‚Äúzariah hernandez‚Äù.</p></li>
<li><p>The first argument to the <code>str_extract()</code> function is <code>string</code>. The value passed the <code>string</code> argument should be the character string, or vector of character strings, we want to manipulate.</p></li>
<li><p>The second argument to the <code>str_extract()</code> function is <code>pattern</code>. The value passed the <code>pattern</code> argument should be regular expression. It should tell the <code>str_extract()</code> function what part of the character string we want to pull out of the character string. In this case, it is <code>\\w+$</code>.</p>
<ul>
<li><p>we‚Äôve already seen that the <code>\w</code> token means ‚ÄúAny word character.‚Äù</p></li>
<li><p>When passing regular expression to R, we must always add an additional backslash in front of any other backslash in the regular expression. In this case, <code>\\w</code> instead of <code>\w</code>.</p></li>
<li><p>The dollar sign (<code>$</code>) is another type of anchor. It tells the <code>str_extract()</code> function to look for the pattern at the end of the string only.</p></li>
<li><p>we‚Äôve already seen that the plus sign (<code>+</code>) is a quantifier that means, ‚Äúmatch the pattern one or more times.‚Äù</p></li>
</ul>
<p>-Taken together, <code>\\w+$</code> tells the <code>str_extract()</code> function to look for one or more consecutive word characters beginning at the end of the string and extract them.</p>
<ul>
<li>The first word character at the end of the string is ‚Äúz‚Äù, then ‚Äúe‚Äù, then ‚Äúdnanreh‚Äù. Finally, R gets to the space between ‚Äúzariah‚Äù and ‚Äúhernandez‚Äù, which isn‚Äôt a word character, and stops the extraction. The result is ‚Äúhernandez‚Äù.</li>
</ul></li>
</ul>
<p>Now, let‚Äôs use <code>str_extract()</code> to separate full name into <code>name_first</code> and <code>name_last</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 3
   name             name_first name_last
   &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;    
 1 zariah hernandez zariah     hernandez
 2 tatum chavez     tatum      chavez   
 3 tatum chavez     tatum      chavez   
 4 arabella george  arabella   george   
 5 jasper decker    jasper     decker   
 6 arabella george  arabella   george   
 7 weston fox       weston     fox      
 8 ryan edwards     ryan       edwards  
 9 weston fox       weston     fox      
10 ryan edwards     ryan       edwards  
11 emma medrano     emma       medrano  
12 ivy mccann       ivy        mccann   
13 charlee carroll  charlee    carroll  
14 ivy mccann       ivy        mccann   
15 kane martin      kane       martin   </code></pre>
</div>
</div>
<p>The regular expressions we used in the examples above weren‚Äôt super complex. We hope that leaves you feeling like you can use regular expression to complete data cleaning tasks that are actually useful, even if you haven‚Äôt totally mastered them yet (I haven‚Äôt totally mastered them either).</p>
<p>Before moving on, we want to introduce you to a free tool I use when I have to do more complex character string manipulations with regular expressions. It is the <a href="https://regex101.com/#python">regular expressions 101 online regex tester and debugger</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regex101.png" class="img-fluid figure-img" width="900"></p>
</figure>
</div>
</div>
</div>
<p>In the screenshot above, I highlight some of the really cool features of the regex tester and debugger.</p>
<ul>
<li><p>First, you can use the regex tester without logging in. However, I typically do log in because that allows me to save regular expressions and use them again later.</p></li>
<li><p>The top input box on the screen corresponds to what you would type into the <code>pattern</code> argument of the <code>str_replace()</code> function.</p></li>
<li><p>The middle input box on the screen corresponds to what you would type into the <code>string</code> argument of the <code>str_replace()</code> function.</p></li>
<li><p>The third input box on the screen corresponds to what you would type into the <code>replacement</code> argument of the <code>str_replace()</code> function, and the results are presented below.</p></li>
<li><p>In addition, the regex tester and debugger has a quick reference pane that allows you to lookup different elements you might want to use in your regular expression. It also has an explanation pane that tells you what each of the elements in the current regular expression you typed out mean.</p></li>
</ul>
</section>
<section id="dummy-variables" class="level2" data-number="29.5">
<h2 data-number="29.5" class="anchored" data-anchor-id="dummy-variables"><span class="header-section-number">29.5</span> Dummy variables</h2>
<p>Data collection tools in epidemiology often include ‚Äúcheck all that apply‚Äù questions. In our <code>ehr</code> example data, patients were asked about what symptoms they were experiencing at admission. The choices were pain, headache, and nausea. They were allowed to check any combination of the three that they wanted. That results in a <code>symptoms</code> column in our data frame that looks like this:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>üóí<strong>Side Note:</strong> Any categorical variable can be transformed into dummy variables. Not just the variables that result from ‚Äúcheck all that apply‚Äù survey questions. However, the ‚Äúcheck all that apply‚Äù survey questions often require extra data cleaning steps relative to categorical variables that can only take a single value in each row.</p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 3
   name_first name_last symptoms                            
   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;                               
 1 zariah     hernandez "\"Pain\", \"Headache\", \"Nausea\""
 2 tatum      chavez    "Pain"                              
 3 tatum      chavez    "Pain"                              
 4 arabella   george    "\"Nausea\", \"Headache\""          
 5 jasper     decker    "\"Pain\", \"Headache\""            
 6 arabella   george    "\"Nausea\", \"Headache\""          
 7 weston     fox       "Pain"                              
 8 ryan       edwards    &lt;NA&gt;                               
 9 weston     fox       "Pain"                              
10 ryan       edwards    &lt;NA&gt;                               
11 emma       medrano   "\"Nausea\", \"Headache\""          
12 ivy        mccann    "\"Headache\", \"Pain\", \"Nausea\""
13 charlee    carroll   "Headache"                          
14 ivy        mccann    "\"Headache\", \"Pain\", \"Nausea\""
15 kane       martin     &lt;NA&gt;                               </code></pre>
</div>
</div>
<p>Notice that some people didn‚Äôt report their symptoms (<code>NA</code>), some people reported only one symptom, and some people reported multiple symptoms. The way the data is currently formatted is not ideal for analysis. For example, if I asked you to tell me how many people ever came in complaining of headache, how would you do that? Maybe like this:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 √ó 2
  symptoms                                 n
  &lt;chr&gt;                                &lt;int&gt;
1 "\"Headache\", \"Pain\", \"Nausea\""     2
2 "\"Nausea\", \"Headache\""               3
3 "\"Pain\", \"Headache\""                 1
4 "\"Pain\", \"Headache\", \"Nausea\""     1
5 "Headache"                               1
6 "Pain"                                   4
7  &lt;NA&gt;                                    3</code></pre>
</div>
</div>
<p>In this case, you could probably count manually and get the right answer. But what if we had many more possible symptoms and many more rows. Counting would quickly become tedious and error prone. The solution is to create dummy variables. We can create dummy variables like this:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 4
   symptoms                             pain  headache nausea
   &lt;chr&gt;                                &lt;lgl&gt; &lt;lgl&gt;    &lt;lgl&gt; 
 1 "\"Pain\", \"Headache\", \"Nausea\"" TRUE  TRUE     TRUE  
 2 "Pain"                               TRUE  FALSE    FALSE 
 3 "Pain"                               TRUE  FALSE    FALSE 
 4 "\"Nausea\", \"Headache\""           FALSE TRUE     TRUE  
 5 "\"Pain\", \"Headache\""             TRUE  TRUE     FALSE 
 6 "\"Nausea\", \"Headache\""           FALSE TRUE     TRUE  
 7 "Pain"                               TRUE  FALSE    FALSE 
 8  &lt;NA&gt;                                NA    NA       NA    
 9 "Pain"                               TRUE  FALSE    FALSE 
10  &lt;NA&gt;                                NA    NA       NA    
11 "\"Nausea\", \"Headache\""           FALSE TRUE     TRUE  
12 "\"Headache\", \"Pain\", \"Nausea\"" TRUE  TRUE     TRUE  
13 "Headache"                           FALSE TRUE     FALSE 
14 "\"Headache\", \"Pain\", \"Nausea\"" TRUE  TRUE     TRUE  
15  &lt;NA&gt;                                NA    NA       NA    </code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>stringr</code>‚Äôs <code>str_detect()</code> function create three new dummy variables in our data frame.</p></li>
<li><p>The first argument to the <code>str_detect()</code> function is <code>string</code>. The value passed the <code>string</code> argument should be the character string, or vector of character stings, we want to manipulate.</p></li>
<li><p>The second argument to the <code>str_detect()</code> function is <code>pattern</code>. The value passed the <code>pattern</code> argument should be regular expression. The <code>str_detect()</code> function returns <code>TRUE</code> if it finds the pattern in the string and <code>FALSE</code> if it does not find the pattern in the string.</p></li>
<li><p>Instead of having a single <code>symptoms</code> column that can take different combinations of the values <code>pain</code>, <code>headache</code>, and <code>nausea</code>, we create a new column for each value ‚Äì the so-called dummy variables.</p></li>
<li><p>Each dummy variable can take the value <code>TRUE</code>, <code>FALSE</code>, or <code>NA</code>. The value for each dummy variable is <code>TRUE</code> in rows were that symptom was reported and <code>FALSE</code> in rows where the symptom was not reported. For example, the value in the first row of the <code>pain</code> column is <code>TRUE</code> because the value in the first row of <code>symptoms</code> column (‚ÄúPain‚Äù, ‚ÄúHeadache‚Äù, ‚ÄúNausea‚Äù) includes ‚ÄúPain‚Äù. However, the value in the fourth row of the <code>pain</code> column is <code>FALSE</code> because the value in the fourth row of <code>symptoms</code> column (‚ÄúNausea‚Äù, ‚ÄúHeadache‚Äù) does not include ‚ÄúPain‚Äù.</p></li>
</ul>
<p>Now, we can much more easily figure out how many people had each symptom.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
    4     8 </code></pre>
</div>
</div>
<p>we should acknowledge that dummy variables typically take the values 0 and 1 instead of FALSE and TRUE. We can easily coerce our dummy variable values to 0/1 using the <code>as.numeric()</code> function. For example:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 2
   pain  pain_01
   &lt;lgl&gt;   &lt;dbl&gt;
 1 TRUE        1
 2 TRUE        1
 3 TRUE        1
 4 FALSE       0
 5 TRUE        1
 6 FALSE       0
 7 TRUE        1
 8 NA         NA
 9 TRUE        1
10 NA         NA
11 FALSE       0
12 TRUE        1
13 FALSE       0
14 TRUE        1
15 NA         NA</code></pre>
</div>
</div>
<p>However, this step is sort of unnecessary in most cases because R treats <code>TRUE</code> and <code>FALSE</code> as <code>1</code> and <code>0</code> respectively when logical (i.e., TRUE/FALSE) vectors are passed to functions or operators that perform a mathematical operation.</p>
<p>That concludes the chapter on working with character strings. Don‚Äôt beat yourself up if you‚Äôre feeling confused about regular expressions. They are really tough to wrap your head around at first! But, at least now you know they exist and can be useful for manipulating character strings. If you come across more complicated situations in the future, we suggest starting by checking out the <a href="https://stringr.tidyverse.org/index.html">stringr cheat sheet</a> and practicing with the <a href="https://regex101.com/#python">regular expressions 101 online regex tester and debugger</a> before writing any R code.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/brad-cannell\.github\.io\/r4epi_quarto\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/working_with_dates/working_with_dates.html" class="pagination-link" aria-label="Working with Dates">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Working with Dates</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/conditional_operations/conditional_operations.html" class="pagination-link" aria-label="Conditional Operations">
        <span class="nav-page-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Conditional Operations</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>R for Epidemiology</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/brad-cannell/r4epi_quarto/edit/main/chapters/working_with_character_strings/working_with_character_strings.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brad-cannell/r4epi_quarto/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://Quarto/.org/">Quarto/</a>.</p>
</div>
  </div>
</footer>




</body></html>