<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>30&nbsp; Conditional Operations ‚Äì R 4 Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/multiple_data_frames/multiple_data_frames.html" rel="next">
<link href="../../chapters/working_with_character_strings/working_with_character_strings.html" rel="prev">
<link href="../../r4epi_favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-0RREBTQ0D9"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-0RREBTQ0D9', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/intro_data_management/introduction.html">Data Management</a></li><li class="breadcrumb-item"><a href="../../chapters/conditional_operations/conditional_operations.html"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Conditional Operations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">R 4 Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/brad-cannell/r4epi" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../R-4-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/contributing/contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/about_the_authors/about_the_authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the Authors</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/installing_r_and_rstudio/installing_r_and_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Installing R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/what_is_r/what_is_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">What is R?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/navigating_rstudio/navigating_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Navigating the RStudio Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/speaking_r/speaking_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Speaking R‚Äôs Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/lets_get_programming/lets_get_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Let‚Äôs Get Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/asking_questions/asking_questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Asking Questions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Coding Tools and Best Practices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/r_scripts/r_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Scripts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/quarto_files/quarto_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quarto Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/r_projects/projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R Projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/best_practices/best_practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Coding Best Practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_pipes/using_pipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Using Pipes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Transfer</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/data_transfer/data_transfer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Data Transfer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/file_paths/file_paths.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">File Paths</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/importing_plain_text/importing_plain_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Importing Plain Text Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/importing_binary_files/importing_binary_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Importing Binary Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/rstudio_import_tool/rstudio_import_tool.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">RStudio‚Äôs Data Import Tool</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/exporting_data_to_disk/exporting_data_to_disk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Exporting Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Descriptive Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_descriptive_analysis/intro_descriptive_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Descriptive Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/categorical_variables/categorical_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Numerical Descriptions of Categorical Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/central_tendency/central_tendency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Measures of Central Tendency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dispersion/dispersion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Measures of Dispersion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cont_out_cont_pred/cont_out_cont_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Continuous Outcome and a Continuous Predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cont_out_cat_pred/cont_out_cat_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Continuous Outcome and a Categorical Predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cat_out_cat_pred/cat_out_cat_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Categorical Outcome and a Categorical Predictor</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_data_management/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Introduction to Data Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/creating_and_modifying_columns/creating_and_modifying_columns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Creating and Modifying Columns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/subsetting_data_frames/subsetting_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Subsetting Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/working_with_dates/working_with_dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/working_with_character_strings/working_with_character_strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Working with Character Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/conditional_operations/conditional_operations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Conditional Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/multiple_data_frames/multiple_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Working with Multiple Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/restructuring_data_frames/restructuring_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Restructuring Data frames</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Repeated Operations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_repeated_operations/intro_repeated_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Introduction to Repeated Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/writing_functions/writing_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dplyr_column_wise/dplyr_column_wise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Column-wise Operations in dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/writing_for_loops/writing_for_loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Writing For Loops</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_purrr/using_purrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Using the purrr Package</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Collaboration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_git_github/intro_git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Introduction to git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_git_github/using_git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Using git and GitHub</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Presenting Results</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/creating_word_tables/creating_word_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Creating Tables with R and Microsoft Word</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#operands-and-operators" id="toc-operands-and-operators" class="nav-link active" data-scroll-target="#operands-and-operators"><span class="header-section-number">30.1</span> Operands and operators</a></li>
  <li><a href="#testing-multiple-conditions-simultaneously" id="toc-testing-multiple-conditions-simultaneously" class="nav-link" data-scroll-target="#testing-multiple-conditions-simultaneously"><span class="header-section-number">30.2</span> Testing multiple conditions simultaneously</a></li>
  <li><a href="#testing-a-sequence-of-conditions" id="toc-testing-a-sequence-of-conditions" class="nav-link" data-scroll-target="#testing-a-sequence-of-conditions"><span class="header-section-number">30.3</span> Testing a sequence of conditions</a></li>
  <li><a href="#recoding-variables" id="toc-recoding-variables" class="nav-link" data-scroll-target="#recoding-variables"><span class="header-section-number">30.4</span> Recoding variables</a></li>
  <li><a href="#case_when-is-lazy" id="toc-case_when-is-lazy" class="nav-link" data-scroll-target="#case_when-is-lazy"><span class="header-section-number">30.5</span> case_when() is lazy</a></li>
  <li><a href="#recode-missing" id="toc-recode-missing" class="nav-link" data-scroll-target="#recode-missing"><span class="header-section-number">30.6</span> Recode missing</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/brad-cannell/r4epi/edit/main/chapters/conditional_operations/conditional_operations.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brad-cannell/r4epi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/intro_data_management/introduction.html">Data Management</a></li><li class="breadcrumb-item"><a href="../../chapters/conditional_operations/conditional_operations.html"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Conditional Operations</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Conditional Operations</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!--
- if_else()
- case_when()
- Different than ifelse()
- Different than if {} else {} - not vectorized
- Missing data - see script.
-->
<p>There will often be times that we want to modify the values in one column of our data based on the values in one or more other columns in our data. For example, maybe we want to create a column that contains the region of the country someone is from, based on another column that contains the state they are from.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="values.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>we don‚Äôt really have a way to do this with the tools we currently have in our toolbox. We can manually type out all the region values, but that isn‚Äôt very scalable. Wouldn‚Äôt it be nice if we could just give R some rules, or conditions (e.g., TX is in the South, CA is in the West), and have R fill in the region values for us? Well, that‚Äôs exactly what we are going to learn how to do in this chapter.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="conditions.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>These kinds of operations are called conditional operations because we type in a set of conditions, R evaluates those conditions, and then executes a different process or procedure based on whether or not the condition is met.</p>
<p>As a silly example, let‚Äôs say that we want our daughters to wear a raincoat if it‚Äôs raining outside, but we don‚Äôt want them to wear a raincoat if it is not raining outside. So, we give them a conditional request: ‚ÄúIf it‚Äôs raining outside, then make sure to wear your raincoat, please. Otherwise, please don‚Äôt wear your raincoat.‚Äù</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rain.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In this hypothetical scenario, they say, ‚Äúyes, dad,‚Äù and then go to the window to see if it‚Äôs raining. Then, they choose their next action (i.e., raincoat wearing) depending on whether the condition (raining) is met or not.</p>
<p>Just like we have to ask our daughters to put on a raincoat using conditional logic, we sometimes have to ask R to execute commands using conditional logic. Additionally, we have to do so in a way that R understands. For example, we can use <code>dplyr</code>‚Äôs <code>if_else()</code> function to ask R to execute commands conditionally. Let‚Äôs go ahead and take a look at an example now:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rainy_days <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">day     =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weather =</span> <span class="fu">c</span>(<span class="st">"rain"</span>, <span class="st">"rain"</span>, <span class="st">"no rain"</span>, <span class="st">"rain"</span>, <span class="st">"no rain"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 2
    day weather
  &lt;int&gt; &lt;chr&gt;  
1     1 rain   
2     2 rain   
3     3 no rain
4     4 rain   
5     5 no rain</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li>we simulated some data that contains information about whether or not it rained on each of 5 days.</li>
</ul>
<p>Now, let‚Äôs say that we want to create a new column in our data frame called <code>raincoat</code>. We want the value of <code>raincoat</code> to be <code>wear</code> on rainy days and <code>no wear</code> on days when it isn‚Äôt raining. Here‚Äôs how we can do that with the if_else() function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rainy_days <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">raincoat =</span> <span class="fu">if_else</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">condition =</span> weather <span class="sc">==</span> <span class="st">"rain"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">true      =</span> <span class="st">"wear"</span>, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">false     =</span> <span class="st">"no wear"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
    day weather raincoat
  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   
1     1 rain    wear    
2     2 rain    wear    
3     3 no rain no wear 
4     4 rain    wear    
5     5 no rain no wear </code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>dplyr</code>‚Äôs <code>if_else()</code> function to assign the values <code>wear</code> and <code>no wear</code> to the column <code>raincoat</code> conditional on the values in each row of the <code>weather</code> column.</p></li>
<li><p>You can type <code>?if_else</code> into our R console to view the help documentation for this function and follow along with the explanation below.</p></li>
<li><p>The first argument to the <code>if_else()</code> function is the <code>condition</code> argument. The condition should typically be composed of a series of operands and operators (we‚Äôll talk more about these soon) that tell R the condition(s) that we want it to test. For example, is the value of <code>weather</code> equal to <code>rain</code>?</p></li>
<li><p>The second argument to the <code>if_else()</code> function is the <code>true</code> argument. The value passed to the <code>true</code> argument tells R what value the <code>if_else()</code> function should return when the condition is <code>TRUE</code>. In this case, we told <code>if_else()</code> to return the character value <code>wear</code>.</p></li>
<li><p>The third argument to the <code>if_else()</code> function is the <code>false</code> argument. The value passed to the <code>false</code> argument tells R what value the <code>if_else()</code> function should return when the condition is <code>FALSE</code>. In this case, we told <code>if_else()</code> to return the character value <code>no wear</code>.</p></li>
<li><p>Finally, we assigned all the values returned by the <code>if_else()</code> function to a new column that we named <code>raincoat</code>.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the rest of the book, we will pass values to the <code>if_else()</code> function by position instead of name. In other words, we won‚Äôt write <code>condition =</code>, <code>true =</code>, or <code>false =</code> anymore. However, the first value passed to the <code>if_else()</code> function will always be passed to the <code>condition</code> argument, the second value will always be passed to the <code>true</code> argument, and the third value will always be passed to the <code>false</code> argument.</p>
</div>
</div>
<p>Before moving on, let‚Äôs dive into this a little further. R must always be able to reduce whatever value we pass to the <code>condition</code> argument of <code>if_else()</code> to TRUE or FALSE. That‚Äôs how R views any expression we pass to the <code>condition</code> argument. We can literally even pass the value <code>TRUE</code> or the value <code>FALSE</code> (not that doing so has much practical application):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="cn">TRUE</span>, <span class="st">"wear"</span>, <span class="st">"no wear"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "wear"</code></pre>
</div>
</div>
<p>Because the value passed to the <code>condition</code> argument is <code>TRUE</code> (in this case, literally), the <code>if_else()</code> function returns the value <code>wear</code>. What happens if we use this code to assign values to the <code>raincoat</code> column?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rainy_days <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">raincoat =</span> <span class="fu">if_else</span>(<span class="cn">TRUE</span>, <span class="st">"wear"</span>, <span class="st">"no wear"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
    day weather raincoat
  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   
1     1 rain    wear    
2     2 rain    wear    
3     3 no rain wear    
4     4 rain    wear    
5     5 no rain wear    </code></pre>
</div>
</div>
<p>Again, the <code>if_else()</code> function returns the value <code>wear</code> because the value passed to the <code>condition</code> argument is <code>TRUE</code>. Then, R uses its recycling rules to copy the value <code>wear</code> to every row of the <code>raincoat</code> column. What would do you think will happen if we pass the value <code>FALSE</code> to the <code>condition</code> argument instead?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rainy_days <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">raincoat =</span> <span class="fu">if_else</span>(<span class="cn">FALSE</span>, <span class="st">"wear"</span>, <span class="st">"no wear"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
    day weather raincoat
  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   
1     1 rain    no wear 
2     2 rain    no wear 
3     3 no rain no wear 
4     4 rain    no wear 
5     5 no rain no wear </code></pre>
</div>
</div>
<p>Hopefully, that was the result you expected. The <code>if_else()</code> function returns the value <code>no wear</code> because the value passed to the <code>condition</code> argument is <code>FALSE</code>. Then, R uses its recycling rules to copy the value <code>no wear</code> to every row of the <code>raincoat</code> column.</p>
<p>we can take this a step further and actually pass a vector of logical (<code>TRUE</code>/<code>FALSE</code>) values to the <code>condition</code> argument. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>rainy_days <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">raincoat =</span> <span class="fu">if_else</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="st">"wear"</span>, <span class="st">"no wear"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
    day weather raincoat
  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   
1     1 rain    wear    
2     2 rain    wear    
3     3 no rain no wear 
4     4 rain    wear    
5     5 no rain no wear </code></pre>
</div>
</div>
<p>In reality, that‚Äôs sort of what we did in the very first <code>if_else()</code> example above. But, instead of typing the values manually, we used an expression that returned a vector of logical values. Specifically, we used the equality operator (<code>==</code>) to check whether or not each value in the <code>weather</code> column was equal to the value ‚Äúrain‚Äù or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>rainy_days<span class="sc">$</span>weather <span class="sc">==</span> <span class="st">"rain"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE  TRUE FALSE</code></pre>
</div>
</div>
<p>That pretty much covers the basics of how the <code>if_else()</code> function works. Next, let‚Äôs take a look at some of the different combinations of operands and operators that we can combine and pass to the <code>condition</code> argument of the <code>if_else()</code> function.</p>
<section id="operands-and-operators" class="level2" data-number="30.1">
<h2 data-number="30.1" class="anchored" data-anchor-id="operands-and-operators"><span class="header-section-number">30.1</span> Operands and operators</h2>
<p>Let‚Äôs start by taking a look at some commonly used operands:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="operands.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As we can see in the table above, operands are the <em>values</em> we want to check, or test. Operands can be variables or they can be individual values (also called constants). The example above (<code>weather == "rain"</code>) contained two operands; the variable <code>weather</code> and the character constant <code>"rain"</code>. The operator we used in this case was the equality operator (<code>==</code>). Next, let‚Äôs take a look at some other commonly used operators.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="comparison-numeric.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="comparison-character.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="arithmetic.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logical.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>we think that most of the operators above will be familiar, or a least intuitive, for most of you. However, we do want to provide a little bit of commentary for a few of them.</p>
<ul>
<li><p>we haven‚Äôt seen the <code>%in%</code> operator before, but we will wait to discuss it below.</p></li>
<li><p>Some of you may have been a little surprised by the results we get from using less than (<code>&lt;</code>) and greater than (<code>&gt;</code>) with characters. It‚Äôs basically just testing alphabetical order. A comes before B in the alphabet, so A is less than B. Additionally, when two letters are the same, the upper-case letter is considered greater than the lowercase letter. However, alphabetical order takes precedence over case. So, b is still greater than A even though b is lowercase and A is upper case.</p></li>
<li><p>Many of you may not have seen the modulus operator (<code>%%</code>) before. The modulus operator returns the remainder that is left after dividing two numbers. For example, 4 divided by 2 is 2 with a remainder of 0 because 2 goes into 4 <em>exactly</em> two times. Said another way, 2 * 2 = 4 and 4 - 4 = 0. So, <code>4 %% 2 = 0</code>. However, 3 divided by 2 is 1 with a remainder of 1 because 2 goes into 3 one time with 1 left over. Said another way, 2 * 1 = 2 and 3 - 2 = 1. So, <code>3 %% 2 = 1</code>. How is this useful? Well, the only times we can remember using the modulus operator have been when we needed to separate even and odd rows of a data frame. For example, let‚Äôs say that we have a data frame where each person has two rows. The first row always corresponds to treatment A and the second row always corresponds to treatment B. However, for some reason (maybe blinding?), there was no <code>treatment</code> column in the data when we received it. We could use the modulus operator to add a <code>treatment</code> column like this:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id        =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome   =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 2
     id outcome
  &lt;dbl&gt;   &lt;dbl&gt;
1     1       0
2     1       1
3     2       1
4     2       1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Odd rows are treatment A</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Even rows are treatment B</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="fu">if_else</span>(<span class="fu">row_number</span>() <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"A"</span>, <span class="st">"B"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 3
     id outcome treatment
  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    
1     1       0 A        
2     1       1 B        
3     2       1 A        
4     2       1 B        </code></pre>
</div>
</div>
<ul>
<li>we also want to remind you that we should always use the <code>is.na()</code> function to check for missing values. Not the equality operator (<code>==</code>). Using the equality operator when there are missing values can give results that may be unexpected. For example:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name1 =</span> <span class="fu">c</span>(<span class="st">"Jon"</span>, <span class="st">"John"</span>, <span class="cn">NA</span>),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">name2 =</span> <span class="fu">c</span>(<span class="st">"Jon"</span>, <span class="st">"Jon"</span>, <span class="st">"Jon"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_match =</span> name1 <span class="sc">==</span> name2</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  name1 name2 name_match
  &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt;     
1 Jon   Jon   TRUE      
2 John  Jon   FALSE     
3 &lt;NA&gt;  Jon   NA        </code></pre>
</div>
</div>
<p>Many of us would expect the third value of the <code>name_match</code> column to be <code>FALSE</code> instead of <code>NA</code>. There are a couple of different ways we can get <code>FALSE</code> in the third row instead of <code>NA</code>. One way, although not necessarily the best way, is to use the <code>if_else()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_match =</span> name1 <span class="sc">==</span> name2,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_match =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(name_match), <span class="cn">FALSE</span>, name_match)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  name1 name2 name_match
  &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt;     
1 Jon   Jon   TRUE      
2 John  Jon   FALSE     
3 &lt;NA&gt;  Jon   FALSE     </code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>dplyr</code>‚Äôs <code>if_else()</code> function to assign the value <code>FALSE</code> to the column <code>name_match</code> where the original value of <code>name_match</code> was <code>NA</code>.</p></li>
<li><p>The value we passed to the <code>condition</code> argument was <code>is.na(name_match)</code>. In doing so, we asked R to check each value of the <code>name_match</code> column and see if it was <code>NA</code>.</p></li>
<li><p>If it was <code>NA</code>, then we wanted to return the value that we passed to the <code>true</code> argument. Somewhat confusingly, the value we passed to the <code>true</code> argument was <code>FALSE</code>. All that means is that we wanted <code>if_else()</code> to return the literal value <code>FALSE</code> when the value for <code>name_match</code> was <code>NA</code>.</p></li>
<li><p>If the value in <code>name_match</code> was NOT <code>NA</code>, then we wanted to return the value that we passed to the <code>false</code> argument. In this case, we asked R to return the value that already exists in the <code>name_match</code> column.</p></li>
<li><p>In more informal language, we asked R to replace missing values in the <code>name_match</code> column with <code>FALSE</code> and leave the rest of the values unchanged.</p></li>
</ul>
</section>
<section id="testing-multiple-conditions-simultaneously" class="level2" data-number="30.2">
<h2 data-number="30.2" class="anchored" data-anchor-id="testing-multiple-conditions-simultaneously"><span class="header-section-number">30.2</span> Testing multiple conditions simultaneously</h2>
<p>So far, we have only ever passed one condition to the <code>condition</code> argument of the <code>if_else()</code> function. However, we can pass as many conditions as we want. Having said that, more than 2, or maybe 3, gets very convoluted. Let‚Äôs go ahead and take a look at a couple of examples now. We‚Äôll start by simulating some blood pressure data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>blood_pressure <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id     =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sysbp  =</span> <span class="fu">c</span>(<span class="dv">152</span>, <span class="dv">120</span>, <span class="dv">119</span>, <span class="dv">123</span>, <span class="dv">135</span>, <span class="dv">83</span>, <span class="dv">191</span>, <span class="dv">147</span>, <span class="dv">209</span>, <span class="dv">166</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">diasbp =</span> <span class="fu">c</span>(<span class="dv">78</span>, <span class="dv">60</span>, <span class="dv">88</span>, <span class="dv">76</span>, <span class="dv">85</span>, <span class="dv">54</span>, <span class="dv">116</span>, <span class="dv">95</span>, <span class="dv">100</span>, <span class="dv">106</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 3
      id sysbp diasbp
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1     1   152     78
 2     2   120     60
 3     3   119     88
 4     4   123     76
 5     5   135     85
 6     6    83     54
 7     7   191    116
 8     8   147     95
 9     9   209    100
10    10   166    106</code></pre>
</div>
</div>
<p>A person may be categorized as having normal blood pressure when their systolic blood pressure is less than 120 mmHG <em>AND</em> their diastolic blood pressure is less than 80 mmHG. We can use this information and the <code>if_else()</code> function to create a new column in our data frame that contains information about whether each person in our simulated data frame has normal blood pressure or not:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>blood_pressure <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bp =</span> <span class="fu">if_else</span>(sysbp <span class="sc">&lt;</span> <span class="dv">120</span> <span class="sc">&amp;</span> diasbp <span class="sc">&lt;</span> <span class="dv">80</span>, <span class="st">"Normal"</span>, <span class="st">"Not Normal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 4
      id sysbp diasbp bp        
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
 1     1   152     78 Not Normal
 2     2   120     60 Not Normal
 3     3   119     88 Not Normal
 4     4   123     76 Not Normal
 5     5   135     85 Not Normal
 6     6    83     54 Normal    
 7     7   191    116 Not Normal
 8     8   147     95 Not Normal
 9     9   209    100 Not Normal
10    10   166    106 Not Normal</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>dplyr</code>‚Äôs <code>if_else()</code> function to create a new column in our data frame (<code>bp</code>) that contains information about whether each person has normal blood pressure or not.</p></li>
<li><p>we actually passed two conditions to the <code>condition</code> argument. The first condition was that the value of <code>sysbp</code> had to be less than <code>120</code>. The second condition was that the value of <code>diasbp</code> had to be less than <code>80</code>.</p></li>
<li><p>Because we separated these conditions with the AND operator (<code>&amp;</code>), both conditions had to be true in order for the <code>if_else()</code> function to return the value we passed to the <code>true</code> argument ‚Äì <code>Normal</code>. Otherwise, the <code>if_else()</code> function returned the value we passed to the <code>false</code> argument ‚Äì <code>Not Normal</code>.</p></li>
<li><p>Participant 2 had a systolic blood pressure of 120 and a diastolic blood pressure of 60. Although 60 is less than 80 (condition number 2), 120 is not less than 120 (condition number 1). So, the value returned by the <code>if_else()</code> function was <code>Not Normal</code>.</p></li>
<li><p>Participant 3 had a systolic blood pressure of 119 and a diastolic blood pressure of 88 Although 119 is less than 120 (condition number 1), 88 is not less than 80 (condition number 2). So, the value returned by the <code>if_else()</code> function was <code>Not Normal</code>.</p></li>
<li><p>Participant 6 had a systolic blood pressure of 83 and a diastolic blood pressure of 54. In this case, conditions 1 <em>and</em> 2 were met. So, the value returned by the <code>if_else()</code> function was <code>Normal</code>.</p></li>
</ul>
<p>This is useful! However, in some cases, we need to be able to test conditions sequentially, rather than simultaneously, and return a different value for each condition.</p>
</section>
<section id="testing-a-sequence-of-conditions" class="level2" data-number="30.3">
<h2 data-number="30.3" class="anchored" data-anchor-id="testing-a-sequence-of-conditions"><span class="header-section-number">30.3</span> Testing a sequence of conditions</h2>
<p>Let‚Äôs say that we wanted to create a new column in our <code>blood_pressure</code> data frame that contains each person‚Äôs blood pressure category according to the following scale:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="bp.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This is the perfect opportunity to use <code>dplyr</code>‚Äôs <code>case_when()</code> function. Take a look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>blood_pressure <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">bp =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      sysbp <span class="sc">&lt;</span> <span class="dv">120</span> <span class="sc">&amp;</span> diasbp <span class="sc">&lt;</span> <span class="dv">80</span>                               <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>      sysbp <span class="sc">&gt;=</span> <span class="dv">120</span> <span class="sc">&amp;</span> sysbp <span class="sc">&lt;</span> <span class="dv">130</span> <span class="sc">&amp;</span> diasbp <span class="sc">&lt;</span> <span class="dv">80</span>                <span class="sc">~</span> <span class="st">"Elevated"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      sysbp <span class="sc">&gt;=</span> <span class="dv">130</span> <span class="sc">&amp;</span> sysbp <span class="sc">&lt;</span> <span class="dv">140</span> <span class="sc">|</span> diasbp <span class="sc">&gt;=</span> <span class="dv">80</span> <span class="sc">&amp;</span> diasbp <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">"Hypertension Stage 1"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>      sysbp <span class="sc">&gt;=</span> <span class="dv">140</span> <span class="sc">|</span> diasbp <span class="sc">&gt;=</span> <span class="dv">90</span>                             <span class="sc">~</span> <span class="st">"Hypertension Stage 2"</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 4
      id sysbp diasbp bp                  
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;               
 1     1   152     78 Hypertension Stage 2
 2     2   120     60 Elevated            
 3     3   119     88 Hypertension Stage 1
 4     4   123     76 Elevated            
 5     5   135     85 Hypertension Stage 1
 6     6    83     54 Normal              
 7     7   191    116 Hypertension Stage 2
 8     8   147     95 Hypertension Stage 2
 9     9   209    100 Hypertension Stage 2
10    10   166    106 Hypertension Stage 2</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>dplyr</code>‚Äôs <code>case_when()</code> function to create a new column in our data frame (<code>bp</code>) that contains information about each person‚Äôs blood pressure category.</p></li>
<li><p>You can type <code>?case_when</code> into our R console to view the help documentation for this function and follow along with the explanation below.</p></li>
<li><p>The <code>case_when()</code> function only has a single argument ‚Äì the <code>...</code> argument. You should pass one or more two-sided formulas separated by commas to this argument. What in the heck does that mean?</p>
<ul>
<li><p>When the help documentation refers to a two-sided formula, it means this: <code>LHS ~ RHS</code>. Here, <code>LHS</code> means left-hand side and <code>RHS</code> means right-hand side.</p></li>
<li><p>The <code>LHS</code> should be the condition or conditions that we want to test. You can think of this as being equivalent to the <code>condition</code> argument of the <code>if_else()</code> function.</p></li>
<li><p>The <code>RHS</code> should be the value we want the <code>case_when()</code> function to return when the condition on the left-hand side is met. You can think of this as being equivalent to the <code>true</code> argument of the <code>if_else()</code> function.</p></li>
<li><p>The tilde symbol (<code>~</code>) is used to separate the conditions on the left-hand side and the return values on the right-hand side.</p></li>
</ul></li>
<li><p>The <code>case_when()</code> function doesn‚Äôt have a direct equivalent to the <code>if_else()</code> function‚Äôs <code>false</code> argument. Instead, it evaluates each two-sided formula sequentially until if finds a condition that is met. If it never finds a condition that is met, then it returns an <code>NA</code>. We will expand on this more below.</p></li>
<li><p>Finally, we assigned all the values returned by the <code>case_when()</code> function to a new column that we named <code>bp</code>.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Traditionally, the tilde symbol (<code>~</code>) is used to represent relationships in a statistical model. Here, it doesn‚Äôt have that meaning. We assume this symbol was picked somewhat out of necessity. Remember, any of the comparison operators, arithmetic operators, and logical operators may be used to define a condition in the left-hand side, and commas are used to separated multiple two-sided formulas. Therefore, there aren‚Äôt very many symbols left to choose from. Therefore, tilde it is. That‚Äôs our guess anyway.</p>
</div>
</div>
<p>The <code>case_when()</code> function was really useful for creating the <code>bp</code> column above, but there was also a lot going on there. Next, we‚Äôll take a look at a slightly less complex example and clarify a few things along the way.</p>
</section>
<section id="recoding-variables" class="level2" data-number="30.4">
<h2 data-number="30.4" class="anchored" data-anchor-id="recoding-variables"><span class="header-section-number">30.4</span> Recoding variables</h2>
<p>In epidemiology, recoding variables is really common. For example, we may collect information about people‚Äôs ages as a continuous variable, but decide that it makes more sense to <strong>collapse</strong> age into age categories for our analysis. Let‚Äôs say that our analysis plan calls for assigning each of our participants to one of the following age categories:</p>
<p>1 = <code>child</code> when the participant is less than 12 years old<br>
2 = <code>adolescent</code> when the participant is between the ages of 12 and less than 18<br>
3 = <code>adult</code> when the participant is 18 years old or older</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may not have ever heard of <strong>collapsing</strong> variables before. It simply means combing two or more values of our variable. We can collapse continuous variables into categories, as we discussed in the example above, or we can collapse categories into broader categories (as we will see with the race category example below). After we collapse a variable, it always contains fewer (and broader) possible values than it contained before we collapsed it.</p>
</div>
</div>
<p>we‚Äôre going to show you how to do this below using the <code>case_when()</code> function. However, we‚Äôre going to do it piecemeal so that we can highlight a few important concepts. First, let‚Äôs simulate some data that includes 10 participant‚Äôs ages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate some age data</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">id  =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">9</span>, <span class="cn">TRUE</span>), <span class="cn">NA</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 2
      id   age
   &lt;int&gt; &lt;int&gt;
 1     1    15
 2     2    19
 3     3    14
 4     4     3
 5     5    10
 6     6    18
 7     7    22
 8     8    11
 9     9     5
10    10    NA</code></pre>
</div>
</div>
<p>Then, let‚Äôs start the process of collapsing the <code>age</code> column into a new column called <code>age_3cat</code> that contains the 3 age categories we discussed above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ages <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_3cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 3
      id   age age_3cat
   &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;
 1     1    15       NA
 2     2    19       NA
 3     3    14       NA
 4     4     3        1
 5     5    10        1
 6     6    18       NA
 7     7    22       NA
 8     8    11        1
 9     9     5        1
10    10    NA       NA</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>dplyr</code>‚Äôs <code>case_when()</code> function to create a new column in our data frame (<code>age_3cat</code>) that will eventually categorize each participant into one of 3 categories depending on their continuous age value.</p></li>
<li><p>Notice that we only passed one two-sided formula to the <code>case_when()</code> function ‚Äì <code>age &lt; 12 ~ 1</code>.</p>
<ul>
<li><p>The <code>RHS</code> of the two-sided formula is <code>age &lt; 12</code>. This tells the <code>case_when()</code> function to check whether or not every value in the <code>age</code> column is less than <code>12</code> or not.</p></li>
<li><p>The <code>LHS</code> of the two-sided formula is <code>1</code>. This tells the <code>case_when()</code> function what value to return each time it finds a value less than <code>12</code> in the <code>age</code> column.</p></li>
<li><p>The tilde symbol is used to separate the <code>RHS</code> and the <code>LHS</code> of the two-sided formula.</p></li>
</ul></li>
<li><p>Here is how the <code>case_when()</code> function basically works. It will test the condition on the left-hand side for each value of the variable, or variables, passed to the left-hand side (i.e., <code>age</code>). If the condition is met (i.e., <code>&lt; 12</code>), then it will return the value on the right-hand side of the tilde (i.e., <code>1</code>). If the condition is not met, it will test the condition in the next two-sided formula. When there are no more two-sided formulas, then it will return an <code>NA</code>.</p>
<ul>
<li><p>Above, the first value in <code>age</code> is <code>15</code>. <code>15</code> is <em>NOT</em> less than <code>12</code>. So, <code>case_when()</code> tries to move on to the next two-sided formula. However, there is no next two-sided formula. So, the first value returned by the <code>case_when()</code> function is <code>NA</code>. The same is true for the next two values of age.</p></li>
<li><p>The fourth value in <code>age</code> is <code>3</code>. <code>3</code> is less than <code>12</code>. So, the fourth value returned by the <code>case_when()</code> function is <code>1</code>. And so on‚Ä¶</p></li>
<li><p>Finally, after the <code>case_when()</code> function has tested all conditions, the returned values are assigned to a new column that we named <code>age_3cat</code>.</p></li>
</ul></li>
<li><p>Notice that we named the new variable <code>age_3cat</code>. We‚Äôre not sure where we picked up this naming convention, but we use it a lot when we collapse variables. The basic format is the name of variable we‚Äôre collapsing, an underscore, and the number of categories in the collapsed variable. We like using this convention for two reasons. First, the resulting column names are meaningful and informative. Second, we don‚Äôt have to spend any time trying to think of a different meaningful or informative name for my new variable. It‚Äôs totally fine if you don‚Äôt adopt this naming convention, but we would recommend that you try to use names that are more informative than <code>age2</code> or something like that.</p></li>
<li><p>Notice that we used a number (<code>1</code>) on the right-hand side of the two-sided formula above. We could have used a character value instead (i.e., <code>child</code>); however, for reasons we discussed in the section on factor variables, we prefer to recode my variables using numeric categories and then later creating a factor version of the variable using the <code>_f</code> naming convention.</p></li>
</ul>
<p>Now, let‚Äôs add a second two-sided formula to our <code>case_when()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ages <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_3cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">12</span>             <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 3
      id   age age_3cat
   &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;
 1     1    15        2
 2     2    19       NA
 3     3    14        2
 4     4     3        1
 5     5    10        1
 6     6    18       NA
 7     7    22       NA
 8     8    11        1
 9     9     5        1
10    10    NA       NA</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>we used <code>dplyr</code>‚Äôs <code>case_when()</code> function to create a new column in our data frame (<code>age_3cat</code>) that will eventually categorize each participant into one of 3 categories depending on their continuous age value.</p></li>
<li><p>Notice that this time we passed two two-sided formulas to the <code>case_when()</code> function ‚Äì <code>age &lt; 12 ~ 1</code> and <code>age &gt;= 12 &amp; age &lt; 18 ~ 2</code>.</p>
<ul>
<li><p>Notice that we separated the two two-sided formulas with a comma (i.e., immediately after the <code>1</code> in <code>age &lt; 12 ~ 1</code>.</p></li>
<li><p>Notice that the second two-sided formula is actually testing two conditions. First, it tests whether or not the value of age is greater than or equal to 12. Then, it tests whether or not the value of age is less than 18.</p></li>
<li><p>Because we separated the two conditions with the and operator (<code>&amp;</code>), both must be TRUE for <code>case_when()</code> to return the value <code>2</code>. Otherwise, it will move on to the next two-sided formula.</p></li>
<li><p>Above, the first value in <code>age</code> is <code>15</code>. <code>15</code> is <em>NOT</em> less than <code>12</code>. So, <code>case_when()</code> moves on to evaluate the next two-sided formula. <code>15</code> is greater than or equal to <code>12</code> <em>AND</em> <code>15</code> is less than <code>18</code>. Because both conditions of the second two-sided formula were met, <code>case-when()</code> returns the value on the right-hand side of the second two-sided formula ‚Äì <code>2</code>. So, the first value returned by the <code>case_when()</code> function is <code>2</code>.</p></li>
<li><p>The second value in <code>age</code> is <code>19</code>. <code>19</code> is <em>NOT</em> less than <code>12</code>. So, <code>case_when()</code> moves on to evaluate the next two-sided formula. <code>19</code> is greater than or equal to <code>12</code>, but <code>19</code> is <em>NOT</em> less than <code>18</code>. So, <code>case_when()</code> tries to move on to the next two-sided formula. However, there is no next two-sided formula. So, the second value returned by the <code>case_when()</code> function is <code>NA</code>.</p></li>
<li><p>The fourth value in <code>age</code> is <code>3</code>. <code>3</code> is less than <code>12</code>. So, the fourth value returned by the <code>case_when()</code> function is <code>1</code>. <strong>At this point, because a condition was met, <code>case_when()</code> does not continue checking the current value of <code>age</code> against the remaining two-sided formulas. It returns a <code>1</code> and moves on to the next value of <code>age</code>.</strong></p></li>
<li><p>Finally, after the <code>case_when()</code> function has tested all conditions, the returned values are assigned to a new column that we named <code>age_3cat</code>.</p></li>
</ul></li>
<li><p>In everyday speech, we may express the second two-sided condition above as ‚Äúcategorize all people between the ages of 12 and 18 as an adolescent.‚Äù we want to make two points about that before moving on.</p>
<ul>
<li><p>First, while that statement may be totally reasonable in everyday speech, it isn‚Äôt quite specific enough for what we are trying to do here. ‚ÄúBetween 12 and 18‚Äù is a little bit ambiguous. What category is a person put in if they are exactly 12? What category are they put in if they are exactly 18? So, clearly we need to be more precise. We‚Äôre not aware of any hard and fast rules for making these kinds of decisions about categorization, but we tend to <em>include</em> the lower end of the range in the current category and <em>exclude</em> the value on the upper end of the range in the current category. So, in the example above, we would say, ‚Äúcategorize all people between the ages of 12 and less than 18 as an adolescent.‚Äù</p></li>
<li><p>Second, when we are testing for a ‚Äúbetween‚Äù condition like this one, we often see students write code like this: <code>age &gt;= 12 &amp; &lt; 18</code>. R won‚Äôt understand that. We have to use the column name in each condition to be tested (i.e., <code>age &gt;= 12 &amp; age &lt; 18</code>), even though it doesn‚Äôt change. Otherwise, we get an error that looks something like this:</p></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ages <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_3cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">12</span>             <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="er">&lt;</span> <span class="dv">18</span>     <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in parse(text = input): &lt;text&gt;:5:19: unexpected '&lt;'
4:       age &lt; 12             ~ 1,
5:       age &gt;= 12 &amp; &lt;
                     ^</code></pre>
</div>
</div>
<p>Ok, let‚Äôs go ahead and wrap up this age category variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ages <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_3cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">12</span>             <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">18</span>            <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 3
      id   age age_3cat
   &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;
 1     1    15        2
 2     2    19        3
 3     3    14        2
 4     4     3        1
 5     5    10        1
 6     6    18        3
 7     7    22        3
 8     8    11        1
 9     9     5        1
10    10    NA       NA</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li>we used <code>dplyr</code>‚Äôs <code>case_when()</code> function to create a new column in our data frame (<code>age_3cat</code>) that categorized each participant into one of 3 categories depending on their continuous age value.</li>
</ul>
</section>
<section id="case_when-is-lazy" class="level2" data-number="30.5">
<h2 data-number="30.5" class="anchored" data-anchor-id="case_when-is-lazy"><span class="header-section-number">30.5</span> case_when() is lazy</h2>
<p>What do we mean when we say that <code>case_when()</code> is lazy? Well, it may not have registered when we mentioned it above, but <code>case_when()</code> stops evaluating two-sided functions for a value as soon as it finds one that is <code>TRUE</code>. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 1
  number
   &lt;dbl&gt;
1      1
2      2
3      3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fu">case_when</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>      number <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Small"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>      number <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>      number <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Large"</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 2
  number size  
   &lt;dbl&gt; &lt;chr&gt; 
1      1 Small 
2      2 Medium
3      3 Large </code></pre>
</div>
</div>
<p>Why wasn‚Äôt the value for the <code>size</code> column <code>Large</code> in every row of the data frame? After all, <code>1</code>, <code>2</code>, and <code>3</code> are all less than <code>4</code>, and <code>number &lt; 4</code> was the final possible two-sided formula that could have been evaluated for each value of <code>number</code>. The answer is that <code>case_when()</code> is lazy. The first value in <code>number</code> is <code>1</code>. <code>1</code> is less than <code>2</code>. So, the condition in the first two-sided formula evaluates to <code>TRUE</code>. So, <code>case_when()</code> immediately returns the value on the right-hand side (<code>Small</code>) and <strong>does not continue checking two-sided formulas. It moves on to the next value of <code>number</code>.</strong></p>
<p>The fact that <code>case_when()</code> is lazy isn‚Äôt a bad thing. It‚Äôs just something to be aware of. In fact, we can often use it to our advantage. For example, we can use <code>case_when()</code>‚Äôs laziness to rewrite the <code>age_3cat</code> code from above a little more succinctly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ages <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_3cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">12</span>  <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">18</span>  <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 3
      id   age age_3cat
   &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;
 1     1    15        2
 2     2    19        3
 3     3    14        2
 4     4     3        1
 5     5    10        1
 6     6    18        3
 7     7    22        3
 8     8    11        1
 9     9     5        1
10    10    NA       NA</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li>Because <code>case_when()</code> is lazy, we were able to omit the <code>age &gt;= 12</code> condition from the second two-sided formula. It‚Äôs unnecessary because the value <code>1</code> is immediately returned for every person with an <code>age</code> value less than <code>12</code>. By definition, any value being evaluated in the second two-sided function (<code>age &lt; 18</code>) has an age value greater than or equal to 12.</li>
</ul>
</section>
<section id="recode-missing" class="level2" data-number="30.6">
<h2 data-number="30.6" class="anchored" data-anchor-id="recode-missing"><span class="header-section-number">30.6</span> Recode missing</h2>
<p>We‚Äôve already talked about how R uses the special <code>NA</code> value to represent missing data. We‚Äôve also learned how to convert other representations of missing data (e.g., ‚Äú.‚Äù) to <code>NA</code> when we are importing data. However, It is extremely common for data sets that we use in epidemiology to include ‚Äúdon‚Äôt know‚Äù and ‚Äúrefused‚Äù answer options in addition to true ‚Äúmissing‚Äù. By convention, those options are often coded as <code>7</code> and <code>9</code>. For questions that include 7 or more response options (e.g., month), then <code>77</code> and <code>99</code> are commonly used to represent ‚Äúdon‚Äôt know‚Äù and ‚Äúrefused‚Äù. For questions that include 77 or more response options (e.g., age), then <code>777</code> and <code>999</code> are commonly used to represent ‚Äúdon‚Äôt know‚Äù and ‚Äúrefused‚Äù.</p>
<p>Differentiating between true missing (i.e., the respondent was never asked the question or just left the response blank on a written questionnaire), don‚Äôt know (i.e., the respondent doesn‚Äôt know the answer), and refused (i.e., the respondent knows the answer, but doesn‚Äôt want to reveille it ‚Äì possibly out of shame, fear, or embarrassment) can be of some interest for survey design purposes. However, all three of the values described above typically just amount to missing data by the time we get around to the substantive analyses. In other words, knowing that a person refused to give their age doesn‚Äôt help me figure out how old they are any more than if they had never been asked at all. Therefore, we commonly use conditional operations in epidemiology to recode these kinds of values to explicitly missing values (<code>NA</code>).</p>
<p>We‚Äôll walk through an example below, but first we will simulate some additional data. Specifically, we‚Äôll add a <code>race</code> column and a <code>hispanic</code> column to our <code>ages</code> data frame, and name the new data frame <code>demographics</code>.</p>
<p>Let‚Äôs assume that we have a survey that asks people what race they most identify with. For the moment, let‚Äôs assume that they can only select one race. Further, let‚Äôs say that the options they are given to select from are:</p>
<p>1 = White<br>
2 = Black or African American<br>
3 = American Indian or Alaskan Native<br>
4 = Asian<br>
5 = Pacific Islander<br>
7 = Don‚Äôt know<br>
9 = Refused</p>
<p>Let‚Äôs say that we also ask if they self-identify their ethnicity as Hispanic or not. The options they are given to select from are:</p>
<p>0 = No, not Hispanic<br>
1 = Yes, Hispanic<br>
7 = Don‚Äôt know<br>
9 = Refused</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>demographics <span class="ot">&lt;-</span> ages <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">race     =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 4
      id   age  race hispanic
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1     1    15     1        7
 2     2    19     2        0
 3     3    14     1        1
 4     4     3     4        0
 5     5    10     7        1
 6     6    18     1        0
 7     7    22     2        1
 8     8    11     9        9
 9     9     5     1        0
10    10    NA     3        1</code></pre>
</div>
</div>
<p>A very common way that we may want to transform data like this is to collapse race and ethnicity into as single combined race and ethnicity column. Further, notice that American Indian or Alaskan Native race and Asian race are only observed once each, and Pacific Islander race is not observed at all. When values are observed very few times in the data like this, it is common to collapse them into an ‚Äúother‚Äù category. Therefore, our new combined race and ethnicity column will have the following possible values:</p>
<p>1 = White, non-Hispanic<br>
2 = Black, non-Hispanic<br>
3 = Hispanic, any race<br>
4 = Other race, non-Hispanic</p>
<p>There are multiple ways that we can create this new column. We could start by using <code>if_else()</code> to recode <code>7</code> and <code>9</code> to missing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>demographics <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recode 7 and 9 to missing</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_recode =</span> <span class="fu">if_else</span>(race <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> race <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA</span>, race),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_recode =</span> <span class="fu">if_else</span>(hispanic <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> hispanic <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA</span>, hispanic)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 6
      id   age  race hispanic race_recode hispanic_recode
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;
 1     1    15     1        7           1              NA
 2     2    19     2        0           2               0
 3     3    14     1        1           1               1
 4     4     3     4        0           4               0
 5     5    10     7        1          NA               1
 6     6    18     1        0           1               0
 7     7    22     2        1           2               1
 8     8    11     9        9          NA              NA
 9     9     5     1        0           1               0
10    10    NA     3        1           3               1</code></pre>
</div>
</div>
<p>We intentionally made this error because it‚Äôs a really easy one to make, and you will probably make it too. If we look back to the <a href="../lets_get_programming/lets_get_programming.html#missing-data">Let‚Äôs get programming chapter</a>, we will see that we briefly discussed the <code>NA</code> value being type logical by default. We also talked about ‚Äútype coercion‚Äù and how most of the time we don‚Äôt have to worry about it. We said that R generally coerces <code>NA</code> to <code>NA_character</code>, <code>NA_double</code>, or whatever specific version of <code>NA</code> is most appropriate for the data type automatically. We also said that there are some exceptions. Notably, when using the <code>if_else()</code> and <code>case_when()</code> functions, R will throw an error instead of automatically type coercing. Finally, we said we would discuss it later. It‚Äôs later now. Long story short, the developers of the <code>if_else()</code> function do this on purpose to make the function‚Äôs returned result more predictable and slightly faster.</p>
<p>For us, this just means that we have to remember to use <code>NA_character</code>, <code>NA_integer</code>, or <code>NA_real</code> as appropriate. For example, the error message above says, ‚Äú<code>false</code> must be a logical vector, not a double vector.‚Äù This means that the value we passed to the <code>false</code> argument was type double, but <code>if_else()</code> was expecting it to be type logical. Why? Well, <code>if_else()</code> was expecting it to be type logical because the value we passed to the <code>true</code> argument (<code>NA</code>) is type logical, and vectors can only ever have one type. To fix this error, we simply need to change the value we are passing to the <code>true</code> argument from logical (<code>NA</code>) to double (<code>NA_real</code>) so that it matches the values we are passing to the <code>false</code> argument.</p>
<p>Let‚Äôs try again using <code>NA_real</code> instead of <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>demographics <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recode 7 and 9 to missing</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_recode =</span> <span class="fu">if_else</span>(race <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> race <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA_real_</span>, race),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_recode =</span> <span class="fu">if_else</span>(hispanic <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> hispanic <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA_real_</span>, hispanic)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 6
      id   age  race hispanic race_recode hispanic_recode
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;
 1     1    15     1        7           1              NA
 2     2    19     2        0           2               0
 3     3    14     1        1           1               1
 4     4     3     4        0           4               0
 5     5    10     7        1          NA               1
 6     6    18     1        0           1               0
 7     7    22     2        1           2               1
 8     8    11     9        9          NA              NA
 9     9     5     1        0           1               0
10    10    NA     3        1           3               1</code></pre>
</div>
</div>
<p>Great! We can move on with creating our new race and ethnicity column now that we‚Äôve explicitly transformed <code>7</code>‚Äôs and <code>9</code>‚Äôs to <code>NA</code>. There‚Äôs nothing ‚Äúnew‚Äù in the code below, so we‚Äôre not going to explain it line-by-line. However, it‚Äôs a little bit dense, so we recommend that you take a few minutes to review it thoroughly and make sure you understand what each line is doing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>demographics <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recode 7 and 9 to missing</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_recode     =</span> <span class="fu">if_else</span>(race <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> race <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA_real_</span>, race),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_recode =</span> <span class="fu">if_else</span>(hispanic <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> hispanic <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA_real_</span>, hispanic),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_eth_4cat   =</span> <span class="fu">case_when</span>(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># White, non-Hispanic</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>      race_recode <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> hispanic_recode <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Black, non-Hispanic</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>      race_recode <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> hispanic_recode <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># American Indian or Alaskan Native to Other race, non-Hispanic</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>      race_recode <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> hispanic_recode <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Asian to Other race, non-Hispanic</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>      race_recode <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> hispanic_recode <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Pacific Islander to Other race, non-Hispanic</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>      race_recode <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> hispanic_recode <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Hispanic, any race</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>      hispanic_recode <span class="sc">==</span> <span class="dv">1</span>                    <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 7
      id   age  race hispanic race_recode hispanic_recode race_eth_4cat
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;         &lt;dbl&gt;
 1     1    15     1        7           1              NA            NA
 2     2    19     2        0           2               0             2
 3     3    14     1        1           1               1             3
 4     4     3     4        0           4               0             4
 5     5    10     7        1          NA               1             3
 6     6    18     1        0           1               0             1
 7     7    22     2        1           2               1             3
 8     8    11     9        9          NA              NA            NA
 9     9     5     1        0           1               0             1
10    10    NA     3        1           3               1             3</code></pre>
</div>
</div>
<p>The code above works, and it is very explicit. However, we can definitely make it more succinct and easier to read. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>demographics <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_eth_4cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(hispanic) <span class="sc">|</span> hispanic <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>) <span class="sc">~</span> <span class="cn">NA_real_</span>, <span class="co"># Unknown ethnicity</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>      hispanic <span class="sc">==</span> <span class="dv">1</span>                           <span class="sc">~</span> <span class="dv">3</span>,        <span class="co"># Hispanic, any race</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(race) <span class="sc">|</span> race <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>)         <span class="sc">~</span> <span class="cn">NA_real_</span>, <span class="co"># non-Hispanic, unknown race</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">==</span> <span class="dv">1</span>                               <span class="sc">~</span> <span class="dv">1</span>,        <span class="co"># White, non-Hispanic</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">==</span> <span class="dv">2</span>                               <span class="sc">~</span> <span class="dv">2</span>,        <span class="co"># Black, non-Hispanic</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                                    <span class="sc">~</span> <span class="dv">4</span>         <span class="co"># Other race, non-Hispanic</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 5
      id   age  race hispanic race_eth_4cat
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
 1     1    15     1        7            NA
 2     2    19     2        0             2
 3     3    14     1        1             3
 4     4     3     4        0             4
 5     5    10     7        1             3
 6     6    18     1        0             1
 7     7    22     2        1             3
 8     8    11     9        9            NA
 9     9     5     1        0             1
10    10    NA     3        1             3</code></pre>
</div>
</div>
<p>üëÜ<strong>Here‚Äôs what we did above:</strong></p>
<ul>
<li><p>We used <code>dplyr</code>‚Äôs <code>case_when()</code> function to create a new column in our data frame (<code>race_eth_4cat</code>) that categorized each participant into one of 4 race and ethnicity categories depending on their values in the <code>race</code> column and the <code>hispanic</code> column.</p></li>
<li><p>Compared to the first method we used, the second method doesn‚Äôt explicitly create new <code>race</code> and <code>hispanic</code> columns with the <code>7</code>‚Äôs and <code>9</code>‚Äôs recoded to <code>NA</code>. In the second method, those columns aren‚Äôt needed.</p></li>
<li><p>The very first two-sided formula tells <code>case_when()</code> to set the value of <code>race_eth_4cat</code> to <code>NA_real_</code> when the value of <code>hispanic</code> is missing.</p>
<ul>
<li><p>We put this two-sided formula first because if we don‚Äôt know a person‚Äôs Hispanic ethnicity, then we can‚Äôt put them into any category of <code>race_eth_4cat</code>. All categories of <code>race_eth_4cat</code> are dependent on a known value for <code>hispanic</code>. For example, look at participant number 1. They reported being white, but they don‚Äôt give their ethnicity. Which category do we put them in? We can‚Äôt put them in <code>White, non-Hispanic</code> because they very well could be Hispanic. We can‚Äôt put them in <code>Hispanic, any race</code> because they very well could be non-Hispanic. We don‚Äôt know. We never will. We code them as missing and don‚Äôt evaluate any further. And because <code>case_when()</code> is lazy, any other participants with a missing value for <code>hispanic</code> would also only have this first two-sided formula evaluated.</p></li>
<li><p>There were no actual <code>NA</code> values in the <code>hispanic</code> column, but we put it in the code for completeness. There will be some true missing (<code>NA</code>) values in most real-world data sets.</p></li>
<li><p>Notice that we finally used the <code>%in%</code> operator above (<code>hispanic %in% c(7, 9)</code>). This is equivalent to typing <code>hispanic == 7 | hispanic == 9</code>. Notice that‚Äôs an <em>OR</em>. In this case, it doesn‚Äôt save us a ton of typing and visual clutter, but in many cases it can.</p></li>
</ul></li>
<li><p>The second two-sided formula tells <code>case_when()</code> to set the value of <code>race_eth_4cat</code> to <code>3</code> (i.e., Hispanic any-race) when the value of <code>hispanic</code> is <code>1</code>. Why did we put this second? If we know that someone is Hispanic, does it matter what race they reported? Nope! No matter what race they reported (even missing race) they get coded as <code>Hispanic, any race</code>. And because <code>case_when()</code> is lazy, putting this two-sided formula second has two advantages:</p>
<ul>
<li><p>Any other participants with a value of <code>1</code> for <code>hispanic</code> would only have the first two two-sided formulas evaluated. In other words, for each Hispanic participant, R would only evaluate 2 two-sided formulas instead of the 6 we used in the first method. With only 10 participants in the data, we won‚Äôt notice any performance improvement. But, this performance improvement can add up when we have thousands or millions of rows.</p></li>
<li><p>It allows us to remove the <code>hispanic == 0</code> from the remaining two-sided formulas. Think about it. All participants with a missing value for <code>hispanic</code> were accounted for in the first two-sided formula. All participants with a <code>1</code> for <code>hispanic</code> were accounted for in the second two-sided formula. By definition, any participant left in the data must have a value of <code>0</code> for <code>hispanic</code>. There‚Äôs no need to write that code and there‚Äôs no need for R to evaluate that condition. Less typing for us and further performance improvements to boot.</p></li>
</ul></li>
<li><p>The third two-sided formula tells <code>case_when()</code> to set the value of <code>race_eth_4cat</code> to <code>NA_real_</code> when the value of <code>race</code> is missing. At this point in the code, there are no participants left with a value of <code>1</code> for <code>hispanic</code>. Therefore, if they are missing a value for <code>race</code> we won‚Äôt be able to assign them a value for <code>race_eth_4cat</code>. We code them as missing and don‚Äôt evaluate any further.</p></li>
<li><p>The fourth and fifth two-sided formulas tell <code>case_when()</code> to set the value of <code>race_eth_4cat</code> to <code>1</code> and <code>2</code> respectively when the value of <code>race</code> is <code>1</code> and <code>2</code>.</p></li>
<li><p>The final two-sided formula is simply <code>TRUE ~ 4</code>. This tells <code>case_when()</code> to set the value of <code>race_eth_4cat</code> to <code>4</code> when none of the other two-sided formulas above evaluated to <code>TRUE</code>. Why did we do this? Well, every participant with missing data has been accounted for, every <code>Hispanic</code> participant has been accounted for, every <code>White, non-Hispanic</code> participant has been accounted for, and every <code>Black, non-Hispanic</code> participant has been accounted for. Because case_when() is lazy, we know that any participant that makes it to this part of the code must fall into the <code>Other race, non-Hispanic</code> category.</p>
<ul>
<li>Notice that there is nothing at all about <code>race</code> or <code>hispanic</code> in this two-sided formula. It just says <code>TRUE</code>. What does <code>case_when()</code> do when a condition on the left-hand side evaluates to <code>TRUE</code>? It returns the value on the right-hand side. In this case <code>4</code>.</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sometimes, adding an a final <code>TRUE</code> condition like the one above can be really useful. However, we have to be really careful. We can easily get unintended results if we aren‚Äôt absolutely sure that we‚Äôve already accounted for every possible combination of relevant conditions in the two-sided formulas that come before.</p>
</div>
</div>
<p>Let‚Äôs go ahead and wrap up this chapter with one consolidated code chunk that cleans our demographics data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>demographics <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode variables</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Collapse continuous age into 3 categories</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_3cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">12</span>  <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># child</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">18</span>  <span class="sc">~</span> <span class="dv">2</span>, <span class="co"># adolescent</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">~</span> <span class="dv">3</span>  <span class="co"># adult</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_3cat_f =</span> <span class="fu">factor</span>(</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      age_3cat, </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"child"</span>, <span class="st">"adolescent"</span>, <span class="st">"adult"</span>)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine race and ethnicity</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_eth_4cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(hispanic) <span class="sc">|</span> hispanic <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>) <span class="sc">~</span> <span class="cn">NA_real_</span>, <span class="co"># Unknown ethnicity</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>      hispanic <span class="sc">==</span> <span class="dv">1</span>                           <span class="sc">~</span> <span class="dv">3</span>,        <span class="co"># Hispanic, any race</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(race) <span class="sc">|</span> race <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>)         <span class="sc">~</span> <span class="cn">NA_real_</span>, <span class="co"># non-Hispanic, unknown race</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">==</span> <span class="dv">1</span>                               <span class="sc">~</span> <span class="dv">1</span>,        <span class="co"># White, non-Hispanic</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">==</span> <span class="dv">2</span>                               <span class="sc">~</span> <span class="dv">2</span>,        <span class="co"># Black, non-Hispanic</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                                    <span class="sc">~</span> <span class="dv">4</span>         <span class="co"># Other race, non-Hispanic</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_eth_4cat_f =</span> <span class="fu">factor</span>(</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>      race_eth_4cat,</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"White, non-Hispanic"</span>, <span class="st">"Black, non-Hispanic"</span>, <span class="st">"Hispanic, any race"</span>,</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Other race, non-Hispanic"</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 8
      id   age  race hispanic age_3cat age_3cat_f race_eth_4cat race_eth_4cat_f 
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;              &lt;dbl&gt; &lt;fct&gt;           
 1     1    15     1        7        2 adolescent            NA &lt;NA&gt;            
 2     2    19     2        0        3 adult                  2 Black, non-Hisp‚Ä¶
 3     3    14     1        1        2 adolescent             3 Hispanic, any r‚Ä¶
 4     4     3     4        0        1 child                  4 Other race, non‚Ä¶
 5     5    10     7        1        1 child                  3 Hispanic, any r‚Ä¶
 6     6    18     1        0        3 adult                  1 White, non-Hisp‚Ä¶
 7     7    22     2        1        3 adult                  3 Hispanic, any r‚Ä¶
 8     8    11     9        9        1 child                 NA &lt;NA&gt;            
 9     9     5     1        0        1 child                  1 White, non-Hisp‚Ä¶
10    10    NA     3        1       NA &lt;NA&gt;                   3 Hispanic, any r‚Ä¶</code></pre>
</div>
</div>
<p>Now that we‚Äôve mastered conditional operations, we can use them to help us navigate another common data collection technique in epidemiology ‚Äì skip patterns.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/github\.com\/brad-cannell\/r4epi");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/working_with_character_strings/working_with_character_strings.html" class="pagination-link" aria-label="Working with Character Strings">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Working with Character Strings</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/multiple_data_frames/multiple_data_frames.html" class="pagination-link" aria-label="Working with Multiple Data Frames">
        <span class="nav-page-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Working with Multiple Data Frames</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>R for Epidemiology</p>
</div>   
    <div class="nav-footer-center">

<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/brad-cannell/r4epi/edit/main/chapters/conditional_operations/conditional_operations.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brad-cannell/r4epi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://Quarto/.org/">Quarto/</a>.</p>
</div>
  </div>
</footer>




</body></html>