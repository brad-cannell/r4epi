<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>37&nbsp; Using the purrr Package â€“ R 4 Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/intro_git_github/intro_git_github.html" rel="next">
<link href="../../chapters/writing_for_loops/writing_for_loops.html" rel="prev">
<link href="../../r4epi_favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/intro_repeated_operations/intro_repeated_operations.html">Repeated Operations</a></li><li class="breadcrumb-item"><a href="../../chapters/using_purrr/using_purrr.html"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Using the purrr Package</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">R 4 Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/brad-cannell/r4epi_quarto/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../R-4-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/contributing/contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/about_the_authors/about_the_authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the Authors</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/installing_r_and_rstudio/installing_r_and_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Installing R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/what_is_r/what_is_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">What is R?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/navigating_rstudio/navigating_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Navigating the RStudio Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/speaking_r/speaking_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Speaking Râ€™s Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/lets_get_programming/lets_get_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Letâ€™s Get Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/asking_questions/asking_questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Asking Questions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Coding Tools and Best Practices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/r_scripts/r_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Scripts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/quarto_files/quarto_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quarto Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/r_projects/projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R Projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/best_practices/best_practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Coding Best Practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_pipes/using_pipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Using Pipes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Transfer</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/data_transfer/data_transfer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Data Transfer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/file_paths/file_paths.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">File Paths</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/importing_plain_text/importing_plain_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Importing Plain Text Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/importing_binary_files/importing_binary_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Importing Binary Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/rstudio_import_tool/rstudio_import_tool.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">RStudioâ€™s Data Import Tool</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/exporting_data_to_disk/exporting_data_to_disk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Exporting Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Descriptive Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_descriptive_analysis/intro_descriptive_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Descriptive Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/categorical_variables/categorical_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Numerical Descriptions of Categorical Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/central_tendency/central_tendency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Measures of Central Tendency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dispersion/dispersion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Measures of Dispersion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cont_out_cont_pred/cont_out_cont_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Continuous Outcome and a Continuous Predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cont_out_cat_pred/cont_out_cat_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Continuous Outcome and a Categorical Predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cat_out_cat_pred/cat_out_cat_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Categorical Outcome and a Categorical Predictor</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_data_management/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Introduction to Data Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/creating_and_modifying_columns/creating_and_modifying_columns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Creating and Modifying Columns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/subsetting_data_frames/subsetting_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Subsetting Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/working_with_dates/working_with_dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/working_with_character_strings/working_with_character_strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Working with Character Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/conditional_operations/conditional_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Conditional Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/multiple_data_frames/multiple_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Working with Multiple Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/restructuring_data_frames/restructuring_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Restructuring Data frames</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Repeated Operations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_repeated_operations/intro_repeated_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Introduction to Repeated Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/writing_functions/writing_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dplyr_column_wise/dplyr_column_wise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Column-wise Operations in dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/writing_for_loops/writing_for_loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Writing For Loops</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_purrr/using_purrr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Using the purrr Package</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Collaboration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_git_github/intro_git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Introduction to git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_git_github/using_git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Using git and GitHub</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Presenting Results</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/creating_word_tables/creating_word_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Creating Tables with R and Microsoft Word</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#comparing-for-loops-and-the-map-functions" id="toc-comparing-for-loops-and-the-map-functions" class="nav-link active" data-scroll-target="#comparing-for-loops-and-the-map-functions"><span class="header-section-number">37.1</span> Comparing for loops and the map functions</a></li>
  <li><a href="#using-purrr-for-data-transfer" id="toc-using-purrr-for-data-transfer" class="nav-link" data-scroll-target="#using-purrr-for-data-transfer"><span class="header-section-number">37.2</span> Using purrr for data transfer</a>
  <ul class="collapse">
  <li><a href="#example-1-importing-multiple-sheets-from-an-excel-workbook" id="toc-example-1-importing-multiple-sheets-from-an-excel-workbook" class="nav-link" data-scroll-target="#example-1-importing-multiple-sheets-from-an-excel-workbook"><span class="header-section-number">37.2.1</span> Example 1: Importing multiple sheets from an Excel workbook</a></li>
  <li><a href="#why-walk-instead-of-map" id="toc-why-walk-instead-of-map" class="nav-link" data-scroll-target="#why-walk-instead-of-map"><span class="header-section-number">37.2.2</span> Why walk instead of map?</a></li>
  <li><a href="#why-we-didnt-assign-the-return-value-of-walk-to-an-object" id="toc-why-we-didnt-assign-the-return-value-of-walk-to-an-object" class="nav-link" data-scroll-target="#why-we-didnt-assign-the-return-value-of-walk-to-an-object"><span class="header-section-number">37.2.3</span> why we didnâ€™t assign the return value of <code>walk()</code> to an object?</a></li>
  </ul></li>
  <li><a href="#using-purrr-for-data-management" id="toc-using-purrr-for-data-management" class="nav-link" data-scroll-target="#using-purrr-for-data-management"><span class="header-section-number">37.3</span> Using purrr for data management</a>
  <ul class="collapse">
  <li><a href="#example-1-adding-na-at-multiple-positions" id="toc-example-1-adding-na-at-multiple-positions" class="nav-link" data-scroll-target="#example-1-adding-na-at-multiple-positions"><span class="header-section-number">37.3.1</span> Example 1: Adding NA at multiple positions</a></li>
  <li><a href="#example-2.-detecting-matching-values-by-position" id="toc-example-2.-detecting-matching-values-by-position" class="nav-link" data-scroll-target="#example-2.-detecting-matching-values-by-position"><span class="header-section-number">37.3.2</span> Example 2. Detecting matching values by position</a></li>
  </ul></li>
  <li><a href="#using-purrr-for-analysis" id="toc-using-purrr-for-analysis" class="nav-link" data-scroll-target="#using-purrr-for-analysis"><span class="header-section-number">37.4</span> Using purrr for analysis</a>
  <ul class="collapse">
  <li><a href="#example-1-continuous-statistics" id="toc-example-1-continuous-statistics" class="nav-link" data-scroll-target="#example-1-continuous-statistics"><span class="header-section-number">37.4.1</span> Example 1: Continuous statistics</a></li>
  <li><a href="#example-2-categorical-statistics" id="toc-example-2-categorical-statistics" class="nav-link" data-scroll-target="#example-2-categorical-statistics"><span class="header-section-number">37.4.2</span> Example 2: Categorical statistics</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/brad-cannell/r4epi_quarto/edit/main/chapters/using_purrr/using_purrr.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brad-cannell/r4epi_quarto/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/intro_repeated_operations/intro_repeated_operations.html">Repeated Operations</a></li><li class="breadcrumb-item"><a href="../../chapters/using_purrr/using_purrr.html"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Using the purrr Package</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Using the purrr Package</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!--
Hidden comments placeholder
---------------------------

To preview:
bookdown::preview_chapter("chapters/07_part_repeated_operations/05_using_purrr.Rmd")

Copy and paste:
ðŸ‘†**Here's what we did above:**
-->
<p>In this final chapter of the repeated operations part of the book, we are going to discuss the <a href="https://purrr.tidyverse.org/">purrr package</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="four_methods.png" class="img-fluid figure-img" width="900"></p>
<figcaption>For loops graphic</figcaption>
</figure>
</div>
</div>
</div>
<p>The <code>purrr</code> package provides a really robust set of functions that can help us more efficiently complete a bunch of different tasks in R. For the purposes of this chapter, however, we are going to focus on using the <code>purrr::map</code> functions as an alternative approach to removing unnecessary repetition from the various different code chunks weâ€™ve already seen in other chapters.</p>
<p>For our purposes, you can think of the <code>purrr::map</code> functions as a replacement for for loops. In other words, you can think of them as <em>doing</em> the same thing as a for loop, but writing the code in a different way.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We also want to mention that the <code>purrr</code> package is closely related to base Râ€™s <code>apply</code> functions (i.e., <code>apply()</code>, <code>lapply()</code>, <code>sapply()</code>, <code>tapply()</code>). We arenâ€™t going to discuss those functions any further, but you will often see them mentioned side-by-side as solutions to a given coding challenge on websites like Stack Overflow. The <code>purrr</code> package is partially meant to be an improved replacement for the <code>apply</code> functions.</p>
</div>
</div>
<p>As usual, letâ€™s start by taking a look at a simple example â€“ the same one we used to start the <a href="#column-wise-operations-in-dplyr">chapter on column-wise operations</a> and the <a href="#writing-for-loops">chapter on writing for loops</a>. Afterwards, we will compare the basic structure of <code>purrr::map</code> functions to the basic structure of for loops. Finally, we will work through a number of the examples weâ€™ve already worked through in this part of the book using the <code>purrr</code> approach.</p>
<p>At this point, we will go ahead and load <code>dplyr</code> and <code>purrr</code> and simulate our data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df_xyz <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 -0.230   0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705  0.111 -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  -1.69 
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>In the <a href="#column-wise-operations-in-dplyr">chapter on column-wise operations</a> we used <code>dplyr</code>â€™s <code>across()</code> function to efficiently find the mean of each column in the <code>df_xyz</code> data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_xyz <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">.cols  =</span> <span class="fu">everything</span>(),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">.fns   =</span> mean,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">"{col}_mean"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 3
  x_mean y_mean z_mean
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 0.0746  0.209 -0.425</code></pre>
</div>
</div>
<p>In the <a href="#writing-for-loops">chapter on writing for loops</a>, we learned an alternative approach that would also work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"double"</span>, <span class="fu">ncol</span>(df_xyz))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(df_xyz)) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  xyz_means[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[i]])</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.07462564  0.20862196 -0.42455887</code></pre>
</div>
</div>
<p>An alternative way to complete the analysis above is with the <code>map_dbl()</code> function from the <code>purrr</code> package like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> mean</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          x           y           z 
 0.07462564  0.20862196 -0.42455887 </code></pre>
</div>
</div>
<p>ðŸ‘†<strong>Hereâ€™s what we did above:</strong></p>
<ul>
<li><p>We used <code>purr</code>â€™s <code>map_dbl()</code> function to iteratively calculate the mean of each column in the <code>df_xyz</code> data frame. There are other <code>map</code> functions beside <code>map_dbl()</code>. We will eventually discuss them all.</p></li>
<li><p>You can type <code>?purrr::map_dbl</code> into your R console to view the help documentation for this function and follow along with the explanation below.</p></li>
<li><p>The first argument to all of the <code>map</code> functions is the <code>.x</code> argument. You should pass the name of a list, data frame, or vector that you want to iterate over to the <code>.x</code> argument. If the object passed to the <code>.x</code> argument is a vector, then <code>map</code> will apply the function passed to the <code>.f</code> argument (see below) to each element of the vector. If the object passed to the <code>.x</code> argument is a data frame, then <code>map</code> will apply the function passed to the <code>.f</code> argument to each column of the data frame. Above, we passed the <code>df_xyz</code> data frame to the <code>.x</code>.</p></li>
<li><p>The second argument to all of the <code>map</code> functions is the <code>.f</code> argument. You should pass the name of function, or functions, you want to apply iteratively to the object you passed to the <code>.x</code> argument. In the example above, we passed the mean function to the <code>.f</code> argument. Notice that we typed <code>mean</code> without the parentheses.</p></li>
<li><p>The third argument to all of the <code>map</code> functions is the <code>...</code> argument. In this case, the <code>...</code> argument is where we pass any additional arguments to the function we passed to the <code>.f</code> argument. For example, we passed the <code>mean</code> function to the <code>.f</code> argument above. If the data frame above had missing values, we could have passed <code>na.rm = TRUE</code> to the <code>mean()</code> function using the <code>...</code> argument. We saw a similar <a href="../dplyr_column_wise/dplyr_column_wise.html#the-across-function">example of this when we were learning about <code>across()</code></a>.</p></li>
</ul>
<p>As you can see, using the <code>map_dbl()</code> package requires far less code than the for loop did, which has at least two potential advantages. First, itâ€™s less typing, which means less opportunity for typos. Second, many people in the R community feel as though this <em>functional</em> (i.e., use of a function) approach to iteration is much easier to read and understand than the traditional for loop approach.</p>
<p>Additionally, you may have also noticed that we were able to assign the returned results of <code>map_dbl(df_xyz, mean)</code> to an object in our global environment in the usual way (i.e., with the assignment arrow). This eliminates the need for creating a structure to hold our results ahead of time as we had to do with the for loop.</p>
<p>Finally, when we use <code>map_dbl()</code> there isnâ€™t a leftover index variable (i.e., <code>i</code>) floating around our global environment the way there was when we were writing for loops.</p>
<p>For those reasons, and possibly others, itâ€™s been an observation that the majority of R users prefer the functional approach to iteration â€“ either <code>purrr</code> or the <code>apply</code> functions â€“ over using for loops in most situations.</p>
<p>However, some of you reading this text book might have had their first experiences with programming in a language other than R that relied more heavily on for loops. For this reason, you might tend to think first in terms of a for loop and then mentally convert the for loop to a <code>map</code> function before writing your code. Therefore, the next section is going to compare and contrast the <em>basic</em> for loop with the <code>map</code> functions. You may find this section instructive or interesting even if you arenâ€™t someone who first learned iteration using for loops.</p>
<section id="comparing-for-loops-and-the-map-functions" class="level2" data-number="37.1">
<h2 data-number="37.1" class="anchored" data-anchor-id="comparing-for-loops-and-the-map-functions"><span class="header-section-number">37.1</span> Comparing for loops and the map functions</h2>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="compare.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Comparing for loops and map functions</figcaption>
</figure>
</div>
</div>
</div>
<p>In this section, we will compare for loops and the <code>purrr::map</code> functions using the example from the beginning of the chapter.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="compare_for_map.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Comparing for loops and map functions using example</figcaption>
</figure>
</div>
</div>
</div>
<p>Itâ€™s probably obvious to you at this point, but when using <code>purrr::map</code> instead of a for loop, we will be using one of the <code>map</code> functions instead of the <code>for()</code> function.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="compare_assign.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Assigning the results of map function to object</figcaption>
</figure>
</div>
</div>
</div>
<p>Next, as previously discussed above, we are able to assign the returned results of <code>map_dbl(df_xyz, mean)</code> to an object in our global environment in the usual way (i.e., with the assignment arrow). This eliminates the need for creating a structure to hold our results ahead of time as we had to do with the for loop. It also eliminates the need to write code that explicitly updates the returned results structure at each iteration (i.e., <code>xyz_means[[i]]</code>) as we had to do with the for loop.</p>
<p>However, one nice byproduct of creating the structure to hold our returned results ahead of time was that doing so made it obvious what form and type we expected our results to take.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="compare_type1.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Setting the type of the returned results structure I</figcaption>
</figure>
</div>
</div>
</div>
<p>In the <code>xyz_means</code> example above, itâ€™s obvious that we expected our returned results to be a vector of numbers because the structure we created to contain our results was a vector of type double.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="compare_type2.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Setting the type of the returned results structure II</figcaption>
</figure>
</div>
</div>
</div>
<p>When using the <code>purrr::map</code> functions, which <code>map</code> function we choose will serve the same purpose. In the example above, we used <code>map_dbl()</code>, which implied that we expected our results to be a vector of type double. In fact, it not only implied that our results <em>should</em> be a vector of type double, but it <em>guaranteed</em> that our results <em>would</em> be a vector of type double (or we would get an error). In this sense, the <code>map</code> functions are much safer to use than for loops â€“ we donâ€™t get unexpected results.</p>
<p>As a silly example, letâ€™s say that we want to extract the number of letters in each name contained in a vector of names. Weâ€™ll start by creating a vector that contains three random names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Avril"</span>, <span class="st">"Joe"</span>, <span class="st">"Whitney"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, letâ€™s create a structure to contain our results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>n_letters <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"double"</span>, <span class="fu">length</span>(names)) <span class="co"># Expecting double</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code above (i.e., <code>vector("double", length(names))</code>) implies that we expect our results to be type double, which make sense if we expect our results to be the number of letters in some names.</p>
<p>Finally, letâ€™s write our for loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(names)) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  n_letters[[i]] <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(names[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">w"</span>) <span class="co"># Returns character</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>n_letters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A" "J" "W"</code></pre>
</div>
</div>
<p>Uh, oh! Those â€œcountsâ€ are letters! What happened? Well, apparently we thought that <code>stringr::str_extract(names[[i]], "\\w")</code> would return the count of letters in each name. In actuality, it returns the first letter in each name.</p>
<p>Again, this is a silly example. In this case, itâ€™s easy to see and fix our mistake. However, it could be very difficult to debug this problem if the code were buried in a long script or inside of other functions.</p>
<p>Now, letâ€™s see what happens when we use <code>purrr</code>. We still start with the names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Avril"</span>, <span class="st">"Joe"</span>, <span class="st">"Whitney"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also still imply our expectations that the returned result should be a numeric vector. However, this time we do so by using the <code>map_dbl</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>n_letters <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> names, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> stringr<span class="sc">::</span>str_extract, <span class="st">"</span><span class="sc">\\</span><span class="st">w{1}"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `map_dbl()`:
â„¹ In index: 1.
Caused by error:
! Can't coerce from a string to a double.</code></pre>
</div>
</div>
<p>But, this time, we donâ€™t get an unexpected result. This time, we get an error. This may seem like a pain if you are newish to programming. But itâ€™s much better to get an error that you can go fix than an incorrect result that you are totally unaware of!</p>
<p>While we are discussing return types, letâ€™s go ahead and introduce some of the other <code>map</code> functions. They are:</p>
<ul>
<li><p><code>map_dbl()</code>, which weâ€™ve already seen. The <code>map_dbl()</code> function always returns a numeric vector or an error.</p></li>
<li><p><code>map_int()</code>, which always returns an integer vector or an error.</p></li>
<li><p><code>map_lgl()</code>, which always returns a logical vector or an error.</p></li>
<li><p><code>map_chr()</code>, which always returns a character vector or an error.</p></li>
<li><p><code>map_dfr()</code>, which always returns a data frame created by row-binding results or an error.</p></li>
<li><p><code>map_dfc()</code>, which always returns a data frame created by column-binding results or an error.</p></li>
<li><p><code>map()</code>, which is the most generic, and always returns a list (or an error). Weâ€™ve havenâ€™t discussed lists much in this book, but whenever something wonâ€™t fit into any other kind of object, it will fit into a list.</p></li>
<li><p><code>walk()</code>, which is the only <code>map</code> function without a <code>map</code> name. We will use <code>walk()</code> when we are more interested in the â€œside-effectsâ€ of the function passed to <code>.f</code> than its return value. What in the world does that mean? It means that the only thing <code>walk()</code> â€œreturnsâ€ is exactly what was passed to its <code>.x</code> argument. No matter what you pass to the <code>.f</code> argument, the object passed to <code>.x</code> will be returned by <code>walk()</code> unmodified. Your next question might be, â€œthen whatâ€™s the point? How could that ever be useful?â€ Typically, <code>walk()</code> will only be useful to us for plotting (e.g., where you are interested in viewing the plots, but not saving them as an object) and/or data transfer (we will see an example of this below).</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="compare_object.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Replacing the arguments in the for function with the object we pass to the .x argument of the map function</figcaption>
</figure>
</div>
</div>
</div>
<p>Next, the object we pass to the <code>.x</code> function of the <code>map</code> function replaces the entire <code>i in seq_along(object)</code> pattern that is passed to the for loop. Again, if the object passed to the <code>.x</code> argument is a vector, then <code>map</code> will apply the function passed to the <code>.f</code> argument to each element of the vector. If the object passed to the <code>.x</code> argument is a data frame, then <code>map</code> will apply the function passed to the <code>.f</code> argument to each column of the data frame.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="compare_function.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Replacing the body of the for function with the function we pass to the .f argument of the map function</figcaption>
</figure>
</div>
</div>
</div>
<p>Finally, the function passed to the <code>.f</code> argument can replace the rest of the â€œstuffâ€ going on in the for loop body. We can pass a single function (e.g., mean) to the <code>.f</code> argument as we did above. However, we can also pass anonymous functions to the <code>.f</code> argument. We pass anonymous functions to the <code>.f</code> function in basically the exact same way passed anonymous functions to the <code>.fns</code> argument of the <code>across()</code> function in the <a href="#column-wise-operations-in-dplyr">chapter on column-wise operations</a>. And, yes, we can also write our anonymous functions using purrr-style lambdas. In fact, the purrr-style lambda syntax is called the purrr-style lambda syntax because it was first created for the <code>purrr</code> package and later adopted by <code>dplyr::across()</code>. That name probably makes a lot more sense than it did a couple of chapters ago!</p>
<p>That pretty much covers the basics of using the <code>purrr::map</code> functions. If youâ€™ve been reading this book in sequence, there wonâ€™t really be any conceptually new material in this chapter. Weâ€™re basically going to do the same things weâ€™ve been doing for the last couple of chapters. Weâ€™ll just be using a slightly different (and perhaps preferable) syntax. If you havenâ€™t been reading the book in sequence, you might want to read the chapters on <a href="#writing-functions">writing functions</a>, <a href="#column-wise-operations-in-dplyr">column-wise operations</a>, and <a href="#writing-for-loops">writing for loops</a> to get the most of the examples below.</p>
</section>
<section id="using-purrr-for-data-transfer" class="level2" data-number="37.2">
<h2 data-number="37.2" class="anchored" data-anchor-id="using-purrr-for-data-transfer"><span class="header-section-number">37.2</span> Using purrr for data transfer</h2>
<section id="example-1-importing-multiple-sheets-from-an-excel-workbook" class="level3" data-number="37.2.1">
<h3 data-number="37.2.1" class="anchored" data-anchor-id="example-1-importing-multiple-sheets-from-an-excel-workbook"><span class="header-section-number">37.2.1</span> Example 1: Importing multiple sheets from an Excel workbook</h3>
<p>In the <a href="#writing-functions">chapter on writing functions</a> we used a for loop to help us import data from an Excel workbook that was stored across multiple sheets. We will once again go through this example using the <code>purrr</code> approach.</p>
<p>The simulated data contains some demographic information about three different cities: Houston, Atlanta, and Charlotte. In this scenario, we need to import each sheet, clean the data, and combine them into a single data frame in order to complete our analysis. First, we will load the <code>readxl</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://github.com/brad-cannell/r4epi/blob/master/data/city_ses.xlsx">You may click here to download this file to your computer.</a></p>
<p>Then, we may import each sheet like this:</p>
<!-- No need to cache because eval=FALSE -->
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>houston <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"city_ses.xlsx"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">"Houston"</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>atlanta <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"city_ses.xlsx"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">"Atlanta"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>charlotte <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"city_ses.xlsx"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">"Charlotte"</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ðŸš©In the code chunks above, we have essentially the same code copied more than twice. Thatâ€™s a red flag that we should be thinking about removing unnecessary repetition from our code. So, our next step was to write a function to remove some of the unnecessary repetition:</p>
<!-- No need to cache because eval=FALSE -->
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>import_cities <span class="ot">&lt;-</span> <span class="cf">function</span>(sheet) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"city_ses.xlsx"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> sheet</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>houston   <span class="ot">&lt;-</span> <span class="fu">import_cities</span>(<span class="st">"Houston"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>atlanta   <span class="ot">&lt;-</span> <span class="fu">import_cities</span>(<span class="st">"Atlanta"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>charlotte <span class="ot">&lt;-</span> <span class="fu">import_cities</span>(<span class="st">"Charlotte"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ðŸš©However, that approach still has some repetition. So, we next learned how to use a for loop as an alternative approach:</p>
<!-- No need to cache because eval=FALSE -->
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"city_ses.xlsx"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(path)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(sheets)) {</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  new_nm <span class="ot">&lt;-</span> <span class="fu">tolower</span>(sheets[[i]])</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(new_nm, <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> sheets[[i]]))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That works just fine! However, we could alternatively use <code>purrr::walk()</code> instead like this:</p>
<!-- No need to cache because eval=FALSE -->
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the file path to an object so we don't have to type it repeatedly </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or hard-code it in.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"city_ses.xlsx"</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">excel_sheets</span>(path),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    new_nm <span class="ot">&lt;-</span> <span class="fu">tolower</span>(x)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(new_nm, <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> x), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>houston</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  pid     age sex   ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1 001      13 F            88
2 003      13 F            78
3 007      14 M            83
4 014      12 F            76
5 036      13 M            84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>atlanta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  id      age gender ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
1 002      14 M             64
2 009      15 M             35
3 012      13 F             70
4 013      13 F             66
5 022      12 F             59</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>charlotte</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  pid     age sex     ses
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 004      13 F        84
2 011      14 M        66
3 018      12 M        92
4 023      12 M        89
5 030      13 F        83</code></pre>
</div>
</div>
<p>ðŸ‘†<strong>Hereâ€™s what we did above:</strong></p>
<ul>
<li><p>We used the <code>walk()</code> function from the <code>purrr</code> package to import every sheet from an Excel workbook.</p></li>
<li><p>First, we saved the path to the Excel workbook to a separate object. We didnâ€™t have to do this. However, doing so prevented us from having to type out the full file path repeatedly in the rest of our code. Additionally, if the file path ever changed, we would only have to update it in one place.</p></li>
<li><p>Second, we passed the return value of the <code>excel_sheets()</code> function, which is a character vector containing each sheet name, to the <code>.x</code> argument of the <code>walk()</code> function. We didnâ€™t have to do this. We could have typed each sheet name manually. However, there shouldnâ€™t be any accidental typos if we use the <code>excel_sheets()</code> function, and we donâ€™t have to make any changes to our code if more sheets are added to the Workbook in the future.</p></li>
<li><p>Third, we passed an anonymous function to the <code>walk()</code>â€™s <code>.f</code> argument. Inside the anonymous function, we assigned each data frame created by the <code>read_excel()</code> function to our global environment using the <code>assign()</code> function. Notice that because we are using the <code>assign()</code> <em>inside</em> of another function, we have to explicitly tell the <code>assign()</code> function to assign the data frames being imported to the global environment using <code>envir = .GlobalEnv</code>. Without getting too technical, keep in mind that functions create their own little enclosed environments (<a href="../writing_functions/writing_functions.html#lexical-scoping-and-functions">see a discussion here</a>), which makes the <code>envir = .GlobalEnv</code> part necessary.</p></li>
</ul>
<p>Additionally, you may have some questions swirling around your head right now about the <code>walk()</code> function itself. In particular, you might be wondering why we used <code>walk()</code> instead of <code>map()</code> and why we didnâ€™t assign the return value of <code>walk()</code> to an object. Weâ€™ll answer both questions next.</p>
</section>
<section id="why-walk-instead-of-map" class="level3" data-number="37.2.2">
<h3 data-number="37.2.2" class="anchored" data-anchor-id="why-walk-instead-of-map"><span class="header-section-number">37.2.2</span> Why walk instead of map?</h3>
<p>The short answer is that <code>map</code> functions return <em>one</em> thing (i.e., a vector, list, or data frame). In this situation, we wanted to â€œreturnâ€ <em>three</em> things (i.e., the <code>houston</code> data frame, the <code>atlanta</code> data frame, and the <code>charlotte</code> data frame).</p>
<p>Technically, we could have used the <code>map()</code> function to return a list of data frames like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>list_of_df <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">excel_sheets</span>(path),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> .x)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(list_of_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ : tibble [5 Ã— 4] (S3: tbl_df/tbl/data.frame)
  ..$ pid      : chr [1:5] "001" "003" "007" "014" ...
  ..$ age      : num [1:5] 13 13 14 12 13
  ..$ sex      : chr [1:5] "F" "F" "M" "F" ...
  ..$ ses_score: num [1:5] 88 78 83 76 84
 $ : tibble [5 Ã— 4] (S3: tbl_df/tbl/data.frame)
  ..$ id       : chr [1:5] "002" "009" "012" "013" ...
  ..$ age      : num [1:5] 14 15 13 13 12
  ..$ gender   : chr [1:5] "M" "M" "F" "F" ...
  ..$ ses_score: num [1:5] 64 35 70 66 59
 $ : tibble [5 Ã— 4] (S3: tbl_df/tbl/data.frame)
  ..$ pid: chr [1:5] "004" "011" "018" "023" ...
  ..$ age: num [1:5] 13 14 12 12 13
  ..$ sex: chr [1:5] "F" "M" "M" "M" ...
  ..$ ses: num [1:5] 84 66 92 89 83</code></pre>
</div>
</div>
<p>From there, we could extract and modify each data frame from the list like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>houston <span class="ot">&lt;-</span> list_of_df[[<span class="dv">1</span>]]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>houston</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  pid     age sex   ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1 001      13 F            88
2 003      13 F            78
3 007      14 M            83
4 014      12 F            76
5 036      13 M            84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>atlanta <span class="ot">&lt;-</span> list_of_df[[<span class="dv">2</span>]]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>atlanta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  id      age gender ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
1 002      14 M             64
2 009      15 M             35
3 012      13 F             70
4 013      13 F             66
5 022      12 F             59</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>charlotte <span class="ot">&lt;-</span> list_of_df[[<span class="dv">2</span>]]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>charlotte</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  id      age gender ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
1 002      14 M             64
2 009      15 M             35
3 012      13 F             70
4 013      13 F             66
5 022      12 F             59</code></pre>
</div>
</div>
<p>Of course, now we have a bunch of repetition again! Alternatively, we could have also used the <code>map_dfr()</code>, which always returns a data frame created by row-binding results or an error. You can think of <code>map_dfr()</code> as taking the three data frames above and passing them to the <code>bind_rows()</code> function and returning that result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Passing list_of_df to bind_rows()</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(list_of_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 Ã— 7
   pid     age sex   ses_score id    gender   ses
   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
 1 001      13 F            88 &lt;NA&gt;  &lt;NA&gt;      NA
 2 003      13 F            78 &lt;NA&gt;  &lt;NA&gt;      NA
 3 007      14 M            83 &lt;NA&gt;  &lt;NA&gt;      NA
 4 014      12 F            76 &lt;NA&gt;  &lt;NA&gt;      NA
 5 036      13 M            84 &lt;NA&gt;  &lt;NA&gt;      NA
 6 &lt;NA&gt;     14 &lt;NA&gt;         64 002   M         NA
 7 &lt;NA&gt;     15 &lt;NA&gt;         35 009   M         NA
 8 &lt;NA&gt;     13 &lt;NA&gt;         70 012   F         NA
 9 &lt;NA&gt;     13 &lt;NA&gt;         66 013   F         NA
10 &lt;NA&gt;     12 &lt;NA&gt;         59 022   F         NA
11 004      13 F            NA &lt;NA&gt;  &lt;NA&gt;      84
12 011      14 M            NA &lt;NA&gt;  &lt;NA&gt;      66
13 018      12 M            NA &lt;NA&gt;  &lt;NA&gt;      92
14 023      12 M            NA &lt;NA&gt;  &lt;NA&gt;      89
15 030      13 F            NA &lt;NA&gt;  &lt;NA&gt;      83</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using map_dfr() to directly produce the same result</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">excel_sheets</span>(path),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> .x)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 Ã— 7
   pid     age sex   ses_score id    gender   ses
   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
 1 001      13 F            88 &lt;NA&gt;  &lt;NA&gt;      NA
 2 003      13 F            78 &lt;NA&gt;  &lt;NA&gt;      NA
 3 007      14 M            83 &lt;NA&gt;  &lt;NA&gt;      NA
 4 014      12 F            76 &lt;NA&gt;  &lt;NA&gt;      NA
 5 036      13 M            84 &lt;NA&gt;  &lt;NA&gt;      NA
 6 &lt;NA&gt;     14 &lt;NA&gt;         64 002   M         NA
 7 &lt;NA&gt;     15 &lt;NA&gt;         35 009   M         NA
 8 &lt;NA&gt;     13 &lt;NA&gt;         70 012   F         NA
 9 &lt;NA&gt;     13 &lt;NA&gt;         66 013   F         NA
10 &lt;NA&gt;     12 &lt;NA&gt;         59 022   F         NA
11 004      13 F            NA &lt;NA&gt;  &lt;NA&gt;      84
12 011      14 M            NA &lt;NA&gt;  &lt;NA&gt;      66
13 018      12 M            NA &lt;NA&gt;  &lt;NA&gt;      92
14 023      12 M            NA &lt;NA&gt;  &lt;NA&gt;      89
15 030      13 F            NA &lt;NA&gt;  &lt;NA&gt;      83</code></pre>
</div>
</div>
<p>There would be absolutely nothing wrong with taking this approach and then cleaning up the combined data you see above. However, in this case, the preference was to import each sheet as a separate data frame, clean up each separate data frame, and then combine ourselves. If your preference is to use <code>map_dfr()</code> instead, then you definitely should.</p>
</section>
<section id="why-we-didnt-assign-the-return-value-of-walk-to-an-object" class="level3" data-number="37.2.3">
<h3 data-number="37.2.3" class="anchored" data-anchor-id="why-we-didnt-assign-the-return-value-of-walk-to-an-object"><span class="header-section-number">37.2.3</span> why we didnâ€™t assign the return value of <code>walk()</code> to an object?</h3>
<p>As we discussed above, the only thing <code>walk()</code> â€œreturnsâ€ is exactly what was passed to its <code>.x</code> argument. No matter what you pass to the <code>.f</code> argument, the object passed to <code>.x</code> will be returned by <code>walk()</code> unmodified. In this case, that would just be the sheet names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>returned_by_walk <span class="ot">&lt;-</span> <span class="fu">walk</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">excel_sheets</span>(path),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="cf">function</span>(x) {</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    new_nm <span class="ot">&lt;-</span> <span class="fu">tolower</span>(x)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(new_nm, <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> x), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>returned_by_walk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Houston"   "Atlanta"   "Charlotte"</code></pre>
</div>
</div>
<p>Donâ€™t be confused, the data frames are still being imported and assigned to the global environment via the anonymous function we passed to <code>.f</code> above. But, but those data frames arenâ€™t the values <em>returned by</em> <code>walk()</code> â€“ They are a <em>side-effect</em> of the operations taking place inside of <code>walk()</code>.</p>
<p>Finally, we could make our original <code>walk()</code> code slightly more concise by using the purrr-style lambda syntax to write our anonymous function like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"city_ses.xlsx"</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">excel_sheets</span>(path),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">assign</span>(<span class="fu">tolower</span>(.), <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> .), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>houston</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  pid     age sex   ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1 001      13 F            88
2 003      13 F            78
3 007      14 M            83
4 014      12 F            76
5 036      13 M            84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>atlanta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  id      age gender ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
1 002      14 M             64
2 009      15 M             35
3 012      13 F             70
4 013      13 F             66
5 022      12 F             59</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>charlotte</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  pid     age sex     ses
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 004      13 F        84
2 011      14 M        66
3 018      12 M        92
4 023      12 M        89
5 030      13 F        83</code></pre>
</div>
</div>
</section>
</section>
<section id="using-purrr-for-data-management" class="level2" data-number="37.3">
<h2 data-number="37.3" class="anchored" data-anchor-id="using-purrr-for-data-management"><span class="header-section-number">37.3</span> Using purrr for data management</h2>
<section id="example-1-adding-na-at-multiple-positions" class="level3" data-number="37.3.1">
<h3 data-number="37.3.1" class="anchored" data-anchor-id="example-1-adding-na-at-multiple-positions"><span class="header-section-number">37.3.1</span> Example 1: Adding NA at multiple positions</h3>
<p>Weâ€™ll start this section with a relatively simple example using the same data we used to start the <a href="#column-wise-operations-in-dplyr">chapter on column-wise operations</a> and the <a href="#writing-for-loops">chapter on writing for loops</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>df_xyz <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 -0.230   0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705  0.111 -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  -1.69 
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>In those chapters, we used the code below to add missing values to our data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_xyz<span class="sc">$</span>x[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df_xyz<span class="sc">$</span>y[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>df_xyz<span class="sc">$</span>z[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>df_xyz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 NA       0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705 NA     -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  NA    
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p><em>Dealing</em> with those missing values, rather than <em>adding</em> those missing values was the point of the previously mentioned examples. So, we ignored the unnecessary repetition in the code above. But, for all the reasons weâ€™ve been discussing, we should strive to write more robust code. Imagine, for example, that you were adding missing data to hundreds or thousands of rows as part of a simulation study. Using the method above would become problematic pretty quickly.</p>
<p>In this case, it might be useful to start our solution with writing a function (<a href="#writing-functions">click here to review function writing</a>). Letâ€™s name our function <code>add_na_at()</code> because it helps us add an <code>NA</code> value to a vector at a position of our choosing. Logically, then, it follows that we will need to be able to pass our function a <em>vector</em> that we want to add the <code>NA</code> value to, and a <em>position</em> to add the <code>NA</code> value at. So, our first attempt might look something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>add_na_at <span class="ot">&lt;-</span> <span class="cf">function</span>(vect, pos) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  vect[[pos]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Letâ€™s test it out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_na_at</span>(df_xyz<span class="sc">$</span>x, <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>Is a single <code>NA</code> the result we wanted? Nope! If this result is surprising to you, please review the <a href="../writing_functions/writing_functions.html#the-values-your-functions-return">section of the writing functions chapter on return values</a>. Briefly, the last line of our function body is the single value <code>df_xyz$x[[2]]</code>, which was set to be equal to <code>NA</code>. But, we donâ€™t want our function to return just one position of the vector â€“ we want it to return the entire vector. So, letâ€™s reference the entire vector on the last line of the function body:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>add_na_at <span class="ot">&lt;-</span> <span class="cf">function</span>(vect, pos) {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  vect[[pos]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  vect</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_na_at</span>(df_xyz<span class="sc">$</span>x, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.56047565          NA  1.55870831  0.07050839  0.12928774  1.71506499
 [7]  0.46091621 -1.26506123 -0.68685285 -0.44566197</code></pre>
</div>
</div>
<p>Thatâ€™s better! Again, we know that data frame columns <em>are</em> vectors, so we can use our new function inside of mutate to add <code>NA</code> values to each column in our data frame at a position of our choosing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_xyz <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">add_na_at</span>(x, <span class="dv">2</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">add_na_at</span>(y, <span class="dv">4</span>),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">add_na_at</span>(z, <span class="dv">6</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 NA       0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705 NA     -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  NA    
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>I can hear what you are saying now. â€œSure, thatâ€™s the result we wanted, but we didnâ€™t eliminate very much repetitive code.â€ You are not wrong. A case could be made that this code is easier to quickly glance at and understand, but it isnâ€™t much less repetitive. Thatâ€™s where <code>purrr</code> comes in. Letâ€™s try using <code>purrr</code> to come up with a better solution now.</p>
<p>The first question we might ask ourselves is, â€œwhich <code>map</code> function should we choose?â€ Well, we know we want our end result to be a data frame, so it makes sense for us to choose either <code>map_dfr</code> or <code>map_dfc</code>. However, it might be useful to start with the plain <code>map()</code> function that returns a list as we begin to experiment with solving a problem using <code>purrr</code>. This is because R can put almost anything into a list, and therefore, we will almost always get <em>something</em> returned to us (as opposed to an error) by <code>map()</code>. Further, the thing returned to us typically can provide us with some insight into whatâ€™s going on inside <code>.f</code>.</p>
<p>Next, we know that we want to iterate over every column of the <code>df_xyz</code> data frame. So, we can pass it to the <code>.x</code> argument.</p>
<p>We also know that we want each column to get passed to the <code>vect</code> argument of <code>add_na_at()</code> iteratively. So, we want to pass <code>add_na_at</code> (without parentheses) to the <code>.f</code> argument.</p>
<p>Finally, we canâ€™t supply <code>add_na_at()</code> with just one argument â€“ the vector â€“ can we?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_na_at</span>(df_xyz<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in vect[[pos]] &lt;- NA: missing subscript</code></pre>
</div>
</div>
<p>No way! We have to give it position as well. Do you remember which argument allows us to pass any additional arguments to the function we passed to the <code>.f</code> argument?</p>
<p>The <code>...</code> argument is where we pass any additional arguments to the function we passed to the <code>.f</code> argument. But remember, we donâ€™t actually type out <code>... =</code>. We simply type additional arguments, separated by commas, after the function name supplied to <code>.f</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> add_na_at, <span class="dv">2</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$x
 [1] -0.56047565          NA  1.55870831  0.07050839  0.12928774  1.71506499
 [7]  0.46091621 -1.26506123 -0.68685285 -0.44566197

$y
 [1]  1.2240818         NA  0.4007715         NA -0.5558411  1.7869131
 [7]  0.4978505 -1.9666172  0.7013559 -0.4727914

$z
 [1] -1.0678237         NA -1.0260044 -0.7288912 -0.6250393         NA
 [7]  0.8377870  0.1533731 -1.1381369  1.2538149</code></pre>
</div>
</div>
<p>Or alternatively, we can use the purrr-style lambda to pass our function to <code>.f</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">add_na_at</span>(.x, <span class="dv">2</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$x
 [1] -0.56047565          NA  1.55870831  0.07050839  0.12928774  1.71506499
 [7]  0.46091621 -1.26506123 -0.68685285 -0.44566197

$y
 [1]  1.2240818         NA  0.4007715         NA -0.5558411  1.7869131
 [7]  0.4978505 -1.9666172  0.7013559 -0.4727914

$z
 [1] -1.0678237         NA -1.0260044 -0.7288912 -0.6250393         NA
 [7]  0.8377870  0.1533731 -1.1381369  1.2538149</code></pre>
</div>
</div>
<p>Notice that we have to use the special <code>.x</code> symbol inside the function call where we would normally want to type the name of the column we want the function to operate on. We saw something similar before in the <a href="#column-wise-operations-in-dplyr">chapter on column-wise operations</a>.</p>
<p>Now, letâ€™s discuss the result we are getting. The result you see above is a list, which is what <code>map()</code> will always return to us. Specifically, this is a list with three elements â€“ <code>x</code>, <code>y</code>, and <code>z</code>. Each element of the list is a vector of numbers. Does this feel familiar? Does it seem sort of similar to a data frame? If so, good intuition! In R, a data frame <em>is</em> a list. Itâ€™s simply a special case of a list. Itâ€™s a special case because all vectors in the data frame must have the length, and because R knows to print each vector to the screen as a column. In fact, we can easily convert the list above to a data frame by passing it to the <code>as.data.frame()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">add_na_at</span>(.x, <span class="dv">2</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             x          y          z
1  -0.56047565  1.2240818 -1.0678237
2           NA         NA         NA
3   1.55870831  0.4007715 -1.0260044
4   0.07050839         NA -0.7288912
5   0.12928774 -0.5558411 -0.6250393
6   1.71506499  1.7869131         NA
7   0.46091621  0.4978505  0.8377870
8  -1.26506123 -1.9666172  0.1533731
9  -0.68685285  0.7013559 -1.1381369
10 -0.44566197 -0.4727914  1.2538149</code></pre>
</div>
</div>
<p>Alternatively, we could just use <code>map_dfc</code> as a shortcut instead:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfc</span>(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">add_na_at</span>(.x, <span class="dv">2</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 NA      NA     NA    
 3  1.56    0.401 -1.03 
 4  0.0705 NA     -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  NA    
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>Why <code>map_dfc</code> instead of <code>map_dfr</code>? Because we want to combine <code>x</code>, <code>y</code>, and <code>z</code> together as <em>columns</em>, not as rows.</p>
<p>Ok, so we almost have the solution we want. Thereâ€™s just one problem. In the code above, the <code>NA</code> is always being put into the second position because we have <code>2</code> hard-coded into <code>add_na_at(.x, 2)</code>. We need a way to iterate over our columns <em>and</em> a set of numbers <em>simultaneously</em> in order to get the final result we want. Fortunately, thatâ€™s exactly what the <code>map2</code> variants (i.e., <code>map2_dbl()</code>, <code>map2_int()</code>, <code>map2_lgl()</code>, etc.) of each of the <code>map</code> functions allows us to do.</p>
<p>Instead of supplying map a single object to iterate over (i.e., <code>.x</code>) we can supply it with <em>two</em> objects to iterate over (i.e., <code>.x</code> and <code>.y</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_dfc</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">add_na_at</span>(.x, .y)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 NA       0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705 NA     -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  NA    
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>This can sometimes take a second to wrap your mind around. Hereâ€™s an illustration that may help:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_1.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustrating how map iterates over two objects simultaneously - I</figcaption>
</figure>
</div>
</div>
</div>
<p>In the first iteration, <code>.x</code> took on the value of the first column in the <code>df_xyz</code> data frame (i.e., <code>x</code>) and <code>.y</code> took on the value of the first element in the numeric vector that we passed to the <code>.y</code> argument (i.e., <code>2</code>). Then, the <code>.x</code> and <code>.y</code> were replaced with <code>df_xyz$x</code> and <code>2</code> respectively in the function we passed to <code>.f</code>. The result of that iteration was a vector of numbers that was identical to <code>df_xyz$x</code> except that its second element was an <code>NA</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_2.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustrating how map iterates over two objects simultaneously - II</figcaption>
</figure>
</div>
</div>
</div>
<p>In the second iteration, <code>.x</code> took on the value of the second column in the <code>df_xyz</code> data frame (i.e., <code>y</code>) and <code>.y</code> took on the value of the second element in the numeric vector that we passed to the <code>.y</code> argument (i.e., <code>4</code>). Then, the <code>.x</code> and <code>.y</code> were replaced with <code>df_xyz$y</code> and <code>4</code> respectively in the function we passed to <code>.f</code>. The result of that iteration was a vector of numbers that was identical to <code>df_xyz$y</code> except that its fourth element was an <code>NA</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_3.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustrating how map iterates over two objects simultaneously - III</figcaption>
</figure>
</div>
</div>
</div>
<p>In the third iteration, <code>.x</code> took on the value of the third column in the <code>df_xyz</code> data frame (i.e., <code>z</code>) and <code>.y</code> took on the value of the third element in the numeric vector that we passed to the <code>.y</code> argument (i.e., <code>6</code>). Then, the <code>.x</code> and <code>.y</code> were replaced with <code>df_xyz$z</code> and <code>6</code> respectively in the function we passed to <code>.f</code>. The result of that iteration was a vector of numbers that was identical to <code>df_xyz$z</code> except that its sixth element was an <code>NA</code>.</p>
<p>Finally, <code>map2_dfc()</code> passed all of these vectors to <code>bind_cols()</code> (invisibly to us) and returned them as a data frame.</p>
<p>The code above gives us our entire solution. But, if we really were using this code in a simulation with hundreds or thousands of columns, we probably wouldnâ€™t want to manually supply a vector of column positions to the <code>.y</code> argument. Instead, we could use the <code>sample()</code> function to supply random column positions to the <code>.y</code> argument like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8142020</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_dfc</span>(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.y =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">3</span>, <span class="cn">TRUE</span>),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">add_na_at</span>(.x, .y)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560  NA     -1.07 
 2 NA       0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705 NA     -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  NA    
 7  0.461   0.498  0.838
 8 -1.27   -1.97  NA    
 9 NA       0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>Pretty nice, right?</p>
<p>Before moving on, note that we did not have to create the <code>add_na_at()</code> function ahead of time the way we did. If we didnâ€™t think we would need to use <code>add_na_at()</code> in any other part of our program, we might have decided to pass the code inside of <code>add_na_at()</code> to the <code>.f</code> argument as an anonymous function instead.</p>
<p>As a reminder, here is what our <em>named</em> function looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>add_na_at <span class="ot">&lt;-</span> <span class="cf">function</span>(vect, pos) {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  vect[[pos]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  vect</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here is what our <code>purrr</code> code would look like if we used an <em>anonymous</em> function instead:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_dfc</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="cf">function</span>(vect, pos) {</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    vect[[pos]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    vect</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 NA       0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705 NA     -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  NA    
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>Or, if we used a purrr-style lambda anonymous function instead:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_dfc</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> df_xyz,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> {</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    .x[[.y]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    .x</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 NA       0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705 NA     -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  NA    
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>Whichever style you choose to use is largely just a matter of preference in this case (as it is in many cases).</p>
</section>
<section id="example-2.-detecting-matching-values-by-position" class="level3" data-number="37.3.2">
<h3 data-number="37.3.2" class="anchored" data-anchor-id="example-2.-detecting-matching-values-by-position"><span class="header-section-number">37.3.2</span> Example 2. Detecting matching values by position</h3>
<p>In the <a href="../writing_functions/writing_functions.html#the-function-writing-process">chapter on writing functions</a>, we created an <code>is_match()</code> function. In that scenario, we wanted to see if first name, last name, and street name matched at each ID between our data frames. More specifically, we wanted to combine the two data frames into a single data frame and create three new dummy variables that indicated whether first name, last name, and address matched respectively.</p>
<p>Here are the data frames we simulated and combined:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>people_1 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id_1, <span class="sc">~</span>name_first_1, <span class="sc">~</span>name_last_1, <span class="sc">~</span>street_1,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,     <span class="st">"Easton"</span>,      <span class="cn">NA</span>,           <span class="st">"Alameda"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,     <span class="st">"Elias"</span>,       <span class="st">"Salazar"</span>,    <span class="st">"Crissy Field"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>,     <span class="st">"Colton"</span>,      <span class="st">"Fox"</span>,        <span class="st">"San Bruno"</span>,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>,     <span class="st">"Cameron"</span>,     <span class="st">"Warren"</span>,     <span class="st">"Nottingham"</span>,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span>,     <span class="st">"Carson"</span>,      <span class="st">"Mills"</span>,      <span class="st">"Jersey"</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>,     <span class="st">"Addison"</span>,     <span class="st">"Meyer"</span>,      <span class="st">"Tingley"</span>,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">7</span>,     <span class="st">"Aubrey"</span>,      <span class="st">"Rice"</span>,       <span class="st">"Buena Vista"</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span>,     <span class="st">"Ellie"</span>,       <span class="st">"Schmidt"</span>,    <span class="st">"Division"</span>,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9</span>,     <span class="st">"Robert"</span>,      <span class="st">"Garza"</span>,      <span class="st">"Red Rock"</span>,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>,    <span class="st">"Stella"</span>,      <span class="st">"Daniels"</span>,    <span class="st">"Holland"</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>people_2 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id_2, <span class="sc">~</span>name_first_2, <span class="sc">~</span>name_last_2, <span class="sc">~</span>street_2,</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,     <span class="st">"Easton"</span>,      <span class="st">"Stone"</span>,      <span class="st">"Alameda"</span>,</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,     <span class="st">"Elas"</span>,        <span class="st">"Salazar"</span>,    <span class="st">"Field"</span>,</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>,     <span class="cn">NA</span>,            <span class="st">"Fox"</span>,        <span class="cn">NA</span>,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>,     <span class="st">"Cameron"</span>,     <span class="st">"Waren"</span>,      <span class="st">"Notingham"</span>,</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span>,     <span class="st">"Carsen"</span>,      <span class="st">"Mills"</span>,      <span class="st">"Jersey"</span>,</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>,     <span class="st">"Adison"</span>,      <span class="cn">NA</span>,           <span class="cn">NA</span>,</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="dv">7</span>,     <span class="st">"Aubrey"</span>,      <span class="st">"Rice"</span>,       <span class="st">"Buena Vista"</span>,</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span>,     <span class="cn">NA</span>,            <span class="st">"Schmidt"</span>,    <span class="st">"Division"</span>,</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9</span>,     <span class="st">"Bob"</span>,         <span class="st">"Garza"</span>,      <span class="st">"Red Rock"</span>,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>,    <span class="st">"Stella"</span>,      <span class="cn">NA</span>,           <span class="st">"Holland"</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>people <span class="ot">&lt;-</span> people_1 <span class="sc">%&gt;%</span> </span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(people_2) <span class="sc">%&gt;%</span> </span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 8
    id_1 name_first_1 name_last_1 street_1      id_2 name_first_2 name_last_2
   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      
 1     1 Easton       &lt;NA&gt;        Alameda          1 Easton       Stone      
 2     2 Elias        Salazar     Crissy Field     2 Elas         Salazar    
 3     3 Colton       Fox         San Bruno        3 &lt;NA&gt;         Fox        
 4     4 Cameron      Warren      Nottingham       4 Cameron      Waren      
 5     5 Carson       Mills       Jersey           5 Carsen       Mills      
 6     6 Addison      Meyer       Tingley          6 Adison       &lt;NA&gt;       
 7     7 Aubrey       Rice        Buena Vista      7 Aubrey       Rice       
 8     8 Ellie        Schmidt     Division         8 &lt;NA&gt;         Schmidt    
 9     9 Robert       Garza       Red Rock         9 Bob          Garza      
10    10 Stella       Daniels     Holland         10 Stella       &lt;NA&gt;       
# â„¹ 1 more variable: street_2 &lt;chr&gt;</code></pre>
</div>
</div>
<p>Here is the function we wrote to help us create the dummy variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>is_match <span class="ot">&lt;-</span> <span class="cf">function</span>(value_1, value_2) {</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> value_1 <span class="sc">==</span> value_2</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(result), <span class="cn">FALSE</span>, result)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here is how we applied the function we wrote to get our results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>people <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_first_match =</span> <span class="fu">is_match</span>(name_first_1, name_first_2),</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_last_match  =</span> <span class="fu">is_match</span>(name_last_1, name_last_2),</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_match     =</span> <span class="fu">is_match</span>(street_1, street_2)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order like columns next to each other for easier comparison</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_1, <span class="fu">starts_with</span>(<span class="st">"name_f"</span>), <span class="fu">starts_with</span>(<span class="st">"name_l"</span>), <span class="fu">starts_with</span>(<span class="st">"s"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 10
    id_1 name_first_1 name_first_2 name_first_match name_last_1 name_last_2
   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;lgl&gt;            &lt;chr&gt;       &lt;chr&gt;      
 1     1 Easton       Easton       TRUE             &lt;NA&gt;        Stone      
 2     2 Elias        Elas         FALSE            Salazar     Salazar    
 3     3 Colton       &lt;NA&gt;         FALSE            Fox         Fox        
 4     4 Cameron      Cameron      TRUE             Warren      Waren      
 5     5 Carson       Carsen       FALSE            Mills       Mills      
 6     6 Addison      Adison       FALSE            Meyer       &lt;NA&gt;       
 7     7 Aubrey       Aubrey       TRUE             Rice        Rice       
 8     8 Ellie        &lt;NA&gt;         FALSE            Schmidt     Schmidt    
 9     9 Robert       Bob          FALSE            Garza       Garza      
10    10 Stella       Stella       TRUE             Daniels     &lt;NA&gt;       
# â„¹ 4 more variables: name_last_match &lt;lgl&gt;, street_1 &lt;chr&gt;, street_2 &lt;chr&gt;,
#   street_match &lt;lgl&gt;</code></pre>
</div>
</div>
<p>ðŸš©However, in the code chunk above, we still have essentially the same code copied more than twice. Thatâ€™s a red flag that we should be thinking about removing unnecessary repetition from our code. Because we are using dplyr, and all of our data resides inside of a single data frame, your first instinct might be to use <code>across()</code> inside of <code>mutate()</code> to perform column-wise operations. Unfortunately, that method wonâ€™t work in this scenario.</p>
<p>The <code>across()</code> function will apply the function we pass to the <code>.fns</code> argument to each column passed to the <code>.cols</code> argument, one at a time. But, we need to pass two columns at a time to the <code>is_match()</code> function. For example, <code>name_first_1</code> <em>and</em> <code>name_first_2</code>. That makes this task a little trickier than most. But, hereâ€™s how we accomplished it using a for loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name_first"</span>, <span class="st">"name_last"</span>, <span class="st">"street"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  col_1   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_1"</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  col_2   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_2"</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  new_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_match"</span>)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  people[[new_col]] <span class="ot">&lt;-</span> <span class="fu">is_match</span>(people[[col_1]], people[[col_2]])</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>people <span class="sc">%&gt;%</span> </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_1, <span class="fu">starts_with</span>(<span class="st">"name_f"</span>), <span class="fu">starts_with</span>(<span class="st">"name_l"</span>), <span class="fu">starts_with</span>(<span class="st">"s"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 10
    id_1 name_first_1 name_first_2 name_first_match name_last_1 name_last_2
   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;lgl&gt;            &lt;chr&gt;       &lt;chr&gt;      
 1     1 Easton       Easton       TRUE             &lt;NA&gt;        Stone      
 2     2 Elias        Elas         FALSE            Salazar     Salazar    
 3     3 Colton       &lt;NA&gt;         FALSE            Fox         Fox        
 4     4 Cameron      Cameron      TRUE             Warren      Waren      
 5     5 Carson       Carsen       FALSE            Mills       Mills      
 6     6 Addison      Adison       FALSE            Meyer       &lt;NA&gt;       
 7     7 Aubrey       Aubrey       TRUE             Rice        Rice       
 8     8 Ellie        &lt;NA&gt;         FALSE            Schmidt     Schmidt    
 9     9 Robert       Bob          FALSE            Garza       Garza      
10    10 Stella       Stella       TRUE             Daniels     &lt;NA&gt;       
# â„¹ 4 more variables: name_last_match &lt;lgl&gt;, street_1 &lt;chr&gt;, street_2 &lt;chr&gt;,
#   street_match &lt;lgl&gt;</code></pre>
</div>
</div>
<p>Now, letâ€™s go over one way to get the same result using <code>purrr</code>. The first method very closely resembles our for loop. In fact, we will basically just copy and paste our for loop body into an anonymous function being passed to the <code>.f</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfc</span>(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">c</span>(<span class="st">"name_first"</span>, <span class="st">"name_last"</span>, <span class="st">"street"</span>),</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="cf">function</span>(col, <span class="at">data =</span> people) {</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    col_1 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(col, <span class="st">"_1"</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    col_2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(col, <span class="st">"_2"</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    new_nm <span class="ot">&lt;-</span> <span class="fu">paste0</span>(col, <span class="st">"_match"</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    data[[new_nm]] <span class="ot">&lt;-</span> data[[col_1]] <span class="sc">==</span> data[[col_2]]</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    data[[new_nm]] <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(data[[new_nm]]), <span class="cn">FALSE</span>, data[[new_nm]])</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    data[<span class="fu">c</span>(col_1, col_2, new_nm)]</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 9
   name_first_1 name_first_2 name_first_match name_last_1 name_last_2
   &lt;chr&gt;        &lt;chr&gt;        &lt;lgl&gt;            &lt;chr&gt;       &lt;chr&gt;      
 1 Easton       Easton       TRUE             &lt;NA&gt;        Stone      
 2 Elias        Elas         FALSE            Salazar     Salazar    
 3 Colton       &lt;NA&gt;         FALSE            Fox         Fox        
 4 Cameron      Cameron      TRUE             Warren      Waren      
 5 Carson       Carsen       FALSE            Mills       Mills      
 6 Addison      Adison       FALSE            Meyer       &lt;NA&gt;       
 7 Aubrey       Aubrey       TRUE             Rice        Rice       
 8 Ellie        &lt;NA&gt;         FALSE            Schmidt     Schmidt    
 9 Robert       Bob          FALSE            Garza       Garza      
10 Stella       Stella       TRUE             Daniels     &lt;NA&gt;       
# â„¹ 4 more variables: name_last_match &lt;lgl&gt;, street_1 &lt;chr&gt;, street_2 &lt;chr&gt;,
#   street_match &lt;lgl&gt;</code></pre>
</div>
</div>
<p>In the code above, we used roughly the same amount of code to complete the task with a loop that we used to complete it without a loop. However, this code still has some advantages. We only typed â€œname_firstâ€, â€œname_lastâ€, and â€œstreetâ€ once at the beginning of the code chunk. Therefore, we didnâ€™t have to worry about forgetting to change a column name after copying and pasting code. Additionally, if we later decide that we also want to compare other columns (e.g., middle name, birth date, city, state, zip code), we only have to update the code in one place â€“ where we create the <code>cols</code> vector.</p>
</section>
</section>
<section id="using-purrr-for-analysis" class="level2" data-number="37.4">
<h2 data-number="37.4" class="anchored" data-anchor-id="using-purrr-for-analysis"><span class="header-section-number">37.4</span> Using purrr for analysis</h2>
<p>Letâ€™s return to the examples from the <a href="../dplyr_column_wise/dplyr_column_wise.html#across-with-summarise">column-wise operations chapter</a> and the <a href="../writing_for_loops/writing_for_loops.html#using-for-loops-for-analysis">chapter on writing for loops</a> for our discussion of using the <code>purrr</code> package to remove unnecessary repetition from our analyses. We will once again use the simulated for the examples below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>study <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">age       =</span> <span class="fu">c</span>(<span class="dv">32</span>, <span class="dv">30</span>, <span class="dv">32</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">38</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">48</span>, <span class="dv">29</span>, <span class="dv">22</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">28</span>, <span class="dv">24</span>, <span class="dv">25</span>, </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                <span class="dv">25</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">24</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">26</span>, <span class="dv">23</span>, </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">33</span>, <span class="dv">27</span>, <span class="dv">25</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">27</span>, <span class="dv">24</span>, <span class="dv">43</span>, <span class="dv">25</span>, <span class="dv">24</span>, </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>                <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">28</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">31</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">31</span>, <span class="dv">34</span>, </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                <span class="dv">26</span>, <span class="dv">25</span>, <span class="dv">27</span>, <span class="cn">NA</span>),</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>),</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, </span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, </span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="cn">NA</span>),</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ht_in     =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">63</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">67</span>, <span class="dv">58</span>, <span class="dv">64</span>, <span class="dv">69</span>, <span class="dv">65</span>, <span class="dv">68</span>, <span class="dv">63</span>, <span class="dv">68</span>, <span class="dv">69</span>, <span class="dv">66</span>, <span class="dv">67</span>, <span class="dv">65</span>, </span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>                <span class="dv">64</span>, <span class="dv">75</span>, <span class="dv">67</span>, <span class="dv">63</span>, <span class="dv">60</span>, <span class="dv">67</span>, <span class="dv">64</span>, <span class="dv">73</span>, <span class="dv">62</span>, <span class="dv">69</span>, <span class="dv">67</span>, <span class="dv">62</span>, <span class="dv">68</span>, <span class="dv">66</span>, <span class="dv">66</span>, <span class="dv">62</span>, </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>                <span class="dv">64</span>, <span class="dv">68</span>, <span class="cn">NA</span>, <span class="dv">68</span>, <span class="dv">70</span>, <span class="dv">68</span>, <span class="dv">68</span>, <span class="dv">66</span>, <span class="dv">71</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">64</span>, <span class="dv">64</span>, <span class="dv">63</span>, <span class="dv">67</span>, <span class="dv">66</span>, </span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>                <span class="dv">69</span>, <span class="dv">76</span>, <span class="cn">NA</span>, <span class="dv">63</span>, <span class="dv">64</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">71</span>, <span class="dv">66</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">71</span>, <span class="dv">64</span>, <span class="dv">71</span>, <span class="dv">60</span>, <span class="dv">62</span>, </span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>                <span class="dv">61</span>, <span class="dv">69</span>, <span class="dv">66</span>, <span class="cn">NA</span>),</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">wt_lbs    =</span> <span class="fu">c</span>(<span class="dv">216</span>, <span class="dv">106</span>, <span class="dv">145</span>, <span class="dv">195</span>, <span class="dv">143</span>, <span class="dv">125</span>, <span class="dv">138</span>, <span class="dv">140</span>, <span class="dv">158</span>, <span class="dv">167</span>, <span class="dv">145</span>, <span class="dv">297</span>, <span class="dv">146</span>, </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>                <span class="dv">125</span>, <span class="dv">111</span>, <span class="dv">125</span>, <span class="dv">130</span>, <span class="dv">182</span>, <span class="dv">170</span>, <span class="dv">121</span>, <span class="dv">98</span>, <span class="dv">150</span>, <span class="dv">132</span>, <span class="dv">250</span>, <span class="dv">137</span>, <span class="dv">124</span>, </span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>                <span class="dv">186</span>, <span class="dv">148</span>, <span class="dv">134</span>, <span class="dv">155</span>, <span class="dv">122</span>, <span class="dv">142</span>, <span class="dv">110</span>, <span class="dv">132</span>, <span class="dv">188</span>, <span class="dv">176</span>, <span class="dv">188</span>, <span class="dv">166</span>, <span class="dv">136</span>, </span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>                <span class="dv">147</span>, <span class="dv">178</span>, <span class="dv">125</span>, <span class="dv">102</span>, <span class="dv">140</span>, <span class="dv">139</span>, <span class="dv">60</span>, <span class="dv">147</span>, <span class="dv">147</span>, <span class="dv">141</span>, <span class="dv">232</span>, <span class="dv">186</span>, <span class="dv">212</span>, </span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>                <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">115</span>, <span class="dv">154</span>, <span class="dv">140</span>, <span class="dv">150</span>, <span class="dv">130</span>, <span class="cn">NA</span>, <span class="dv">171</span>, <span class="dv">156</span>, <span class="dv">92</span>, <span class="dv">122</span>, <span class="dv">102</span>, </span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>                <span class="dv">163</span>, <span class="dv">141</span>, <span class="cn">NA</span>),</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">bmi       =</span> <span class="fu">c</span>(<span class="fl">30.99</span>, <span class="fl">18.78</span>, <span class="fl">26.52</span>, <span class="fl">30.54</span>, <span class="fl">22.39</span>, <span class="fl">26.12</span>, <span class="fl">23.69</span>, <span class="fl">20.67</span>, <span class="fl">26.29</span>, </span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>                <span class="fl">25.39</span>, <span class="fl">25.68</span>, <span class="fl">45.15</span>, <span class="fl">21.56</span>, <span class="fl">20.17</span>, <span class="fl">17.38</span>, <span class="fl">20.8</span>, <span class="fl">22.31</span>, <span class="fl">22.75</span>, </span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>                <span class="fl">26.62</span>, <span class="fl">21.43</span>, <span class="fl">19.14</span>, <span class="fl">23.49</span>, <span class="fl">22.66</span>, <span class="fl">32.98</span>, <span class="fl">25.05</span>, <span class="fl">18.31</span>, <span class="fl">29.13</span>, </span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>                <span class="fl">27.07</span>, <span class="fl">20.37</span>, <span class="fl">25.01</span>, <span class="fl">19.69</span>, <span class="fl">25.97</span>, <span class="fl">18.88</span>, <span class="fl">20.07</span>, <span class="cn">NA</span>, <span class="fl">26.76</span>, </span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>                <span class="fl">26.97</span>, <span class="fl">25.24</span>, <span class="fl">20.68</span>, <span class="fl">23.72</span>, <span class="fl">24.82</span>, <span class="fl">23.62</span>, <span class="fl">18.65</span>, <span class="fl">24.03</span>, <span class="fl">23.86</span>, </span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>                <span class="fl">10.63</span>, <span class="fl">23.02</span>, <span class="fl">23.72</span>, <span class="fl">20.82</span>, <span class="fl">28.24</span>, <span class="cn">NA</span>, <span class="fl">37.55</span>, <span class="fl">18.88</span>, <span class="fl">18.3</span>, </span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>                <span class="fl">19.13</span>, <span class="fl">21.48</span>, <span class="fl">22.59</span>, <span class="fl">24.96</span>, <span class="fl">21.63</span>, <span class="cn">NA</span>, <span class="fl">29.35</span>, <span class="fl">21.76</span>, <span class="fl">17.97</span>, </span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>                <span class="fl">22.31</span>, <span class="fl">19.27</span>, <span class="fl">24.07</span>, <span class="fl">22.76</span>, <span class="cn">NA</span>),</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">bmi_3cat  =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">1</span>, </span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">factor</span>(age_group, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Younger than 30"</span>, <span class="st">"30 and Older"</span>)),</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender    =</span> <span class="fu">factor</span>(gender, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>)),</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">bmi_3cat  =</span> <span class="fu">factor</span>(bmi_3cat, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"Overweight"</span>, <span class="st">"Obese"</span>))</span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 68 Ã— 7
     age age_group       gender ht_in wt_lbs   bmi bmi_3cat  
   &lt;dbl&gt; &lt;fct&gt;           &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     
 1    32 30 and Older    Male      70    216  31.0 Obese     
 2    30 30 and Older    Female    63    106  18.8 Normal    
 3    32 30 and Older    Female    62    145  26.5 Overweight
 4    29 Younger than 30 Male      67    195  30.5 Obese     
 5    24 Younger than 30 Female    67    143  22.4 Normal    
 6    38 30 and Older    Female    58    125  26.1 Overweight
 7    25 Younger than 30 Female    64    138  23.7 Normal    
 8    24 Younger than 30 Male      69    140  20.7 Normal    
 9    48 30 and Older    Male      65    158  26.3 Overweight
10    29 Younger than 30 Male      68    167  25.4 Overweight
# â„¹ 58 more rows</code></pre>
</div>
</div>
<section id="example-1-continuous-statistics" class="level3" data-number="37.4.1">
<h3 data-number="37.4.1" class="anchored" data-anchor-id="example-1-continuous-statistics"><span class="header-section-number">37.4.1</span> Example 1: Continuous statistics</h3>
<p>In this first example, we will use <code>purrr</code> to calculate a set of statistics for multiple continuous variables in our data frame. We will start by creating the same function we created at the beginning of the <a href="#writing-functions">chapter on writing functions</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>continuous_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(var) {</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  study <span class="sc">%&gt;%</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_miss =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>({{ var }})),</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean   =</span> <span class="fu">mean</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">median =</span> <span class="fu">median</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">min    =</span> <span class="fu">min</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">max    =</span> <span class="fu">max</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, letâ€™s once again <em>use</em> the function we just created above to calculate the descriptive measures we are interested in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">continuous_stats</span>(age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 5
  n_miss  mean median   min   max
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      1  26.9     26    22    48</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">continuous_stats</span>(ht_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 5
  n_miss  mean median   min   max
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      3  66.0     66    58    76</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">continuous_stats</span>(wt_lbs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 5
  n_miss  mean median   min   max
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      2  148.   142.    60   297</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">continuous_stats</span>(bmi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 5
  n_miss  mean median   min   max
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      4  23.6   22.9  10.6  45.2</code></pre>
</div>
</div>
<p>ðŸš©Once again, you notice that we have essentially the same code copied more than twice. Thatâ€™s a red flag that we should be thinking about removing unnecessary repetition. Weâ€™ve already seen how to accomplish this goal using the <code>across()</code> function. Now, letâ€™s learn how to accomplish this goal using the <code>purrr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">quos</span>(age, ht_in, wt_lbs, bmi),</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> continuous_stats</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 5
  n_miss  mean median   min   max
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      1  26.9   26    22    48  
2      3  66.0   66    58    76  
3      2 148.   142.   60   297  
4      4  23.6   22.9  10.6  45.2</code></pre>
</div>
</div>
<p>ðŸ‘†<strong>Hereâ€™s what we did above:</strong></p>
<ul>
<li><p>We used the <code>map_dfr()</code> function from the <code>purrr</code> package to iteratively pass the columns <code>age</code>, <code>ht_in</code>, <code>wt_lbs</code>, and <code>bmi</code> to our <code>continuous_stats</code> function <em>and</em> row-bind the results into a single results data frame.</p></li>
<li><p>We havenâ€™t seen the <code>quos()</code> function before. Itâ€™s another one of those tidy evaluation functions. You can type <code>?rlang::quos</code> in your console to read more about it. When we can wrap a single column name with the <code>quo()</code> function, or a list of column names with the <code>quos()</code> function, we are telling R to look for them in the data frame being passed to a <code>dplyr</code> verb rather than looking for them as objects in the global environment.</p></li>
</ul>
<p>At this point, you may be wondering which row in the results data frame above corresponds to which variable? Great question! When we were using <code>continuous_stats()</code> to analyze one variable at a time, it didnâ€™t really matter that the variable name wasnâ€™t part of the output. However, now that we are apply <code>continuous_stats()</code> to multiple columns, it would really be nice to have the column name in the results. Luckily, we can easily make that happen with one small tweak to our <code>continuous_stats()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>continuous_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(var) {</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  study <span class="sc">%&gt;%</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> <span class="fu">quo_name</span>(var), <span class="co"># Add variable name to the output</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_miss   =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>({{ var }})),</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean     =</span> <span class="fu">mean</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">median   =</span> <span class="fu">median</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">min      =</span> <span class="fu">min</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">max      =</span> <span class="fu">max</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ðŸ‘†<strong>Hereâ€™s what we did above:</strong></p>
<ul>
<li>We used the <code>quo_name()</code> function to grab the name of the column being passed to the <code>summarise()</code> function and turn it into a character string. Then, we assigned that character string to column in the results data frame called <code>variable</code>. So, when the <code>age</code> column is passed to <code>summarise()</code> inside of the function body, <code>quo_name(var)</code> returns the value <code>"age"</code> and then that value is assigned to the <code>variable</code> column in the expression <code>variable = quo_name(var)</code>.</li>
</ul>
<p>Letâ€™s try out our new and improved <code>continuous_stats()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">quos</span>(age, ht_in, wt_lbs, bmi),</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> continuous_stats</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 6
  variable n_miss  mean median   min   max
  &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 age           1  26.9   26    22    48  
2 ht_in         3  66.0   66    58    76  
3 wt_lbs        2 148.   142.   60   297  
4 bmi           4  23.6   22.9  10.6  45.2</code></pre>
</div>
</div>
<p>That works great, but weâ€™d probably like to be able to use <code>continuous_stats()</code> with other data frames too. Currently, we canâ€™t do that because we have the <code>study</code> data frame hard-coded into our function. Luckily, weâ€™ve already seen how to replace a hard-coded data frame by adding a <code>data</code> argument to our function like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>continuous_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var) {</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span>  <span class="co"># Don't forget to replace "study" with "data" here too!</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> <span class="fu">quo_name</span>(var),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_miss   =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>({{ var}} )),</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean     =</span> <span class="fu">mean</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">median   =</span> <span class="fu">median</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">min      =</span> <span class="fu">min</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">max      =</span> <span class="fu">max</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now, we can analyze all the continuous variables in the <code>study</code> data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">quos</span>(age, ht_in, wt_lbs, bmi),</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> continuous_stats, <span class="at">data =</span> study</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 6
  variable n_miss  mean median   min   max
  &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 age           1  26.9   26    22    48  
2 ht_in         3  66.0   66    58    76  
3 wt_lbs        2 148.   142.   60   297  
4 bmi           4  23.6   22.9  10.6  45.2</code></pre>
</div>
</div>
<p>And all the continuous variables in the <code>df_xyz</code> data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">quos</span>(x, y, z),</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> continuous_stats, <span class="at">data =</span> df_xyz</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 6
  variable n_miss   mean  median   min   max
  &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 x             1  0.108  0.0705 -1.27  1.72
2 y             1  0.220  0.401  -1.97  1.79
3 z             1 -0.284 -0.625  -1.14  1.25</code></pre>
</div>
</div>
</section>
<section id="example-2-categorical-statistics" class="level3" data-number="37.4.2">
<h3 data-number="37.4.2" class="anchored" data-anchor-id="example-2-categorical-statistics"><span class="header-section-number">37.4.2</span> Example 2: Categorical statistics</h3>
<p>For our second example of using the <code>purrr</code> package for analysis, weâ€™ll once again write some code to iteratively analyze all the categorical variables in our <code>study</code> data frame. In the last chapter, we learned how to use a for loop to do this analysis. As a refresher, here is the final solution we arrived at:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Structure 1. An object to contain the results.</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the data frame structure that will contain our results</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>cat_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">category =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n        =</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Structure 2. The actual for loop.</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For each column, get the column name, category names, and count.</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then, add them to the bottom of the results data frame we created above.</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>)) {</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>  cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(.data[[i]]) <span class="sc">%&gt;%</span> <span class="co"># Use .data to refer to the current data frame.</span></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="co"># Use . to refer to the current data frame.</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here is where we update cat_table with the results for each column</span></span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>  cat_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cat_table, cat_stats)</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>cat_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
   variable  category            n
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
 1 age_group Younger than 30    56
 2 age_group 30 and Older       11
 3 age_group &lt;NA&gt;                1
 4 gender    Female             43
 5 gender    Male               24
 6 gender    &lt;NA&gt;                1
 7 bmi_3cat  Normal             43
 8 bmi_3cat  Overweight         16
 9 bmi_3cat  Obese               5
10 bmi_3cat  &lt;NA&gt;                4</code></pre>
</div>
</div>
<p>To use <code>purrr</code> instead, we can pretty much copy and paste the code from the for loop body above as an anonymous function to the <code>.f</code> argument to <code>map_dfr()</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">c</span>(<span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>),</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="cf">function</span>(x) {</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    study <span class="sc">%&gt;%</span> </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(.data[[x]]) <span class="sc">%&gt;%</span> </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(variable, category, n)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
   variable  category            n
   &lt;chr&gt;     &lt;fct&gt;           &lt;int&gt;
 1 age_group Younger than 30    56
 2 age_group 30 and Older       11
 3 age_group &lt;NA&gt;                1
 4 gender    Female             43
 5 gender    Male               24
 6 gender    &lt;NA&gt;                1
 7 bmi_3cat  Normal             43
 8 bmi_3cat  Overweight         16
 9 bmi_3cat  Obese               5
10 bmi_3cat  &lt;NA&gt;                4</code></pre>
</div>
</div>
<p>As you can see, the code that is <em>doing the analysis</em> is exactly the same in our for loop solution and our <code>purrr</code> solution. However, in this case, the <code>purrr</code> solution requires a lot less code <em>around</em> the analysis code. And, for some, the <code>purrr</code> code is easier to read.</p>
<p>If we didnâ€™t want to type our column names in quotes, we could use tidy evaluation again. All we have to do is pass the column names to the <code>quos()</code> function in the <code>.x</code> argument and change the <code>.data[[x]]</code> being passed to the <code>count()</code> function to <code>{ x }</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">quos</span>(age_group, gender, bmi_3cat), <span class="co"># Change c() to quos()</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="cf">function</span>(x) {</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    study <span class="sc">%&gt;%</span> </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>({{ x }}) <span class="sc">%&gt;%</span> <span class="co"># Change .data[[x]] to {{ x }}</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(variable, category, n)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
   variable  category            n
   &lt;chr&gt;     &lt;fct&gt;           &lt;int&gt;
 1 age_group Younger than 30    56
 2 age_group 30 and Older       11
 3 age_group &lt;NA&gt;                1
 4 gender    Female             43
 5 gender    Male               24
 6 gender    &lt;NA&gt;                1
 7 bmi_3cat  Normal             43
 8 bmi_3cat  Overweight         16
 9 bmi_3cat  Obese               5
10 bmi_3cat  &lt;NA&gt;                4</code></pre>
</div>
</div>
<p>And as before, weâ€™d probably like to be able to use this code with other data frames too. So, we will once again replace a hard-coded data frame by adding a <code>data</code> argument to our function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">quos</span>(age_group, gender, bmi_3cat),</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="cf">function</span>(x, <span class="at">data =</span> study) {</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    data <span class="sc">%&gt;%</span> <span class="co"># Don't forget to replace "study" with "data" here too!</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>({{ x }}) <span class="sc">%&gt;%</span> </span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(variable, category, n)</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
   variable  category            n
   &lt;chr&gt;     &lt;fct&gt;           &lt;int&gt;
 1 age_group Younger than 30    56
 2 age_group 30 and Older       11
 3 age_group &lt;NA&gt;                1
 4 gender    Female             43
 5 gender    Male               24
 6 gender    &lt;NA&gt;                1
 7 bmi_3cat  Normal             43
 8 bmi_3cat  Overweight         16
 9 bmi_3cat  Obese               5
10 bmi_3cat  &lt;NA&gt;                4</code></pre>
</div>
</div>
<p>And that concludes the chapter! You might feel a little bit like your head is swimming at this point. It was a lot to take in! As was stated at the end of the for loop chapter, it is not recommended to memorize everything we covered in this chapter. Instead, we recommend that you read it until you sort of get the general idea of the <code>purrr</code> package and when it might be useful. Then, refer back to this chapter, or other online references that discuss the <code>purrr</code> package (there are many good ones out there), if you find yourself in a situation where you believe that the <code>purrr</code> package might be the right tool to help you complete a given programming task.</p>
<p>If you feel as though you want to take a deeper dive into the <code>purrr</code> package right away, then we suggest checking out the <a href="https://r4ds.had.co.nz/iteration.html#for-loops-vs.functionals">iteration chapter of R for Data Science</a>. For an even deeper dive, the <a href="https://adv-r.hadley.nz/functionals.html">functionals chapter of Advanced R</a> is recommended.</p>
<p>This concludes the repeated operations part of the book. If you arenâ€™t feeling totally comfortable with the material we covered in this part of the book right now, thatâ€™s ok. Youâ€™re not expected to yet. It takes <em>time</em> and <em>practice</em> for most people to be able to wrap their head around repeated operations. You are on track at this point as long as you understand why unnecessary repetition in your code is generally something you want to avoid. Then, slowly start using any of the methods <em>you feel most comfortable with</em> to remove the unnecessary repetition from your code. Start by doing so in very simple cases and gradually work your way up to more complicated cases. With some practice, you may eventually think this stuff is even fun!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/brad-cannell\.github\.io\/r4epi_quarto\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/writing_for_loops/writing_for_loops.html" class="pagination-link" aria-label="Writing For Loops">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Writing For Loops</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/intro_git_github/intro_git_github.html" class="pagination-link" aria-label="Introduction to git and GitHub">
        <span class="nav-page-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Introduction to git and GitHub</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>R for Epidemiology</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/brad-cannell/r4epi_quarto/edit/main/chapters/using_purrr/using_purrr.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brad-cannell/r4epi_quarto/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://Quarto/.org/">Quarto/</a>.</p>
</div>
  </div>
</footer>




</body></html>