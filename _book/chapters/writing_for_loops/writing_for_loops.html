<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>36&nbsp; Writing For Loops – R 4 Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/using_purrr/using_purrr.html" rel="next">
<link href="../../chapters/dplyr_column_wise/dplyr_column_wise.html" rel="prev">
<link href="../../r4epi_favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-0RREBTQ0D9"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-0RREBTQ0D9', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/intro_repeated_operations/intro_repeated_operations.html">Repeated Operations</a></li><li class="breadcrumb-item"><a href="../../chapters/writing_for_loops/writing_for_loops.html"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Writing For Loops</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">R 4 Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/brad-cannell/r4epi" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../R-4-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/contributing/contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/about_the_authors/about_the_authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the Authors</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/installing_r_and_rstudio/installing_r_and_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Installing R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/what_is_r/what_is_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">What is R?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/navigating_rstudio/navigating_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Navigating the RStudio Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/speaking_r/speaking_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Speaking R’s Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/lets_get_programming/lets_get_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Let’s Get Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/asking_questions/asking_questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Asking Questions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Coding Tools and Best Practices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/r_scripts/r_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Scripts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/quarto_files/quarto_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quarto Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/r_projects/projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R Projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/best_practices/best_practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Coding Best Practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_pipes/using_pipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Using Pipes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Transfer</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/data_transfer/data_transfer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Data Transfer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/file_paths/file_paths.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">File Paths</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/importing_plain_text/importing_plain_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Importing Plain Text Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/importing_binary_files/importing_binary_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Importing Binary Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/rstudio_import_tool/rstudio_import_tool.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">RStudio’s Data Import Tool</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/exporting_data_to_disk/exporting_data_to_disk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Exporting Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Descriptive Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_descriptive_analysis/intro_descriptive_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Descriptive Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/categorical_variables/categorical_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Numerical Descriptions of Categorical Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/central_tendency/central_tendency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Measures of Central Tendency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dispersion/dispersion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Measures of Dispersion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cont_out_cont_pred/cont_out_cont_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Continuous Outcome and a Continuous Predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cont_out_cat_pred/cont_out_cat_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Continuous Outcome and a Categorical Predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/cat_out_cat_pred/cat_out_cat_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Describing the Relationship Between a Categorical Outcome and a Categorical Predictor</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_data_management/intro_data_management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Introduction to Data Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/creating_and_modifying_columns/creating_and_modifying_columns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Creating and Modifying Columns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/subsetting_data_frames/subsetting_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Subsetting Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/working_with_dates/working_with_dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/working_with_character_strings/working_with_character_strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Working with Character Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/conditional_operations/conditional_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Conditional Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/multiple_data_frames/multiple_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Working with Multiple Data Frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/restructuring_data_frames/restructuring_data_frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Restructuring Data frames</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Repeated Operations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_repeated_operations/intro_repeated_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Introduction to Repeated Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/writing_functions/writing_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dplyr_column_wise/dplyr_column_wise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Column-wise Operations in dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/writing_for_loops/writing_for_loops.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Writing For Loops</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_purrr/using_purrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Using the purrr Package</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Collaboration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro_git_github/intro_git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Introduction to git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/using_git_github/using_git_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Using git and GitHub</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Presenting Results</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/creating_word_tables/creating_word_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Creating Tables with R and Microsoft Word</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#how-to-write-for-loops" id="toc-how-to-write-for-loops" class="nav-link active" data-scroll-target="#how-to-write-for-loops"><span class="header-section-number">36.1</span> How to write for loops</a>
  <ul class="collapse">
  <li><a href="#the-for-loop-body" id="toc-the-for-loop-body" class="nav-link" data-scroll-target="#the-for-loop-body"><span class="header-section-number">36.1.1</span> The for loop body</a></li>
  <li><a href="#the-for-function" id="toc-the-for-function" class="nav-link" data-scroll-target="#the-for-function"><span class="header-section-number">36.1.2</span> The for() function</a></li>
  </ul></li>
  <li><a href="#using-for-loops-for-data-transfer" id="toc-using-for-loops-for-data-transfer" class="nav-link" data-scroll-target="#using-for-loops-for-data-transfer"><span class="header-section-number">36.2</span> Using for loops for data transfer</a></li>
  <li><a href="#using-for-loops-for-data-management" id="toc-using-for-loops-for-data-management" class="nav-link" data-scroll-target="#using-for-loops-for-data-management"><span class="header-section-number">36.3</span> Using for loops for data management</a></li>
  <li><a href="#using-for-loops-for-analysis" id="toc-using-for-loops-for-analysis" class="nav-link" data-scroll-target="#using-for-loops-for-analysis"><span class="header-section-number">36.4</span> Using for loops for analysis</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/brad-cannell/r4epi/edit/main/chapters/writing_for_loops/writing_for_loops.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brad-cannell/r4epi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/intro_repeated_operations/intro_repeated_operations.html">Repeated Operations</a></li><li class="breadcrumb-item"><a href="../../chapters/writing_for_loops/writing_for_loops.html"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Writing For Loops</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Writing For Loops</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!--
Hidden comments placeholder
---------------------------

To preview:
bookdown::preview_chapter("chapters/07_part_repeated_operations/04_writing_for_loops.Rmd")

Copy and paste:
👆**Here's what we did above:**
-->
<p>In this third chapter on repeated operations, we are going to discuss writing <a href="../../chapters/appendices/glossary.html#glossary-for-loops">for loops</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="four_methods.png" class="img-fluid figure-img" width="900"></p>
<figcaption>For loops graphic</figcaption>
</figure>
</div>
</div>
</div>
<p>In other documents you read, you may see for loops referred to as iterative processing, iterative operations, iteration, or just loops. Regardless of what you call them, for loops are not unique to R. Many if not all statistical software applications allow users to write for loops; although, the exact words and symbols used to construct them may differ slightly from one program to another.</p>
<p>Let’s take a look at an example. After seeing a working example, we will take the code apart iteratively (do you see what we did there? 😆) to figure out how it works.</p>
<p>We’ll start by simulating some data. This is the same data we simulated at the beginning of the chapter on column-wise operations in <code>dplyr</code>. It’s a data frame that contains three columns of 10 random numbers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df_xyz <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
         x      y      z
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560   1.22  -1.07 
 2 -0.230   0.360 -0.218
 3  1.56    0.401 -1.03 
 4  0.0705  0.111 -0.729
 5  0.129  -0.556 -0.625
 6  1.72    1.79  -1.69 
 7  0.461   0.498  0.838
 8 -1.27   -1.97   0.153
 9 -0.687   0.701 -1.14 
10 -0.446  -0.473  1.25 </code></pre>
</div>
</div>
<p>As we previously discussed, if we wanted to find the mean of each column before learning about repeated operations, we would probably have written code like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_xyz <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x_mean =</span> <span class="fu">mean</span>(x),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_mean =</span> <span class="fu">mean</span>(y),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_mean =</span> <span class="fu">mean</span>(y)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  x_mean y_mean z_mean
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 0.0746  0.209  0.209</code></pre>
</div>
</div>
<p>In the previous chapter, we learned how to use the <code>across()</code> function to remove unnecessary repetition from our code like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_xyz <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">.cols  =</span> <span class="fu">everything</span>(),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">.fns   =</span> mean,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">"{col}_mean"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  x_mean y_mean z_mean
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 0.0746  0.209 -0.425</code></pre>
</div>
</div>
<p>An alternative approach that would also work is to use a for loop like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"double"</span>, <span class="fu">ncol</span>(df_xyz))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(df_xyz)) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  xyz_means[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[i]])</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.07462564  0.20862196 -0.42455887</code></pre>
</div>
</div>
<p>Most people would agree that the for loop code is a little more complicated looking, and it’s a little bit harder to quickly glance at it and figure out what’s going on. It may even be a little bit intimidating for some of you.</p>
<p>Also, note that the result from the code that uses the <code>across()</code> function is a data frame with three columns and one row. The result from the code that uses a for loop is a character vector with three elements.</p>
<p>For the particular case above, we prefer to use the <code>across()</code> function instead of a for loop. However, as we will see below, there are some challenges that can be overcome with for loops that cannot currently be overcome with the <code>across()</code> function. But, before we jump into more examples, let’s take a look at the basic structure of the for loop.</p>
<section id="how-to-write-for-loops" class="level2" data-number="36.1">
<h2 data-number="36.1" class="anchored" data-anchor-id="how-to-write-for-loops"><span class="header-section-number">36.1</span> How to write for loops</h2>
<p>For starters, <em>using</em> for loops in practice will generally require us to write code for two separate structures: An object to contain the results of our for loop and the for loop itself.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="two_structures.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Two structures required for a for loop</figcaption>
</figure>
</div>
</div>
</div>
<p>In practice, we will generally write the code for structure 1 before writing the code for structure 2. However, it will be easier to understand why we need structure 1 if we first learn about the components of the for loop, and how they work together. Further, it will likely be easiest to understand the components of the for loop if we start on the inside and work our way out. Therefore, the first component of for loops that we are going to discuss is the body.</p>
<section id="the-for-loop-body" class="level3" data-number="36.1.1">
<h3 data-number="36.1.1" class="anchored" data-anchor-id="the-for-loop-body"><span class="header-section-number">36.1.1</span> The for loop body</h3>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="body.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Body of the for loop</figcaption>
</figure>
</div>
</div>
</div>
<p>Similar to when we learned to write our own functions, the body of the for loop is where all the “stuff” happens. This is where we write the code that we want to be executed over and over. In our example, we want the mean value of the <code>x</code> column, the mean value of the <code>y</code> column, and the mean value of the <code>z</code> column of our data frame called <code>df_xyz</code>. We can do that manually like this using dollar sign notation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07462564</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.208622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz<span class="sc">$</span>z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4245589</code></pre>
</div>
</div>
<p>Or, we’ve also learned how to get the same result using bracket notation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="st">"x"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07462564</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="st">"y"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.208622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="st">"z"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4245589</code></pre>
</div>
</div>
<p>In the code above, we used the quoted column <em>names</em> inside the double brackets. However, we could have also used each column’s <em>position</em> inside the double brackets. In other words, we can use <code>1</code> to refer to the <code>x</code> column because it is the first column in the data frame, we can use <code>2</code> to refer to the <code>y</code> column because it is the second column in the data frame, and we can use <code>3</code> to refer to the <code>z</code> column because it is the third column in the data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07462564</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.208622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="dv">3</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4245589</code></pre>
</div>
</div>
<p>For reasons that will become clearer later, this will actually be the syntax we want to use inside of our for loop.</p>
<p>Notice, however, the we copied the same code more than twice above. For all of the reasons we’ve already discussed, we would like to just type <code>mean(df_xyz[[ # ]]</code> once and have R fill in the number inside the double brackets for us, one after the other. As you’ve probably guessed, that’s exactly what the for loop does.</p>
</section>
<section id="the-for-function" class="level3" data-number="36.1.2">
<h3 data-number="36.1.2" class="anchored" data-anchor-id="the-for-function"><span class="header-section-number">36.1.2</span> The for() function</h3>
<p>All for loops start with the <code>for()</code> function. This is how you tell R that you are about to write a for loop.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="for.png" class="img-fluid figure-img" width="900"></p>
<figcaption>The for() function</figcaption>
</figure>
</div>
</div>
</div>
<p>In the examples in this book, the arguments to the <code>for()</code> function are generally going to follow this pattern:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="for2.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Pattern of the for() function arguments</figcaption>
</figure>
</div>
</div>
</div>
<p>1️⃣An index variable, which is also sometimes called a “counter,” to the left of the keyword <code>in</code>.</p>
<p>2️⃣The keyword <code>in</code>.</p>
<p>3️⃣The name of the object we want to loop (or iterate) over — often passed to the<code>seq_along()</code> function.</p>
<p>It can be a little intimidating to look at, but that’s the basic structure. We will talk about all three arguments simultaneously because they all work together, and we will get an error if we are missing any one of them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No index variable</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(<span class="cf">in</span> <span class="dv">1</span>) {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in parse(text = input): &lt;text&gt;:2:5: unexpected 'in'
1: # No index variable
2: for(in
       ^</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No keyword "in"</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="dv">1</span>) {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in parse(text = input): &lt;text&gt;:2:7: unexpected numeric constant
1: # No keyword "in"
2: for(i 1
         ^</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No object to loop over</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> ) {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in parse(text = input): &lt;text&gt;:2:10: unexpected ')'
1: # No object to loop over
2: for(i in )
            ^</code></pre>
</div>
</div>
<p>So, what happens when we do have all three of these components? Well, the index variable will take on each value of the object to loop over <em>iteratively</em> (i.e., one at a time). If there is only one object to loop over, this is how R sees the index variable inside of the loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>) {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>If there are multiple objects to loop over, this is how R sees the index variable inside of the loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2
[1] 3</code></pre>
</div>
</div>
<p>Notice that the values being printed out are <em>not</em> a single numeric vector with three elements (e.g.&nbsp;<code>[1] 1, 2, 3</code>) like the object we started with to the right of the keyword <code>in</code>. Instead, three vectors with one element each are being printed out. One for 1 (i.e., <code>[1] 1</code>), one for 2 (i.e., <code>[1] 2</code>), and one for 3 (i.e., <code>[1] 3</code>). This is pointed out because it illustrates the <em>iterative</em> nature of a for loop. The index variable doesn’t take on the values of the object to the right of the keyword <code>in</code> <em>simultaneously</em>. It takes them on <em>iteratively</em>, or separately, one after the other.</p>
<p>Further, it may not be immediately obvious at this point, but that’s the basic “magic” of the for loop. <em>The index variable changes once for each element of whatever object is on the right side of the keyword <code>in</code></em>. Even the most complicated for loops generally start from this basic idea.</p>
<p>Note that the index variable does not have to be the letter <code>i</code>. It can be any letter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2
[1] 3</code></pre>
</div>
</div>
<p>Or even a word:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(number <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(number)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2
[1] 3</code></pre>
</div>
</div>
<p>However, <code>i</code> is definitely the most common letter to use as the index variable and we suggest that you also use it in most cases. It’s just what people will expect to see and easily understand.</p>
<p>Now, let’s discuss the object to the right of the keyword <code>in</code>. In all of the examples above, we passed a vector to the right of the keyword <code>in</code>. As you saw, when there is a vector to the right of the keyword <code>in</code>, the index variable takes on the value of each element of the vector. However, the object to the right of the keyword <code>in</code> does not have to be a vector. In fact, it will often be a data frame.</p>
<p>When we ask the for loop to iterate over a data frame, what value do you think the index variable will take? The value of each cell of the data frame? The name or number of each column? The name or number of each row? Let’s see:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> df_xyz) {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.56047565 -0.23017749  1.55870831  0.07050839  0.12928774  1.71506499
 [7]  0.46091621 -1.26506123 -0.68685285 -0.44566197
 [1]  1.2240818  0.3598138  0.4007715  0.1106827 -0.5558411  1.7869131
 [7]  0.4978505 -1.9666172  0.7013559 -0.4727914
 [1] -1.0678237 -0.2179749 -1.0260044 -0.7288912 -0.6250393 -1.6866933
 [7]  0.8377870  0.1533731 -1.1381369  1.2538149</code></pre>
</div>
</div>
<p>It may not be totally obvious to you, but inside the for loop above, the index variable took on three separate <em>vectors</em> of values – one for each column in the data frame. Of course, getting the mean value of each of these <em>vectors</em> is equivalent to getting the mean value of each <em>column</em> in our data frame. Remember, data frame columns <em>are</em> vectors. So, let’s replace the <code>print()</code> function with the <code>mean()</code> function in the for loop body and see what happens:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> df_xyz) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(i)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hmmm, it doesn’t seem as though anything happened. This is probably a good time to mention a little peculiarity about using for loops. As you can see in the example above, the return value of functions, and the contents of objects, referenced inside of the for loop body will not be printed to the screen unless we explicitly pass them to the <code>print()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> df_xyz) {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">mean</span>(i))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07462564
[1] 0.208622
[1] -0.4245589</code></pre>
</div>
</div>
<p>It worked! This is the exact same answer we got above. And, if all we want to do is print the mean values of <code>x</code>, <code>y</code>, and <code>z</code> to the screen, then we could stop here and call it a day. However, we often want to save our analysis results to an object. In the chapter on using column-wise operations with <code>dplyr</code>, we saved our summary statistics to an object in the usual way (i.e., with the assignment arrow):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> df_xyz <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">.cols  =</span> <span class="fu">everything</span>(),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">.fns   =</span> mean,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">"{col}_mean"</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From there, we can manipulate the results, save the results to a file, or print them to screen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  x_mean y_mean z_mean
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 0.0746  0.209 -0.425</code></pre>
</div>
</div>
<p>At first, it may seem as though we can assign the results of our for loop to an object in a similar way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="cf">for</span>(i <span class="cf">in</span> df_xyz) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(i)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>Unfortunately, this doesn’t work. Instead, we need to create an object that can store the results of our for loop. Then, we <em>update</em> (i.e., add to) that object at each iteration of the for loop. That brings us back to structure number 1.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="two_structures.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Two structures required for a for loop</figcaption>
</figure>
</div>
</div>
</div>
<p>Because the result of our for loop will be three numbers – the mean of <code>x</code>, the mean of <code>y</code>, and the mean of <code>z</code> – the most straightforward object to store them in is a numeric vector with a length of three (i.e., three “slots”). We can use the <code>vector()</code> function to create an empty vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>my_vec <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>my_vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>logical(0)</code></pre>
</div>
</div>
<p>As you can see, by default, the <code>vector()</code> function creates a logical vector with length zero. We can change the vector type to numeric by passing <code>"numeric"</code> to the <code>mode</code> argument of the <code>vector()</code> function. We can also change the length to 3 by passing <code>3</code> to the length argument of the <code>vector()</code> function, and because we know we want this vector to hold the mean values of <code>x</code>, <code>y</code>, and <code>z</code>, let’s name it <code>xyz_means</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="dv">3</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0</code></pre>
</div>
</div>
<p>Finally, let’s update <code>xyz_means</code> inside our for loop body:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> df_xyz) {</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  xyz_means <span class="ot">&lt;-</span> <span class="fu">mean</span>(i)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4245589</code></pre>
</div>
</div>
<p>Hmmm, we’re getting closer, but that obviously still isn’t the result we want. Below, we attempt to illustrate what’s going on inside our loop.</p>
<p>R starts executing at the top of the for loop. In the first iteration, the value of i is set to a numeric vector with the same values as the <code>x</code> column in <code>df_xyz</code>. Then, the <code>i</code> in <code>mean(i)</code> inside the for loop body is replaced with those numeric values. Then, the mean of those numeric values is calculated and assigned to the object named <code>xyz_means</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_1.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process - I</figcaption>
</figure>
</div>
</div>
</div>
<p>At this point, there is no more code left to execute inside of the for loop, so R returns to the top of the loop.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_2.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process - II</figcaption>
</figure>
</div>
</div>
</div>
<p><code>i</code> has not yet taken every value of the object to the right of the keyword <code>in</code>, so R starts another iteration of the for loop. In the second iteration, the value of <code>i</code> is set to a numeric vector with the same values as the <code>y</code> column in <code>df_xyz</code>. Then, the <code>i</code> in <code>mean(i)</code> inside the for loop body is replaced with those numeric values. Then, the mean of those numeric values is calculated and assigned to the object named <code>xyz_means</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_3.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process - III</figcaption>
</figure>
</div>
</div>
</div>
<p>At this point, there is no more code left to execute inside of the for loop, so R returns to the top of the loop.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_4.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process - IV</figcaption>
</figure>
</div>
</div>
</div>
<p><code>i</code> still has not yet taken every value of the object to the right of the keyword <code>in</code>, so R starts another iteration of the for loop. In the third iteration, the value of <code>i</code> is set to a numeric vector with the same values as the <code>z</code> column in <code>df_xyz</code>. Then, the <code>i</code> in <code>mean(i)</code> inside the for loop body is replaced with those numeric values. Then, the mean of those numeric values is calculated and assigned to the object named <code>xyz_means</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_5.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process - V</figcaption>
</figure>
</div>
</div>
</div>
<p>At this point, there is no more code left to execute inside of the for loop, so R returns to the top of the loop. However, this time, <code>i</code> has taken every value of the object to the right of the keyword <code>in</code>, so R does not start another iteration. It leaves the looping process, and the value of <code>xyz_means</code> remains <code>-0.4245589</code> – The result we got above.</p>
<p>You might be thinking, “wait, we made three slots in the <code>xyz_means</code> vector. Why does it only contain one number?” Well, remember that all we have to do to overwrite one object with another object is to assign the second object to the same name. For example, let’s create a vector with three values called <code>my_vec</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>my_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>my_vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
</div>
<p>Now, let’s assign another value to <code>my_vec</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>my_vec <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.4245589</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>my_vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4245589</code></pre>
</div>
</div>
<p>As you can see, assignment (<code>&lt;-</code>) doesn’t <em>add to</em> the vector, it <em>overwrites</em> (i.e., replaces) the vector. That’s exactly what was happening inside of our for loop. To R, it basically looked like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fl">0.07462564</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fl">0.208622</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.4245589</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4245589</code></pre>
</div>
</div>
<p>What we really want is to create the empty vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="dv">3</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0</code></pre>
</div>
</div>
<p>And then add a value to each <em>slot</em> in the vector. Do you remember how to do this?</p>
<p>We can do this using bracket notation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>xyz_means[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fl">0.07462564</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>xyz_means[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fl">0.208622</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>xyz_means[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.4245589</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.07462564  0.20862200 -0.42455890</code></pre>
</div>
</div>
<p>That’s exactly the result we want.</p>
<p>Does that code above remind you of any other code we’ve already seen? How about this code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07462564</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.208622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df_xyz[[<span class="dv">3</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4245589</code></pre>
</div>
</div>
<p>Hmmm, what if we combine the two? First, let’s once again create our empty vector, and then try combining the two code chunks above to fill it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="dv">3</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>xyz_means[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[<span class="dv">1</span>]])</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>xyz_means[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[<span class="dv">2</span>]])</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>xyz_means[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[<span class="dv">3</span>]])</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.07462564  0.20862196 -0.42455887</code></pre>
</div>
</div>
<p>Again, that’s exactly the result we want. Of course, there is still unnecessary repetition. If you look at the code carefully, you may notice that the only thing that changes from line to line is the number inside the double brackets. So, if we could just type <code>xyz_means[[ # ]] &lt;- mean(df_xyz[[ # ]])</code> once, and update the number inside the double brackets, we should be able to get the result we want. We’ve actually already seen how to do that with a for loop too. Remember this for loop for the very beginning of the chapter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) {</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2
[1] 3</code></pre>
</div>
</div>
<p>That looks promising, right? Let’s once again create our empty vector, and then try combining the two code chunks above to fill it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="dv">3</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) {</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  xyz_means[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[i]])</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.07462564  0.20862196 -0.42455887</code></pre>
</div>
</div>
<p>It works! We have used a for loop to successfully remove the unnecessary repetition from our code. However, there’s still something we could do to make the code more robust. In the for loop above, we knew that we needed three iterations. Therefore, we passed <code>c(1, 2, 3)</code> as the object to the right of the keyword <code>in</code>. But, what if we didn’t know exactly how columns there were? What if we just knew that we wanted to iterate over all the columns in the data frame passed to the right of the keyword <code>in</code>. How could we do that?</p>
<p>We can do that with the <code>seq_along()</code> function. When we pass a vector to the <code>seq_along()</code> function, it returns a sequence of integers with the same length as the vector being passed, starting at one. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
</div>
<p>Or:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4</code></pre>
</div>
</div>
<p>Similarly, when we pass a data frame to the <code>seq_along()</code> function, it returns a sequence of integers with a length equal to the number of columns in the data frame being passed, starting at one. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(df_xyz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
</div>
<p>Therefore, we can replace <code>for(i in c(1, 2, 3))</code> with <code>for(i in seq_along(df_xyz))</code> to make our code more robust (i.e., it will work in more situations):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="dv">3</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(df_xyz)) {</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  xyz_means[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[i]])</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.07462564  0.20862196 -0.42455887</code></pre>
</div>
</div>
<p>Just to make sure that we really understand what’s going on in the code above, let’s walk through the entire process one more time.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_2_1.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process again - I</figcaption>
</figure>
</div>
</div>
</div>
<p>R starts executing at the top of the for loop. In the first iteration, the value of i is set to the first value in <code>seq_along(df_xyz)</code>, which is <code>1</code>. Then, the <code>i</code> in <code>df_xyz[[i]]</code> inside the for loop body is replaced with <code>1</code>. Then, R calculates the mean of <code>df_xyz[[1]]</code>, which is <code>x</code> column of the <code>df_xyz</code> data frame. Finally, the mean value is assigned to <code>xyz_means[[i]]</code>, which is <code>xyz_means[[1]]</code> in this iteration. So, the value of the first element in the <code>xyz_means</code> vector is <code>0.07462564</code>.</p>
<p>At this point, there is no more code left to execute inside of the for loop, so R returns to the top of the loop. <code>i</code> has not yet taken every value of the object to the right of the keyword <code>in</code>, so R starts another iteration of the for loop.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_2_2.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process again - II</figcaption>
</figure>
</div>
</div>
</div>
<p>In the second iteration, the value of i is set to the second value in <code>seq_along(df_xyz)</code>, which is <code>2</code>. Then, the <code>i</code> in <code>df_xyz[[i]]</code> inside the for loop body is replaced with <code>2</code>. Then, R calculates the mean of <code>df_xyz[[2]]</code>, which is <code>y</code> column of the <code>df_xyz</code> data frame. Finally, the mean value is assigned to <code>xyz_means[[i]]</code>, which is <code>xyz_means[[2]]</code> in this iteration. So, the value of the second element in the <code>xyz_means</code> vector is <code>0.20862196</code>.</p>
<p>At this point, there is no more code left to execute inside of the for loop, so R returns to the top of the loop. <code>i</code> still has not yet taken every value of the object to the right of the keyword <code>in</code>, so R starts another iteration of the for loop.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_2_3.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process again - III</figcaption>
</figure>
</div>
</div>
</div>
<p>In the third iteration, the value of i is set to the third value in <code>seq_along(df_xyz)</code>, which is <code>3</code>. Then, the <code>i</code> in <code>df_xyz[[i]]</code> inside the for loop body is replaced with <code>3</code>. Then, R calculates the mean of <code>df_xyz[[3]]</code>, which is <code>z</code> column of the <code>df_xyz</code> data frame. Finally, the mean value is assigned to <code>xyz_means[[i]]</code>, which is <code>xyz_means[[3]]</code> in this iteration. So, the value of the third element in the <code>xyz_means</code> vector is <code>-0.42455887</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="iteration_1_5.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Illustration of a for loop process - V</figcaption>
</figure>
</div>
</div>
</div>
<p>At this point, there is no more code left to execute inside of the for loop, so R returns to the top of the loop. However, this time, <code>i</code> has taken every value of the object to the right of the keyword <code>in</code>, so R does not start another iteration. It leaves the looping process, and the value of <code>xyz_means</code> remains <code>0.07462564, 0.20862196, -0.4245589</code>.</p>
<p>There’s one final adjustment we should probably make to the code above. Did you notice that when we create the empty vector to contain our results, we’re still hard coding its length to <code>3</code>? For the same reason we replaced <code>for(i in c(1, 2, 3))</code> with <code>for(i in seq_along(df_xyz))</code>, we want to replace <code>vector("numeric", 3)</code> with <code>vector("numeric", length(df_xyz))</code>.</p>
<p>Now, let’s add a fourth column to our data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df_xyz <span class="ot">&lt;-</span> df_xyz <span class="sc">%&gt;%</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
         x      y      z       a
     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 -0.560   1.22  -1.07   0.426 
 2 -0.230   0.360 -0.218 -0.295 
 3  1.56    0.401 -1.03   0.895 
 4  0.0705  0.111 -0.729  0.878 
 5  0.129  -0.556 -0.625  0.822 
 6  1.72    1.79  -1.69   0.689 
 7  0.461   0.498  0.838  0.554 
 8 -1.27   -1.97   0.153 -0.0619
 9 -0.687   0.701 -1.14  -0.306 
10 -0.446  -0.473  1.25  -0.380 </code></pre>
</div>
</div>
<p>And see what happens when we pass it to our new, robust for loop code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="fu">length</span>(df_xyz)) <span class="co"># Using length() instead of 3</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(df_xyz)) { <span class="co"># Using seq_along() instead of c(1, 2, 3)</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  xyz_means[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[i]])</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.07462564  0.20862196 -0.42455887  0.32204455</code></pre>
</div>
</div>
<p>Our for loop now gives us the result we want no matter how many columns are in the data frame. Having the flexibility to loop over an arbitrary number of columns wasn’t that important in this case – we knew exactly how many columns we wanted to loop over. However, what if we wanted to add more columns in the future? Using the second method, we wouldn’t have to make any changes to our code. This is often an important consideration when we embed for loops inside of functions that we write ourselves.</p>
<p>For example, maybe we think, “that for loop above was really useful. I want to write it into a function so that I can use it again in my other projects.” Well, we’ve already seen how to take our working code, embed it inside of a function, make it more general, and assign it a name. If you forgot how to do this, please review <a href="../writing_functions/writing_functions.html#the-function-writing-process">the function writing process</a>. In this case, that process would result in something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>multi_means <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a structure to contain results</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="fu">length</span>(data))</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over each column of data</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(data)) {</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    result[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(data[[i]])</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the result</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Which we can easily apply to our data frame like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multi_means</span>(df_xyz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.07462564  0.20862196 -0.42455887  0.32204455</code></pre>
</div>
</div>
<p>Further, because we’ve made the for loop code inside of the function body flexible with <code>length()</code> and <code>seq_along()</code> we can easily pass any other data frame (with all numeric columns) to our function like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>new_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">age    =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">10</span>),</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">65</span>, <span class="dv">5</span>),</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">165</span>, <span class="dv">10</span>)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
     age height weight
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1  44.4   71.1   154.
 2  47.7   66.8   163.
 3  65.6   67.0   155.
 4  50.7   65.6   158.
 5  51.3   62.2   159.
 6  67.2   73.9   148.
 7  54.6   67.5   173.
 8  37.3   55.2   167.
 9  43.1   68.5   154.
10  45.5   62.6   178.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multi_means</span>(new_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  50.74626  66.04311 160.75441</code></pre>
</div>
</div>
<p>If we want our for loop to return the results with informative names, similar those that are returned when we use the <code>across()</code> method, we can simply add one line of code to our for loop body that names each result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="fu">length</span>(df_xyz))</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(df_xyz)) {</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  xyz_means[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_xyz[[i]])</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(xyz_means)[[i]] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(df_xyz)[[i]], <span class="st">"_mean"</span>) <span class="co"># Name results here</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>xyz_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     x_mean      y_mean      z_mean      a_mean 
 0.07462564  0.20862196 -0.42455887  0.32204455 </code></pre>
</div>
</div>
<p>If it isn’t quite clear to you why that code works, try picking it apart, replacing <code>i</code> with a number, and figuring out how it works.</p>
<p>We can make our results resemble those returned by the <code>across()</code> method even more by converting our named vector to a data frame like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>xyz_means <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  x_mean y_mean z_mean a_mean
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 0.0746  0.209 -0.425  0.322</code></pre>
</div>
</div>
<p>Finally, we can update our <code>multi_means()</code> function with changes we made above so that our results are returned as a data frame with informative column names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>multi_means <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a structure to contain results</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="fu">length</span>(data))</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over each column of data</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(data)) {</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    result[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(data[[i]])</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(result)[[i]] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(data)[[i]], <span class="st">"_mean"</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the result as a tibble</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="fu">as.list</span>(result))</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multi_means</span>(new_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  age_mean height_mean weight_mean
     &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1     50.7        66.0        161.</code></pre>
</div>
</div>
</section>
</section>
<section id="using-for-loops-for-data-transfer" class="level2" data-number="36.2">
<h2 data-number="36.2" class="anchored" data-anchor-id="using-for-loops-for-data-transfer"><span class="header-section-number">36.2</span> Using for loops for data transfer</h2>
<p>In the previous section, we used an example that wasn’t really all that realistic, but it was useful (hopefully) for learning the mechanics of for loops. As mentioned at the beginning of the chapter, rather than using a for loop for the analysis above, using <code>across()</code> with <code>summarise()</code> might be preferable.</p>
<p>However, keep in mind that <code>across()</code> is designed specifically for repeatedly applying functions column-wise (i.e., across columns) of a <em>single</em> data frame in conjunction with <code>dplyr</code> verbs. By definition, if we are repeating code outside of <code>dplyr</code>, or if we are applying code across <em>multiple data frames</em>, then we probably aren’t going to be able to use <code>across()</code> to complete our coding task.</p>
<p>For example, let’s say that we have data stored across multiple sheets of an Excel workbook. This simulated data contains some demographic information about three different cities: Houston, Atlanta, and Charlotte. We need to import each sheet, clean the data, and combine them into a single data frame in order to complete our analysis. First, we will load the <code>readxl</code>package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://github.com/brad-cannell/r4epi/blob/master/data/city_ses.xlsx">You may click here to download this file to your computer.</a></p>
<p>Then, we may import each sheet like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>houston <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"city_ses.xlsx"</span>,</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">"Houston"</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  pid     age sex   ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1 001      13 F            88
2 003      13 F            78
3 007      14 M            83
4 014      12 F            76
5 036      13 M            84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>atlanta <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"city_ses.xlsx"</span>,</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">"Atlanta"</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  id      age gender ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
1 002      14 M             64
2 009      15 M             35
3 012      13 F             70
4 013      13 F             66
5 022      12 F             59</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>charlotte <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"city_ses.xlsx"</span>,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">"Charlotte"</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  pid     age sex     ses
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 004      13 F        84
2 011      14 M        66
3 018      12 M        92
4 023      12 M        89
5 030      13 F        83</code></pre>
</div>
</div>
<p>🚩In the code chunks above, we have essentially the same code copied more than twice. That’s a red flag that we should be thinking about removing unnecessary repetition from our code. Of course, we could write our own function to reduce some of the repetition:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>import_cities <span class="ot">&lt;-</span> <span class="cf">function</span>(sheet) {</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"city_ses.xlsx"</span>,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> sheet</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>houston <span class="ot">&lt;-</span> <span class="fu">import_cities</span>(<span class="st">"Houston"</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  pid     age sex   ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1 001      13 F            88
2 003      13 F            78
3 007      14 M            83
4 014      12 F            76
5 036      13 M            84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>atlanta <span class="ot">&lt;-</span> <span class="fu">import_cities</span>(<span class="st">"Atlanta"</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  id      age gender ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
1 002      14 M             64
2 009      15 M             35
3 012      13 F             70
4 013      13 F             66
5 022      12 F             59</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>charlotte <span class="ot">&lt;-</span> <span class="fu">import_cities</span>(<span class="st">"Charlotte"</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  pid     age sex     ses
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 004      13 F        84
2 011      14 M        66
3 018      12 M        92
4 023      12 M        89
5 030      13 F        83</code></pre>
</div>
</div>
<p>That method is better. And depending on the circumstances of your project, it may be the best approach. However, an alternative approach would be to use a for loop. Using the for loop approach might look something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the file path to an object so we don't have to type it repeatedly </span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or hard-code it in.</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span>  <span class="st">"city_ses.xlsx"</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use readxl::excel_sheets to get the name of each sheet in the workbook.</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co"># this makes our code more robust.</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(path)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(sheets)) {</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert sheet name to lowercase before using it to name the df</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>  new_nm <span class="ot">&lt;-</span> <span class="fu">tolower</span>(sheets[[i]])</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(new_nm, <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> sheets[[i]]))</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>houston</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  pid     age sex   ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1 001      13 F            88
2 003      13 F            78
3 007      14 M            83
4 014      12 F            76
5 036      13 M            84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>atlanta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  id      age gender ses_score
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
1 002      14 M             64
2 009      15 M             35
3 012      13 F             70
4 013      13 F             66
5 022      12 F             59</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>charlotte</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  pid     age sex     ses
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 004      13 F        84
2 011      14 M        66
3 018      12 M        92
4 023      12 M        89
5 030      13 F        83</code></pre>
</div>
</div>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li><p>We used a for loop to import every sheet from an Excel workbook.</p></li>
<li><p>First, we saved the path to the Excel workbook to a separate object. We didn’t have to do this. However, doing so prevented us from having to type out the full file path repeatedly in the rest of our code. Additionally, if the file path ever changed, we would only have to update it in one place.</p></li>
<li><p>Second, we used the <code>excel_sheets()</code> function to create a character vector containing each sheet name. We didn’t have to do this. We could have typed each sheet name manually. However, there shouldn’t be any accidental typos if we use the <code>excel_sheets()</code> function, and we don’t have to make any changes to our code if more sheets are added to the Workbook in the future.</p></li>
<li><p>Inside the for loop, we assigned each data frame created by the <code>read_excel()</code> function to our global environment using the <code>assign()</code> function. We haven’t used the <code>assign()</code> function before, but you can read the help documentation by typing <code>?assign</code> in your R console.</p>
<ul>
<li><p>The first argument to the <code>assign()</code> function is <code>x</code>. The value you pass to <code>x</code> should be the name of the object you want to create. Above, we passed <code>new_nm</code> (for new name) to the <code>x</code> argument. At each iteration of the for loop, <code>new_nm</code> contained the name of each sheet in <code>sheets</code>. So, <code>Houston</code> at the first iteration, <code>Atlanta</code> at the second iteration, and <code>Charlotte</code> at the third iteration. Of course, we like using lowercase names for our data frames, so we used <code>tolower()</code> to convert <code>Houston</code>, <code>Atlanta</code>, and <code>Charlotte</code> to <code>houston</code>, <code>atlanta</code>, and <code>charlotte</code>. These will be the names used for each data frame assigned to our global environment inside of the for loop.</p></li>
<li><p>The second argument to the <code>assign()</code> function is <code>value</code>. The value you pass to <code>value</code> should be the contents you want to assign the object with the name you passed to the <code>x</code> argument. Above, we passed the code that imports each sheet of the <code>city_ses.xlsx</code> data frame to the <code>value</code> argument.</p></li>
</ul></li>
</ul>
<p>For loops can often be helpful for data transfer tasks. In the code above, we looped over sheets of a single Excel workbook. However, we could have similarly looped over file paths to import multiple different Excel workbooks instead. We could have even used nested for loops to import multiple sheets from multiple Excel workbooks. The code would not have looked drastically different.</p>
</section>
<section id="using-for-loops-for-data-management" class="level2" data-number="36.3">
<h2 data-number="36.3" class="anchored" data-anchor-id="using-for-loops-for-data-management"><span class="header-section-number">36.3</span> Using for loops for data management</h2>
<p>In the <a href="../writing_functions/writing_functions.html#the-function-writing-process">chapter on writing functions</a>, we created an <code>is_match()</code> function. In that scenario, we wanted to see if first name, last name, and street name matched at each ID between our data frames. More specifically, we wanted to combine the two data frames into a single data frame and create three new dummy variables that indicated whether first name, last name, and address matched respectively.</p>
<p>Here are the data frames we simulated and combined:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>people_1 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id_1, <span class="sc">~</span>name_first_1, <span class="sc">~</span>name_last_1, <span class="sc">~</span>street_1,</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,     <span class="st">"Easton"</span>,      <span class="cn">NA</span>,           <span class="st">"Alameda"</span>,</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,     <span class="st">"Elias"</span>,       <span class="st">"Salazar"</span>,    <span class="st">"Crissy Field"</span>,</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>,     <span class="st">"Colton"</span>,      <span class="st">"Fox"</span>,        <span class="st">"San Bruno"</span>,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>,     <span class="st">"Cameron"</span>,     <span class="st">"Warren"</span>,     <span class="st">"Nottingham"</span>,</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span>,     <span class="st">"Carson"</span>,      <span class="st">"Mills"</span>,      <span class="st">"Jersey"</span>,</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>,     <span class="st">"Addison"</span>,     <span class="st">"Meyer"</span>,      <span class="st">"Tingley"</span>,</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">7</span>,     <span class="st">"Aubrey"</span>,      <span class="st">"Rice"</span>,       <span class="st">"Buena Vista"</span>,</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span>,     <span class="st">"Ellie"</span>,       <span class="st">"Schmidt"</span>,    <span class="st">"Division"</span>,</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9</span>,     <span class="st">"Robert"</span>,      <span class="st">"Garza"</span>,      <span class="st">"Red Rock"</span>,</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>,    <span class="st">"Stella"</span>,      <span class="st">"Daniels"</span>,    <span class="st">"Holland"</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>people_2 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id_2, <span class="sc">~</span>name_first_2, <span class="sc">~</span>name_last_2, <span class="sc">~</span>street_2,</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,     <span class="st">"Easton"</span>,      <span class="st">"Stone"</span>,      <span class="st">"Alameda"</span>,</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,     <span class="st">"Elas"</span>,        <span class="st">"Salazar"</span>,    <span class="st">"Field"</span>,</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>,     <span class="cn">NA</span>,            <span class="st">"Fox"</span>,        <span class="cn">NA</span>,</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>,     <span class="st">"Cameron"</span>,     <span class="st">"Waren"</span>,      <span class="st">"Notingham"</span>,</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span>,     <span class="st">"Carsen"</span>,      <span class="st">"Mills"</span>,      <span class="st">"Jersey"</span>,</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>,     <span class="st">"Adison"</span>,      <span class="cn">NA</span>,           <span class="cn">NA</span>,</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">7</span>,     <span class="st">"Aubrey"</span>,      <span class="st">"Rice"</span>,       <span class="st">"Buena Vista"</span>,</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span>,     <span class="cn">NA</span>,            <span class="st">"Schmidt"</span>,    <span class="st">"Division"</span>,</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9</span>,     <span class="st">"Bob"</span>,         <span class="st">"Garza"</span>,      <span class="st">"Red Rock"</span>,</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>,    <span class="st">"Stella"</span>,      <span class="cn">NA</span>,           <span class="st">"Holland"</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>people <span class="ot">&lt;-</span> people_1 <span class="sc">%&gt;%</span> </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(people_2) <span class="sc">%&gt;%</span> </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
    id_1 name_first_1 name_last_1 street_1      id_2 name_first_2 name_last_2
   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      
 1     1 Easton       &lt;NA&gt;        Alameda          1 Easton       Stone      
 2     2 Elias        Salazar     Crissy Field     2 Elas         Salazar    
 3     3 Colton       Fox         San Bruno        3 &lt;NA&gt;         Fox        
 4     4 Cameron      Warren      Nottingham       4 Cameron      Waren      
 5     5 Carson       Mills       Jersey           5 Carsen       Mills      
 6     6 Addison      Meyer       Tingley          6 Adison       &lt;NA&gt;       
 7     7 Aubrey       Rice        Buena Vista      7 Aubrey       Rice       
 8     8 Ellie        Schmidt     Division         8 &lt;NA&gt;         Schmidt    
 9     9 Robert       Garza       Red Rock         9 Bob          Garza      
10    10 Stella       Daniels     Holland         10 Stella       &lt;NA&gt;       
# ℹ 1 more variable: street_2 &lt;chr&gt;</code></pre>
</div>
</div>
<p>Here is the function we wrote to help us create the dummy variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>is_match <span class="ot">&lt;-</span> <span class="cf">function</span>(value_1, value_2) {</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> value_1 <span class="sc">==</span> value_2</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(result), <span class="cn">FALSE</span>, result)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here is how we applied the function we wrote to get our results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>people <span class="sc">%&gt;%</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_first_match =</span> <span class="fu">is_match</span>(name_first_1, name_first_2),</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_last_match  =</span> <span class="fu">is_match</span>(name_last_1, name_last_2),</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_match     =</span> <span class="fu">is_match</span>(street_1, street_2)</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order like columns next to each other for easier comparison</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_1, <span class="fu">starts_with</span>(<span class="st">"name_f"</span>), <span class="fu">starts_with</span>(<span class="st">"name_l"</span>), <span class="fu">starts_with</span>(<span class="st">"s"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 10
    id_1 name_first_1 name_first_2 name_first_match name_last_1 name_last_2
   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;lgl&gt;            &lt;chr&gt;       &lt;chr&gt;      
 1     1 Easton       Easton       TRUE             &lt;NA&gt;        Stone      
 2     2 Elias        Elas         FALSE            Salazar     Salazar    
 3     3 Colton       &lt;NA&gt;         FALSE            Fox         Fox        
 4     4 Cameron      Cameron      TRUE             Warren      Waren      
 5     5 Carson       Carsen       FALSE            Mills       Mills      
 6     6 Addison      Adison       FALSE            Meyer       &lt;NA&gt;       
 7     7 Aubrey       Aubrey       TRUE             Rice        Rice       
 8     8 Ellie        &lt;NA&gt;         FALSE            Schmidt     Schmidt    
 9     9 Robert       Bob          FALSE            Garza       Garza      
10    10 Stella       Stella       TRUE             Daniels     &lt;NA&gt;       
# ℹ 4 more variables: name_last_match &lt;lgl&gt;, street_1 &lt;chr&gt;, street_2 &lt;chr&gt;,
#   street_match &lt;lgl&gt;</code></pre>
</div>
</div>
<p>🚩However, in the code chunk above, we still have essentially the same code copied more than twice. That’s a red flag that we should be thinking about removing unnecessary repetition from our code. Because we are using dplyr, and all of our data resides inside of a single data frame, your first instinct might be to use <code>across()</code> inside of <code>mutate()</code> to perform column-wise operations. Unfortunately, that method won’t work in this scenario.</p>
<p>The <code>across()</code> function will apply the function we pass to the <code>.fns</code> argument to each column passed to the <code>.cols</code> argument, one at a time. But, we need to pass two columns at a time to the <code>is_match()</code> function. For example, <code>name_first_1</code> and <code>name_first_2</code>. There’s really no good way to accomplish this task using <code>is_match()</code> inside of <code>across()</code>. However, it is fairly simple to accomplish this task with a for loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name_first"</span>, <span class="st">"name_last"</span>, <span class="st">"street"</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  col_1   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_1"</span>)</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  col_2   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_2"</span>)</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  new_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_match"</span>)</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  people[[new_col]] <span class="ot">&lt;-</span> <span class="fu">is_match</span>(people[[col_1]], people[[col_2]])</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>people <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_1, <span class="fu">starts_with</span>(<span class="st">"name_f"</span>), <span class="fu">starts_with</span>(<span class="st">"name_l"</span>), <span class="fu">starts_with</span>(<span class="st">"s"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 10
    id_1 name_first_1 name_first_2 name_first_match name_last_1 name_last_2
   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;lgl&gt;            &lt;chr&gt;       &lt;chr&gt;      
 1     1 Easton       Easton       TRUE             &lt;NA&gt;        Stone      
 2     2 Elias        Elas         FALSE            Salazar     Salazar    
 3     3 Colton       &lt;NA&gt;         FALSE            Fox         Fox        
 4     4 Cameron      Cameron      TRUE             Warren      Waren      
 5     5 Carson       Carsen       FALSE            Mills       Mills      
 6     6 Addison      Adison       FALSE            Meyer       &lt;NA&gt;       
 7     7 Aubrey       Aubrey       TRUE             Rice        Rice       
 8     8 Ellie        &lt;NA&gt;         FALSE            Schmidt     Schmidt    
 9     9 Robert       Bob          FALSE            Garza       Garza      
10    10 Stella       Stella       TRUE             Daniels     &lt;NA&gt;       
# ℹ 4 more variables: name_last_match &lt;lgl&gt;, street_1 &lt;chr&gt;, street_2 &lt;chr&gt;,
#   street_match &lt;lgl&gt;</code></pre>
</div>
</div>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li>We used our <code>is_match()</code> function inside of a for loop to create three new dummy variables that indicated whether first name, last name, and address matched respectively.</li>
</ul>
<p>Let’s pull the code apart piece-by-piece to see how it works.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name_first"</span>, <span class="st">"name_last"</span>, <span class="st">"street"</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  col_1   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_1"</span>)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  col_2   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_2"</span>)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>  new_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_match"</span>)</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(col_1)</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(col_2)</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(new_col)</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "name_first_1"
[1] "name_first_2"
[1] "name_first_match"
[1] "name_last_1"
[1] "name_last_2"
[1] "name_last_match"
[1] "street_1"
[1] "street_2"
[1] "street_match"</code></pre>
</div>
</div>
<p>First, we created a character vector that contained the base name (i.e., no <code>_1</code> or <code>_2</code>) of each of the columns we wanted to compare. Then, we iterated over that character vector by passing it as the object to the right of the keyword <code>in</code>.</p>
<p>At each iteration, we used <code>paste0()</code> to create three column names from the character string in <code>cols</code>. For example, in the first iteration of the loop, the value of <code>cols</code> was <code>name_first</code>. The first line of code in the for loop body combined <code>name_first</code> with <code>_1</code> to make the character string <code>name_first_1</code> and save it as an object named <code>col_1</code>. The second line of code in the for loop body combined <code>name_first</code> with <code>_2</code> to make the character string <code>name_first_2</code> and save it as an object named <code>col_2</code>. And, the third line of code in the for loop body combined <code>name_first</code> with <code>_match</code> to make the character string <code>name_first_match</code> and save it as an object named <code>new_col</code>.</p>
<p>This will allow us to use <code>col_1</code>, <code>col_2</code>, and <code>new_col</code> in the code that compares the columns and creates each dummy variable. For example, here is what <code>people[[col_1]]</code> looks like at each iteration:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name_first"</span>, <span class="st">"name_last"</span>, <span class="st">"street"</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  col_1 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_1"</span>)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  col_2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_2"</span>)</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(people[[col_1]])</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Easton"  "Elias"   "Colton"  "Cameron" "Carson"  "Addison" "Aubrey" 
 [8] "Ellie"   "Robert"  "Stella" 
 [1] NA        "Salazar" "Fox"     "Warren"  "Mills"   "Meyer"   "Rice"   
 [8] "Schmidt" "Garza"   "Daniels"
 [1] "Alameda"      "Crissy Field" "San Bruno"    "Nottingham"   "Jersey"      
 [6] "Tingley"      "Buena Vista"  "Division"     "Red Rock"     "Holland"     </code></pre>
</div>
</div>
<p>It is a vector that matches <code>people[["name_first_1"]]</code>, <code>people[["name_last_1"]]</code>, and <code>people[["street_1"]]</code> respectively.</p>
<p>And here is what <code>col_2</code> looks like at each iteration:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name_first"</span>, <span class="st">"name_last"</span>, <span class="st">"street"</span>)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  col_1 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_1"</span>)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  col_2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_2"</span>)</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(people[[col_2]])</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Easton"  "Elas"    NA        "Cameron" "Carsen"  "Adison"  "Aubrey" 
 [8] NA        "Bob"     "Stella" 
 [1] "Stone"   "Salazar" "Fox"     "Waren"   "Mills"   NA        "Rice"   
 [8] "Schmidt" "Garza"   NA       
 [1] "Alameda"     "Field"       NA            "Notingham"   "Jersey"     
 [6] NA            "Buena Vista" "Division"    "Red Rock"    "Holland"    </code></pre>
</div>
</div>
<p>Now, we can pass each vector to our <code>is_match()</code> function at each iteration like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name_first"</span>, <span class="st">"name_last"</span>, <span class="st">"street"</span>)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  col_1 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_1"</span>)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  col_2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_2"</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">is_match</span>(people[[col_1]], people[[col_2]]))</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
 [1] FALSE  TRUE  TRUE FALSE  TRUE FALSE  TRUE  TRUE  TRUE FALSE
 [1]  TRUE FALSE FALSE FALSE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE</code></pre>
</div>
</div>
<p>These logical vectors are the results we want to go into our new dummy variables. Therefore, the last step is to assign each logical vector above to a new variable in our data frame called <code>people[["name_first_match"]]</code>, <code>people[["name_last_match"]]</code>, and <code>people[["street_match"]]</code> respectively. We do so by allowing <code>people[[new_col]]</code> to represent those values at each iteration of the loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name_first"</span>, <span class="st">"name_last"</span>, <span class="st">"street"</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  col_1   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_1"</span>)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  col_2   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_2"</span>)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  new_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols[[i]], <span class="st">"_match"</span>)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  people[[new_col]] <span class="ot">&lt;-</span> <span class="fu">is_match</span>(people[[col_1]], people[[col_2]])</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here is our result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>people <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_1, <span class="fu">starts_with</span>(<span class="st">"name_f"</span>), <span class="fu">starts_with</span>(<span class="st">"name_l"</span>), <span class="fu">starts_with</span>(<span class="st">"s"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 10
    id_1 name_first_1 name_first_2 name_first_match name_last_1 name_last_2
   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;lgl&gt;            &lt;chr&gt;       &lt;chr&gt;      
 1     1 Easton       Easton       TRUE             &lt;NA&gt;        Stone      
 2     2 Elias        Elas         FALSE            Salazar     Salazar    
 3     3 Colton       &lt;NA&gt;         FALSE            Fox         Fox        
 4     4 Cameron      Cameron      TRUE             Warren      Waren      
 5     5 Carson       Carsen       FALSE            Mills       Mills      
 6     6 Addison      Adison       FALSE            Meyer       &lt;NA&gt;       
 7     7 Aubrey       Aubrey       TRUE             Rice        Rice       
 8     8 Ellie        &lt;NA&gt;         FALSE            Schmidt     Schmidt    
 9     9 Robert       Bob          FALSE            Garza       Garza      
10    10 Stella       Stella       TRUE             Daniels     &lt;NA&gt;       
# ℹ 4 more variables: name_last_match &lt;lgl&gt;, street_1 &lt;chr&gt;, street_2 &lt;chr&gt;,
#   street_match &lt;lgl&gt;</code></pre>
</div>
</div>
<p>In the code above, we used roughly the same amount of code to complete the task with a loop that we used to complete it without a loop. However, this code still has some advantages. We only typed “name_first”, “name_last”, and “street” once at the beginning of the code chunk. Therefore, we didn’t have to worry about forgetting to change a column name after copying and pasting code. Additionally, if we later decide that we also want to compare other columns (e.g., middle name, birth date, city, state, zip code), we only have to update the code in one place – where we create the <code>cols</code> vector.</p>
</section>
<section id="using-for-loops-for-analysis" class="level2" data-number="36.4">
<h2 data-number="36.4" class="anchored" data-anchor-id="using-for-loops-for-analysis"><span class="header-section-number">36.4</span> Using for loops for analysis</h2>
<p>For our final example of this chapter, let’s return to the final example from the <a href="../dplyr_column_wise/dplyr_column_wise.html#across-with-summarise">column-wise operations chapter</a>. We started with some simulated study data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>study <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">age       =</span> <span class="fu">c</span>(<span class="dv">32</span>, <span class="dv">30</span>, <span class="dv">32</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">38</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">48</span>, <span class="dv">29</span>, <span class="dv">22</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">28</span>, <span class="dv">24</span>, <span class="dv">25</span>, </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>                <span class="dv">25</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">24</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">26</span>, <span class="dv">23</span>, </span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>                <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">33</span>, <span class="dv">27</span>, <span class="dv">25</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">26</span>, <span class="dv">27</span>, <span class="dv">24</span>, <span class="dv">43</span>, <span class="dv">25</span>, <span class="dv">24</span>, </span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>                <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">28</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">31</span>, <span class="dv">24</span>, <span class="dv">26</span>, <span class="dv">31</span>, <span class="dv">34</span>, </span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>                <span class="dv">26</span>, <span class="dv">25</span>, <span class="dv">27</span>, <span class="cn">NA</span>),</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, </span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>),</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, </span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, </span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="cn">NA</span>),</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ht_in     =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">63</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">67</span>, <span class="dv">58</span>, <span class="dv">64</span>, <span class="dv">69</span>, <span class="dv">65</span>, <span class="dv">68</span>, <span class="dv">63</span>, <span class="dv">68</span>, <span class="dv">69</span>, <span class="dv">66</span>, <span class="dv">67</span>, <span class="dv">65</span>, </span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>                <span class="dv">64</span>, <span class="dv">75</span>, <span class="dv">67</span>, <span class="dv">63</span>, <span class="dv">60</span>, <span class="dv">67</span>, <span class="dv">64</span>, <span class="dv">73</span>, <span class="dv">62</span>, <span class="dv">69</span>, <span class="dv">67</span>, <span class="dv">62</span>, <span class="dv">68</span>, <span class="dv">66</span>, <span class="dv">66</span>, <span class="dv">62</span>, </span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>                <span class="dv">64</span>, <span class="dv">68</span>, <span class="cn">NA</span>, <span class="dv">68</span>, <span class="dv">70</span>, <span class="dv">68</span>, <span class="dv">68</span>, <span class="dv">66</span>, <span class="dv">71</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">64</span>, <span class="dv">64</span>, <span class="dv">63</span>, <span class="dv">67</span>, <span class="dv">66</span>, </span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>                <span class="dv">69</span>, <span class="dv">76</span>, <span class="cn">NA</span>, <span class="dv">63</span>, <span class="dv">64</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">71</span>, <span class="dv">66</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">71</span>, <span class="dv">64</span>, <span class="dv">71</span>, <span class="dv">60</span>, <span class="dv">62</span>, </span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>                <span class="dv">61</span>, <span class="dv">69</span>, <span class="dv">66</span>, <span class="cn">NA</span>),</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">wt_lbs    =</span> <span class="fu">c</span>(<span class="dv">216</span>, <span class="dv">106</span>, <span class="dv">145</span>, <span class="dv">195</span>, <span class="dv">143</span>, <span class="dv">125</span>, <span class="dv">138</span>, <span class="dv">140</span>, <span class="dv">158</span>, <span class="dv">167</span>, <span class="dv">145</span>, <span class="dv">297</span>, <span class="dv">146</span>, </span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>                <span class="dv">125</span>, <span class="dv">111</span>, <span class="dv">125</span>, <span class="dv">130</span>, <span class="dv">182</span>, <span class="dv">170</span>, <span class="dv">121</span>, <span class="dv">98</span>, <span class="dv">150</span>, <span class="dv">132</span>, <span class="dv">250</span>, <span class="dv">137</span>, <span class="dv">124</span>, </span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>                <span class="dv">186</span>, <span class="dv">148</span>, <span class="dv">134</span>, <span class="dv">155</span>, <span class="dv">122</span>, <span class="dv">142</span>, <span class="dv">110</span>, <span class="dv">132</span>, <span class="dv">188</span>, <span class="dv">176</span>, <span class="dv">188</span>, <span class="dv">166</span>, <span class="dv">136</span>, </span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>                <span class="dv">147</span>, <span class="dv">178</span>, <span class="dv">125</span>, <span class="dv">102</span>, <span class="dv">140</span>, <span class="dv">139</span>, <span class="dv">60</span>, <span class="dv">147</span>, <span class="dv">147</span>, <span class="dv">141</span>, <span class="dv">232</span>, <span class="dv">186</span>, <span class="dv">212</span>, </span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>                <span class="dv">110</span>, <span class="dv">110</span>, <span class="dv">115</span>, <span class="dv">154</span>, <span class="dv">140</span>, <span class="dv">150</span>, <span class="dv">130</span>, <span class="cn">NA</span>, <span class="dv">171</span>, <span class="dv">156</span>, <span class="dv">92</span>, <span class="dv">122</span>, <span class="dv">102</span>, </span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>                <span class="dv">163</span>, <span class="dv">141</span>, <span class="cn">NA</span>),</span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">bmi       =</span> <span class="fu">c</span>(<span class="fl">30.99</span>, <span class="fl">18.78</span>, <span class="fl">26.52</span>, <span class="fl">30.54</span>, <span class="fl">22.39</span>, <span class="fl">26.12</span>, <span class="fl">23.69</span>, <span class="fl">20.67</span>, <span class="fl">26.29</span>, </span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>                <span class="fl">25.39</span>, <span class="fl">25.68</span>, <span class="fl">45.15</span>, <span class="fl">21.56</span>, <span class="fl">20.17</span>, <span class="fl">17.38</span>, <span class="fl">20.8</span>, <span class="fl">22.31</span>, <span class="fl">22.75</span>, </span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>                <span class="fl">26.62</span>, <span class="fl">21.43</span>, <span class="fl">19.14</span>, <span class="fl">23.49</span>, <span class="fl">22.66</span>, <span class="fl">32.98</span>, <span class="fl">25.05</span>, <span class="fl">18.31</span>, <span class="fl">29.13</span>, </span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>                <span class="fl">27.07</span>, <span class="fl">20.37</span>, <span class="fl">25.01</span>, <span class="fl">19.69</span>, <span class="fl">25.97</span>, <span class="fl">18.88</span>, <span class="fl">20.07</span>, <span class="cn">NA</span>, <span class="fl">26.76</span>, </span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>                <span class="fl">26.97</span>, <span class="fl">25.24</span>, <span class="fl">20.68</span>, <span class="fl">23.72</span>, <span class="fl">24.82</span>, <span class="fl">23.62</span>, <span class="fl">18.65</span>, <span class="fl">24.03</span>, <span class="fl">23.86</span>, </span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>                <span class="fl">10.63</span>, <span class="fl">23.02</span>, <span class="fl">23.72</span>, <span class="fl">20.82</span>, <span class="fl">28.24</span>, <span class="cn">NA</span>, <span class="fl">37.55</span>, <span class="fl">18.88</span>, <span class="fl">18.3</span>, </span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>                <span class="fl">19.13</span>, <span class="fl">21.48</span>, <span class="fl">22.59</span>, <span class="fl">24.96</span>, <span class="fl">21.63</span>, <span class="cn">NA</span>, <span class="fl">29.35</span>, <span class="fl">21.76</span>, <span class="fl">17.97</span>, </span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>                <span class="fl">22.31</span>, <span class="fl">19.27</span>, <span class="fl">24.07</span>, <span class="fl">22.76</span>, <span class="cn">NA</span>),</span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">bmi_3cat  =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">1</span>, </span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">factor</span>(age_group, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Younger than 30"</span>, <span class="st">"30 and Older"</span>)),</span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender    =</span> <span class="fu">factor</span>(gender, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>)),</span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">bmi_3cat  =</span> <span class="fu">factor</span>(bmi_3cat, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"Overweight"</span>, <span class="st">"Obese"</span>))</span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 68 × 7
     age age_group       gender ht_in wt_lbs   bmi bmi_3cat  
   &lt;dbl&gt; &lt;fct&gt;           &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     
 1    32 30 and Older    Male      70    216  31.0 Obese     
 2    30 30 and Older    Female    63    106  18.8 Normal    
 3    32 30 and Older    Female    62    145  26.5 Overweight
 4    29 Younger than 30 Male      67    195  30.5 Obese     
 5    24 Younger than 30 Female    67    143  22.4 Normal    
 6    38 30 and Older    Female    58    125  26.1 Overweight
 7    25 Younger than 30 Female    64    138  23.7 Normal    
 8    24 Younger than 30 Male      69    140  20.7 Normal    
 9    48 30 and Older    Male      65    158  26.3 Overweight
10    29 Younger than 30 Male      68    167  25.4 Overweight
# ℹ 58 more rows</code></pre>
</div>
</div>
<p>Then we saw how to use <code>across()</code> with <code>pivot_longer()</code> to remove repetition and get our results into a format that were easier to read an interpret:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">.cols  =</span> <span class="fu">c</span>(age, ht_in, wt_lbs, bmi),</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">.fns   =</span> <span class="fu">list</span>(</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_miss =</span> <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.x)),</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean   =</span> <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">median =</span> <span class="sc">~</span> <span class="fu">median</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">min    =</span> <span class="sc">~</span> <span class="fu">min</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">max    =</span> <span class="sc">~</span> <span class="fu">max</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">"{col}-{fn}"</span> <span class="co"># This is the new part of the code</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 20
  `age-n_miss` `age-mean` `age-median` `age-min` `age-max` `ht_in-n_miss`
         &lt;int&gt;      &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;          &lt;int&gt;
1            1       26.9           26        22        48              3
# ℹ 14 more variables: `ht_in-mean` &lt;dbl&gt;, `ht_in-median` &lt;dbl&gt;,
#   `ht_in-min` &lt;dbl&gt;, `ht_in-max` &lt;dbl&gt;, `wt_lbs-n_miss` &lt;int&gt;,
#   `wt_lbs-mean` &lt;dbl&gt;, `wt_lbs-median` &lt;dbl&gt;, `wt_lbs-min` &lt;dbl&gt;,
#   `wt_lbs-max` &lt;dbl&gt;, `bmi-n_miss` &lt;int&gt;, `bmi-mean` &lt;dbl&gt;,
#   `bmi-median` &lt;dbl&gt;, `bmi-min` &lt;dbl&gt;, `bmi-max` &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">everything</span>(),</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="fu">c</span>(<span class="st">"characteristic"</span>, <span class="st">".value"</span>),</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"-"</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  characteristic n_miss  mean median   min   max
  &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 age                 1  26.9   26    22    48  
2 ht_in               3  66.0   66    58    76  
3 wt_lbs              2 148.   142.   60   297  
4 bmi                 4  23.6   22.9  10.6  45.2</code></pre>
</div>
</div>
<p>I think that method works really nicely for our continuous variables; however, the situation is slightly more complicated for categorical variables. To illustrate the problem as simply as possible, let’s start by just getting counts for each of our categorical variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  age_group           n
  &lt;fct&gt;           &lt;int&gt;
1 Younger than 30    56
2 30 and Older       11
3 &lt;NA&gt;                1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  gender     n
  &lt;fct&gt;  &lt;int&gt;
1 Female    43
2 Male      24
3 &lt;NA&gt;       1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bmi_3cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  bmi_3cat       n
  &lt;fct&gt;      &lt;int&gt;
1 Normal        43
2 Overweight    16
3 Obese          5
4 &lt;NA&gt;           4</code></pre>
</div>
</div>
<p>You are, of course, and old pro at this by now, and you quickly spot all the unnecessary repetition. So, you decide to pass <code>count</code> to the <code>.fns</code> argument like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(age_group, gender, bmi_3cat),</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">.fns  =</span> count</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(.cols = c(age_group, gender, bmi_3cat), .fns =
  count)`.
Caused by error in `across()`:
! Can't compute column `age_group`.
Caused by error in `UseMethod()`:
! no applicable method for 'count' applied to an object of class "factor"</code></pre>
</div>
</div>
<p>Unfortunately, this won’t work. At least not currently. There are a couple reasons why this won’t work, but the one that is probably easiest to wrap your head around is related to the number of results produced by <code>count()</code>. What does this mean? Well, when we pass each continuous variable to <code>mean()</code> (or <code>median</code>, <code>min</code>, or <code>max</code>) we get <em>one</em> result back for each column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(age, ht_in),</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">.fns  =</span> <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    age ht_in
  &lt;dbl&gt; &lt;dbl&gt;
1  26.9  66.0</code></pre>
</div>
</div>
<p>It’s easy for <code>dplyr</code> to arrange those results into a data frame. However, the results from <code>count()</code> are much less predictable. For example, <code>study %&gt;% count(age_group)</code> had three results, <code>study %&gt;% count(gender)</code> had three results, and <code>study %&gt;% count(bmi_3cat)</code> had four results. Also, remember that every column of a data frame has to have the same number of rows. So, if the code we used to try to pass <code>count</code> to the <code>.fns</code> argument above would actually run, it might look something like this:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="summarise.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Representation of result from the above code if it could be run successfully</figcaption>
</figure>
</div>
</div>
</div>
<p>Because <code>summarise()</code> lays the results out side-by-side, it’s not clear what would go into the 4 cells in the bottom-left corner of the results data frame. Therefore, it isn’t necessarily straightforward for <code>dplyr</code> to figure out how it should return such results to us.</p>
<p>However, when we use a for loop, <em>we can create our own structure</em> to hold the results. And, that structure can be pretty much any structure that meets our needs. In this case, one option would be to create a data frame to hold our categorical counts that looks like this:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="our_structure_1.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Empty data frame structure to hold for loop results</figcaption>
</figure>
</div>
</div>
</div>
<p>Then, we can use a for loop to fill in the empty data frame so that we end up with results that look like this:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="our_structure_2.png" class="img-fluid figure-img" width="900"></p>
<figcaption>Data frame structure with for loop results</figcaption>
</figure>
</div>
</div>
</div>
<p>The process for getting to our finished product is a little bit involved (and probably a little intimidating for some of you) and will require us to cover a couple new topics. So, we’ll start by giving you the complete code for accomplishing this task. Then, we’ll pick the code apart, piece-by-piece, to make sure we understand <em>how</em> it works.</p>
<p>Here is the complete solution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Structure 1. An object to contain the results.</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the data frame structure that will contain our results</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>cat_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">category =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n        =</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>)</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Structure 2. The actual for loop.</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For each column, get the column name, category names, and count.</span></span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then, add them to the bottom of the results data frame we created above.</span></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>)) {</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>  cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(.data[[i]]) <span class="sc">%&gt;%</span> <span class="co"># Use .data to refer to the current data frame.</span></span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="co"># Use . to refer to the result to this point.</span></span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here is where we update cat_table with the results for each column</span></span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a>  cat_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cat_table, cat_stats)</span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>cat_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   variable  category            n
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
 1 age_group Younger than 30    56
 2 age_group 30 and Older       11
 3 age_group &lt;NA&gt;                1
 4 gender    Female             43
 5 gender    Male               24
 6 gender    &lt;NA&gt;                1
 7 bmi_3cat  Normal             43
 8 bmi_3cat  Overweight         16
 9 bmi_3cat  Obese               5
10 bmi_3cat  &lt;NA&gt;                4</code></pre>
</div>
</div>
<p>We’ll use the rest of this chapter section to walk through the code above and make sure we understand how it works. For starters, we will create our results data frame structure like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>cat_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">category =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n        =</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>)</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cat_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [0 × 3] (S3: tbl_df/tbl/data.frame)
 $ variable: chr(0) 
 $ category: chr(0) 
 $ n       : num(0) </code></pre>
</div>
</div>
<p>As you can see, we created an empty data frame with three columns. One to hold the variable names, one to hold the variable categories, and one to hold the count of occurrences of each category. Now, we can use a for loop to iteratively add results to our empty data frame structure. This works similarly to the way we added mean values to the <code>xyz_means</code> vector in the first example above. As a reminder, here is what the for loop code looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>)) {</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(.data[[i]]) <span class="sc">%&gt;%</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  cat_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cat_table, cat_stats)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For our next step, let’s walk through the first little chunk of code inside the for loop body. Specifically:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(.data[[i]]) <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we were using this code to analyze a single variable, as opposed to using it in a for loop, this is what the result would look like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  category            n variable 
  &lt;fct&gt;           &lt;int&gt; &lt;chr&gt;    
1 Younger than 30    56 age_group
2 30 and Older       11 age_group
3 &lt;NA&gt;                1 age_group</code></pre>
</div>
</div>
<p>We’ve already seen what the <code>study %&gt;% count(age_group)</code> part of the code does, and we already know that we can use <code>mutate()</code> to create a new column in our data frame. In this case, the name of the new column is <code>variable</code>. But, you may be wondering what the <code>names(.)[1]</code> after the equal sign does. Let’s take a look. Here, we can see the data frame that is getting passed to <code>mutate()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  age_group           n
  &lt;fct&gt;           &lt;int&gt;
1 Younger than 30    56
2 30 and Older       11
3 &lt;NA&gt;                1</code></pre>
</div>
</div>
<p>It’s a data frame with two columns. The first column actually has two different kinds of information that we need. It contains the name of the variable being analyzed as the column name, and it contains all the categories of that variable as the column values. We want to separate those two pieces of information into two columns. This task is similar to some of the “tidy data” tasks we worked through in the <a href="../restructuring_data_frames/restructuring_data_frames.html#tidy-data">chapter on restructuring data frames</a>. In fact, we can also use <code>pivot_longer()</code> to get the result we want:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="st">"age_group"</span>,</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="st">"variable"</span>,</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"category"</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
      n variable  category       
  &lt;int&gt; &lt;chr&gt;     &lt;fct&gt;          
1    56 age_group Younger than 30
2    11 age_group 30 and Older   
3     1 age_group &lt;NA&gt;           </code></pre>
</div>
</div>
<p>In this solution for this task, however, we’re not going to use <code>pivot_longer()</code> for a couple of reasons. First, it’s an opportunity for us to learn about the special use of dot (<code>.</code>) inside of <code>dplyr</code> verbs. Second, this solution will use <code>dplyr</code> only. It will not require us to use the <code>tidyr</code> package.</p>
<p>Before we talk about the dot, however, let’s make sure we know what the <code>names()[1]</code> is doing. There aren’t any new concepts here, but we may not have used them this way before. The <code>name()</code> function just returns a character vector containing the column names of the data frame we pass to it. So, when we pass the <code>cat_stats</code> data frame to it, this is what it returns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cat_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "age_group" "n"        </code></pre>
</div>
</div>
<p>We want to use the first value, <code>"age_group"</code> to fill-in our the new <code>variable</code> column we want to create. We can use bracket notation to subset the first element of the character vector of column names above like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cat_stats)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "age_group"</code></pre>
</div>
</div>
<p>What does the dot do? Well, outside of our <code>dplyr</code> pipeline, it doesn’t do anything useful:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(.)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object '.' not found</code></pre>
</div>
</div>
<p><em>Inside</em> of our <code>dplyr</code> pipeline, you can think of it as a placeholder for whatever is getting passed to the <code>dplyr</code> verb – <code>mutate()</code> in this case. So, what is getting passed to mutate? The result of everything that comes before <code>mutate()</code> in the pipeline. And what does that result look like in this case? It looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  age_group           n
  &lt;fct&gt;           &lt;int&gt;
1 Younger than 30    56
2 30 and Older       11
3 &lt;NA&gt;                1</code></pre>
</div>
</div>
<p>So, we can use the dot inside of mutate as a substitute for the results data frame getting passed to <code>mutate()</code>. Said another way. To <code>dplyr</code>, this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(study <span class="sc">%&gt;%</span> <span class="fu">count</span>(age_group))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span> <span class="fu">names</span>(.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>are the exact same thing in this context:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  age_group           n variable 
  &lt;fct&gt;           &lt;int&gt; &lt;chr&gt;    
1 Younger than 30    56 age_group
2 30 and Older       11 age_group
3 &lt;NA&gt;                1 age_group</code></pre>
</div>
</div>
<p>Now, we have all the variables we wanted for our final results table. Keep in mind, however, that we will eventually be stacking similar results from our other variables (i.e., <code>gender</code> and <code>bmi_3cat</code>) below these results using <code>bind_rows()</code>. You may remember from the <a href="../multiple_data_frames/multiple_data_frames.html#combining-data-frames-vertically-adding-rows">chapter on working with multiple data frames</a> that the <code>bind_rows()</code> function matches columns together by <em>name</em>, not by position. So, we need to change the <code>age_group</code> column name to <code>category</code>. If we don’t, we will end up with something that looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(study <span class="sc">%&gt;%</span> <span class="fu">count</span>(gender))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  age_group           n gender
  &lt;fct&gt;           &lt;int&gt; &lt;fct&gt; 
1 Younger than 30    56 &lt;NA&gt;  
2 30 and Older       11 &lt;NA&gt;  
3 &lt;NA&gt;                1 &lt;NA&gt;  
4 &lt;NA&gt;               43 Female
5 &lt;NA&gt;               24 Male  
6 &lt;NA&gt;                1 &lt;NA&gt;  </code></pre>
</div>
</div>
<p>Not what we want, right? Again, if we were doing this analysis one variable at a time, our code might look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  category            n variable 
  &lt;fct&gt;           &lt;int&gt; &lt;chr&gt;    
1 Younger than 30    56 age_group
2 30 and Older       11 age_group
3 &lt;NA&gt;                1 age_group</code></pre>
</div>
</div>
<p>We used the <code>rename()</code> function above to change the name of the first column from <code>age_group</code> to <code>category</code>. Remember, the syntax for renaming columns with the <code>rename()</code> function is <code>new_name = old_name</code>. But, inside our for loop we will actually have 3 old names, right? In the first iteration <code>old_name</code> will be <code>age_group</code>, in the second iteration <code>old_name</code> will be <code>gender</code>, and in the third iteration <code>old_name</code> will be <code>bmi_cat</code>. We could loop over the names, but there’s an even easier solution. Instead of asking <code>rename()</code> to rename our column by name using this syntax, <code>new_name = old_name</code>, we can also ask <code>rename()</code> to rename our column by <em>position</em> using this syntax, <code>new_name = column_number</code>. So, in our example above, we could get the same result by replacing <code>age_group</code> with <code>1</code> because <code>age_group</code> is the first column in the data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="co"># Replace age_group with 1</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  category            n variable 
  &lt;fct&gt;           &lt;int&gt; &lt;chr&gt;    
1 Younger than 30    56 age_group
2 30 and Older       11 age_group
3 &lt;NA&gt;                1 age_group</code></pre>
</div>
</div>
<p>And, using this method, we don’t have to make any changes to the value being passed to <code>rename()</code> when we are analyzing our other variables. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender) <span class="sc">%&gt;%</span> <span class="co"># Changed the column from age_group to gender</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="co"># Still have 1 here</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  category     n variable
  &lt;fct&gt;    &lt;int&gt; &lt;chr&gt;   
1 Female      43 gender  
2 Male        24 gender  
3 &lt;NA&gt;         1 gender  </code></pre>
</div>
</div>
<p>At this point, we have all the elements we need manually create the data frame of final results we want. First, we create the empty results table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>cat_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">category =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n        =</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>)</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# ℹ 3 variables: variable &lt;chr&gt;, category &lt;chr&gt;, n &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Then, we get the data frame of results for <code>age_group</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  category            n variable 
  &lt;fct&gt;           &lt;int&gt; &lt;chr&gt;    
1 Younger than 30    56 age_group
2 30 and Older       11 age_group
3 &lt;NA&gt;                1 age_group</code></pre>
</div>
</div>
<p>Then, we use <code>bind_rows()</code> to add those results to our <code>cat_table</code> data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>cat_table <span class="ot">&lt;-</span> cat_table <span class="sc">%&gt;%</span> </span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(cat_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  variable  category            n
  &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
1 age_group Younger than 30    56
2 age_group 30 and Older       11
3 age_group &lt;NA&gt;                1</code></pre>
</div>
</div>
<p>Then, we copy and paste the last two steps above, replacing <code>age_group</code> with <code>gender</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender) <span class="sc">%&gt;%</span> <span class="co"># Change to gender</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>cat_table <span class="ot">&lt;-</span> cat_table <span class="sc">%&gt;%</span> </span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(cat_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  variable  category            n
  &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
1 age_group Younger than 30    56
2 age_group 30 and Older       11
3 age_group &lt;NA&gt;                1
4 gender    Female             43
5 gender    Male               24
6 gender    &lt;NA&gt;                1</code></pre>
</div>
</div>
<p>Then, we copy and paste the two steps above, replacing <code>gender</code> with <code>bmi_3cat</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bmi_3cat) <span class="sc">%&gt;%</span>  <span class="co"># Change to bmi_3cat</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>cat_table <span class="ot">&lt;-</span> cat_table <span class="sc">%&gt;%</span> </span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(cat_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   variable  category            n
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
 1 age_group Younger than 30    56
 2 age_group 30 and Older       11
 3 age_group &lt;NA&gt;                1
 4 gender    Female             43
 5 gender    Male               24
 6 gender    &lt;NA&gt;                1
 7 bmi_3cat  Normal             43
 8 bmi_3cat  Overweight         16
 9 bmi_3cat  Obese               5
10 bmi_3cat  &lt;NA&gt;                4</code></pre>
</div>
</div>
<p>That is exactly the final result we wanted, and you might have noticed that the only elements of the code chunks above that changed were the column names being passed to <code>count()</code>. If we can just figure out how to loop over the column names, then we can remove a ton of unnecessary repetition from our code. Our first attempt might look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(age_group, gender, bmi_3cat)) {</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  study <span class="sc">%&gt;%</span> </span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(i) <span class="sc">%&gt;%</span> </span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'age_group' not found</code></pre>
</div>
</div>
<p>However, it doesn’t work. In the code above, R is looking for and <em>object</em> in the global environment called <code>age_group</code>. Of course, there is no object in the global environment named <code>age_group</code>. Rather, there is an object in the global environment named <code>study</code> that has a column named <code>age_group</code>.</p>
<p>We can get rid of that error by wrapping each column name in quotes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>)) {</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>  study <span class="sc">%&gt;%</span> </span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(i) <span class="sc">%&gt;%</span> </span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `count()`:
! Must group by variables found in `.data`.
✖ Column `i` is not found.</code></pre>
</div>
</div>
<p>Unfortunately, that just gives us a different error. In the code above, <code>count()</code> is looking for a column named <code>i</code> in the <code>study</code> data frame. You may be wondering why <code>i</code> is not being converted to <code>"age_group"</code>, <code>"gender"</code>, and <code>"bmi_3cat"</code> in the code above. The short answer is that it’s because of <a href="../intro_repeated_operations/intro_repeated_operations.html#tidy-evaluation">tidy evaluation and data masking</a>.</p>
<p>So, we need a way to iteratively pass each quoted column name to the <code>count()</code> function inside our for loop body, but also let <code>dplyr</code> know that they <em>are column names</em>, not just random character strings. Fortunately, the <code>rlang</code> package (which is partially imported with <code>dplyr</code>), provides us with a special construct that can help us solve this problem. It’s called the <code>.data</code> pronoun. Here’s how we can use it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>)) {</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  study <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(.data[[i]]) <span class="sc">%&gt;%</span> </span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  category            n variable 
  &lt;fct&gt;           &lt;int&gt; &lt;chr&gt;    
1 Younger than 30    56 age_group
2 30 and Older       11 age_group
3 &lt;NA&gt;                1 age_group
# A tibble: 3 × 3
  category     n variable
  &lt;fct&gt;    &lt;int&gt; &lt;chr&gt;   
1 Female      43 gender  
2 Male        24 gender  
3 &lt;NA&gt;         1 gender  
# A tibble: 4 × 3
  category       n variable
  &lt;fct&gt;      &lt;int&gt; &lt;chr&gt;   
1 Normal        43 bmi_3cat
2 Overweight    16 bmi_3cat
3 Obese          5 bmi_3cat
4 &lt;NA&gt;           4 bmi_3cat</code></pre>
</div>
</div>
<p>Here’s how it works. Remember that data masking allows us to write column names directly in <code>dplyr</code> code without having to use dollar sign or bracket notation to tell R which data frame that column lives in. For example, in the following code, <code>dplyr</code> just “knows” that <code>age_group</code> is a column in the <code>study</code> data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  age_group           n
  &lt;fct&gt;           &lt;int&gt;
1 Younger than 30    56
2 30 and Older       11
3 &lt;NA&gt;                1</code></pre>
</div>
</div>
<p>The same is not true for base R functions. For example, we can’t pass <code>age_group</code> directly to the <code>table()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(age_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'age_group' not found</code></pre>
</div>
</div>
<p>We have to use dollar sign or bracket notation to tell R that <code>age_group</code> is a column in <code>study</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(study[[<span class="st">"age_group"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Younger than 30    30 and Older 
             56              11 </code></pre>
</div>
</div>
<p>This is a really nice feature of <code>dplyr</code> when we’re using dplyr interactively. But, as we’ve already discussed, it does present us with some challenges when we use <code>dplyr</code> functions inside of the functions we write ourselves and inside of for loops.</p>
<p>As you can see in the code below, the tidy evaluation essentially blocks the <code>i</code> inside of <code>count()</code> from being replaced with each of the character strings we are looping over. Instead, <code>dplyr</code> looks for a literal <code>i</code> as a column name in the <code>study</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>)) {</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  study <span class="sc">%&gt;%</span> </span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(i)</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `count()`:
! Must group by variables found in `.data`.
✖ Column `i` is not found.</code></pre>
</div>
</div>
<p>So, we need a way to tell <code>dplyr</code> that <code>"age_group"</code> is a column <em>in</em> the <code>study</code> data frame. Well, we know how to use quoted column names inside bracket notation. So, we could write code like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(study[[<span class="st">"age_group"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  `study[["age_group"]]`     n
  &lt;fct&gt;                  &lt;int&gt;
1 Younger than 30           56
2 30 and Older              11
3 &lt;NA&gt;                       1</code></pre>
</div>
</div>
<p>However, the column name (i.e., <code>study[["age_group"]]</code>) in the results data frame above isn’t ideal to work with. Additionally, the code above isn’t very flexible because we have the <code>study</code> data frame hard-coded into it (i.e., <code>study[["age_group"]]</code>). That’s where the <code>.data</code> pronoun comes to the rescue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>study <span class="sc">%&gt;%</span> </span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(.data[[<span class="st">"age_group"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  age_group           n
  &lt;fct&gt;           &lt;int&gt;
1 Younger than 30    56
2 30 and Older       11
3 &lt;NA&gt;                1</code></pre>
</div>
</div>
<p>The <code>.data</code> pronoun “is not a data frame; it’s a special construct, a pronoun, that allows you to access the current variables either directly, with .data$x or indirectly with .data[[var]].”<span class="citation" data-cites="Wickham2020-dx"><sup><a href="../../references.html#ref-Wickham2020-dx" role="doc-biblioref">1</a></sup></span></p>
<p>When we put it all together, our code looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data frame structure that will contain our results</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>cat_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">category =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n        =</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>)</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a><span class="co"># For each column, get the column name, category names, and count.</span></span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, add them to the bottom of the results data frame we created above.</span></span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>)) {</span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>  cat_stats <span class="ot">&lt;-</span> study <span class="sc">%&gt;%</span> </span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(.data[[i]]) <span class="sc">%&gt;%</span> <span class="co"># Use .data to refer to the current data frame.</span></span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="co"># Use . to refer to the current data frame.</span></span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here is where we update cat_table with the results for each column</span></span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>  cat_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cat_table, cat_stats)</span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>cat_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   variable  category            n
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
 1 age_group Younger than 30    56
 2 age_group 30 and Older       11
 3 age_group &lt;NA&gt;                1
 4 gender    Female             43
 5 gender    Male               24
 6 gender    &lt;NA&gt;                1
 7 bmi_3cat  Normal             43
 8 bmi_3cat  Overweight         16
 9 bmi_3cat  Obese               5
10 bmi_3cat  &lt;NA&gt;                4</code></pre>
</div>
</div>
<p>And, we can do other interesting things with our results now that we have it in this format. For example, we can easily add percentages along with our counts like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>cat_table <span class="sc">%&gt;%</span> </span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> </span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
# Groups:   variable [3]
   variable  category            n percent
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;
 1 age_group Younger than 30    56   82.4 
 2 age_group 30 and Older       11   16.2 
 3 age_group &lt;NA&gt;                1    1.47
 4 gender    Female             43   63.2 
 5 gender    Male               24   35.3 
 6 gender    &lt;NA&gt;                1    1.47
 7 bmi_3cat  Normal             43   63.2 
 8 bmi_3cat  Overweight         16   23.5 
 9 bmi_3cat  Obese               5    7.35
10 bmi_3cat  &lt;NA&gt;                4    5.88</code></pre>
</div>
</div>
<p>Finally, we could also write our own function that uses the code above. That way, we can easily reuse this code in the future:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>cat_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(data, ...) {</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the data frame structure that will contain our results</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>  cat_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">vector</span>(<span class="st">"character"</span>), </span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n        =</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>)</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For each column in ..., get the column name, category names, and count.</span></span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then, add them to the bottom of the results data frame we created above.</span></span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(...)) {</span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a>    stats <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb239-13"><a href="#cb239-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(.data[[i]]) <span class="sc">%&gt;%</span> <span class="co"># Use .data to refer to the current data frame.</span></span>
<span id="cb239-14"><a href="#cb239-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">names</span>(.)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="co"># Use . to refer to the current data frame.</span></span>
<span id="cb239-15"><a href="#cb239-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">category =</span> <span class="dv">1</span>)</span>
<span id="cb239-16"><a href="#cb239-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb239-17"><a href="#cb239-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Here is where we update cat_table with the results for each column</span></span>
<span id="cb239-18"><a href="#cb239-18" aria-hidden="true" tabindex="-1"></a>    cat_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cat_table, stats)</span>
<span id="cb239-19"><a href="#cb239-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb239-20"><a href="#cb239-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return results</span></span>
<span id="cb239-21"><a href="#cb239-21" aria-hidden="true" tabindex="-1"></a>  cat_table</span>
<span id="cb239-22"><a href="#cb239-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat_stats</span>(study, <span class="st">"age_group"</span>, <span class="st">"gender"</span>, <span class="st">"bmi_3cat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   variable  category            n
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
 1 age_group Younger than 30    56
 2 age_group 30 and Older       11
 3 age_group &lt;NA&gt;                1
 4 gender    Female             43
 5 gender    Male               24
 6 gender    &lt;NA&gt;                1
 7 bmi_3cat  Normal             43
 8 bmi_3cat  Overweight         16
 9 bmi_3cat  Obese               5
10 bmi_3cat  &lt;NA&gt;                4</code></pre>
</div>
</div>
<p>We covered a lot of material in this chapter. For loops tend to be confusing for people who are just learning to program. When you throw in the tidy evaluation stuff, it can be really confusing – even for experienced R programmers. So, if you are still feeling a little confused, don’t beat yourself up. Also, trying to memorize everything we covered in this chapter is not recommended. Instead, we recommend that you read it until you have understood what for loops are and when they might be useful at a high level. Then, refer back to this chapter (or other online references that discuss for loops) if you find yourself in a situation where you believe that for loops might be the right tool to help you complete a given programming task. Having said that, also keep in mind that for loops are rarely the <em>only</em> tool you will have at your disposal to complete the task. In the next chapter, we will learn how to use functionals, specifically the <code>purrr</code> package, in place of for loops. You may find this approach to iteration more intuitive.</p>


<div id="refs" class="references csl-bib-body" role="list" style="display: none">
<div id="ref-Wickham2020-dx" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Wickham H, François R, Henry L, Müller K, RStudio. <em>Programming with Dplyr</em>.; 2020.</div>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/github\.com\/brad-cannell\/r4epi");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/dplyr_column_wise/dplyr_column_wise.html" class="pagination-link" aria-label="Column-wise Operations in dplyr">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Column-wise Operations in dplyr</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/using_purrr/using_purrr.html" class="pagination-link" aria-label="Using the purrr Package">
        <span class="nav-page-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Using the purrr Package</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>R for Epidemiology</p>
</div>   
    <div class="nav-footer-center">

<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/brad-cannell/r4epi/edit/main/chapters/writing_for_loops/writing_for_loops.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brad-cannell/r4epi/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://Quarto/.org/">Quarto/</a>.</p>
</div>
  </div>
</footer>




</body></html>